import{r as i,x as Se,j as e,ay as ve,al as Ce,az as X,G as g,aA as ye,aB as Z,aC as De,aD as ke,h as b,k as u,aE as Te,aF as Fe,aG as Ie,aH as k,aI as Oe,a0 as O,W as N,M as j,f as ee,aJ as se,aK as W,T as ne,aL as Ne,K as S,ab as Me,F as ze,g as v,m as Ee,o as _e,ad as Pe,d as G,aM as Re,q as R,e as M,b as m,aN as Be,aO as Ae,aP as He,n as P,Q as te,ac as re,a3 as z,aQ as Le,a6 as ae,aR as Ge,aS as Qe,aT as Ve,V as We,aU as Je,i as oe,aV as Ke,aW as $e,aX as qe,ai as Ue,ag as ie,aY as Ye,z as Xe,B as Ze,ah as es,aZ as ss,s as J}from"./react-vendor-CllrtqDN.js";import{u as le,M as ns}from"./useDeckFromUrl-3TlTnJir.js";import{g as ts,d as h,a as ce,b as rs,N as H,c as as,e as K,u as de,f as ue,h as os,s as is,i as he,j as ls,k as cs,l as ds,E as us,D as hs,m as ps,n as xs,A as fs}from"./index-jGxgGxBB.js";import{S as y,t as D}from"./utils-UxpEuF8F.js";import{N as js}from"./NoteMenu-Dr6WqFKU.js";import{D as ms}from"./DangerousConfirmModal-DL1P1d32.js";import{S as L}from"./Stat-D5t7p8L1.js";import"./vendor-kP31MWcD.js";import"./database-_ZSyCo0Q.js";import"./editor-C2bVNK98.js";import"./rxjs-DNGqVrHU.js";import"./mantine-charts-Bb-jmQwj.js";import"./deleteNote-DPZEKTwH.js";import"./NoteSubmitButton-B013PIhx.js";function pe(s){const[o,t]=i.useState([void 0,!1]);return i.useEffect(()=>{t([void 0,!1]),ts(s).then(n=>t(n))},[s]),o}async function xe(s,o,t){if(!s)return;let n=(await h.notes.bulkGet(s.notes)).slice(0,t!=null?t:999999).filter(a=>a!==void 0);return!o&&n.length<(t!=null?t:999999)&&await Promise.all(s.subDecks.map(a=>h.decks.get(a).then(r=>{if(r)return xe(r)}).then(r=>{r&&(n=n.concat(r))}))),n}function gs(s,o,t){return Se(()=>xe(s,o,t).then(n=>[n,s!==void 0]),[s,o],[void 0,!1])}function bs(s,o){return o.content&&(o.sortField=ce(o.content.type).getSortFieldFromNoteContent(o.content)),h.notes.update(s,o)}const ws="_card_1f1p1_1",Ss="_cardWrapper_1f1p1_21",vs="_dragging_1f1p1_30",Q={card:ws,cardWrapper:Ss,dragging:vs};function Cs({note:s,index:o,useCustomSort:t,showAnswer:n}){return i.useEffect(()=>{t&&bs(s.id,{customOrder:o})},[o]),t?e.jsx(ve,{index:o,draggableId:s.id,children:(a,r)=>e.jsx("div",{className:Q.cardWrapper+" "+(r.isDragging&&Q.dragging),...a.draggableProps,...a.dragHandleProps,ref:a.innerRef,children:e.jsx(q,{note:s,showAnswer:n})})},s.id):e.jsx(q,{note:s,showAnswer:n})}const $=i.memo(Cs),q=i.memo(({note:s,showAnswer:o})=>{const[t,n]=Ce(!1);return e.jsx(X,{p:"md",className:Q.card,children:e.jsxs(g,{align:"top",justify:"space-between",wrap:"nowrap",children:[e.jsx(g,{align:"center",w:"100%",onClick:n.toggle,children:rs(s).displayNote(s,o?"strict":t?"optional":"none")}),e.jsx(js,{note:s,withShortcuts:!1})]})})}),_=50;function ys(){var I;const[s]=le(),[o,t]=i.useState(!1),[n,a]=i.useState(!1),[r]=gs(s,o,_),[l,c]=i.useState(fe[0]),[p]=i.useState(1),[d,f]=i.useState(r!=null?r:[]),[w,B]=i.useState(!1),[T,A]=i.useState(!1),[F,E]=ke(d!=null?d:[]);return i.useEffect(()=>{w&&!T&&E.setState(d!=null?d:[])},[d]),i.useEffect(()=>{B(l.value==="custom_order"),f((r!=null?r:[]).slice(0).sort(l.sortFunction(p)))},[r,l,p,f]),e.jsxs(b,{gap:"sm",children:[e.jsxs(g,{gap:"xs",justify:"flex-end",children:[e.jsx(Ds,{sortOption:l,setSortOption:c}),e.jsx(ks,{excludeSubDecks:o,setExcludeSubDecks:t,showAnswer:n,setShowAnswer:a})]}),(s==null?void 0:s.notes)&&((I=s==null?void 0:s.notes)==null?void 0:I.length)>_&&e.jsxs(u,{c:"gray",fz:"sm",ta:"center",children:["Currently there is a limit of ",_," notes displayed."," ",s.notes.length-_," notes are not shown."]}),w?e.jsx(Te,{onDragEnd:({destination:x,source:C})=>{E.reorder({from:C.index,to:(x==null?void 0:x.index)||0}),A(!0)},children:e.jsx(Fe,{droppableId:"notebook",direction:"vertical",children:x=>e.jsxs("div",{...x.droppableProps,ref:x.innerRef,children:[F.map((C,we)=>e.jsx($,{note:C,index:we,useCustomSort:!0,showAnswer:n},C.id)),x.placeholder]})})}):e.jsx(b,{gap:"xs",children:d.map((x,C)=>e.jsx($,{note:x,index:C,useCustomSort:!1,showAnswer:n},x.id))})]})}const fe=[{value:"custom_order",icon:ye,label:"Custom",sortFunction:H.byCustomOrder},{value:"sort_field",icon:Z,label:"By Sort Field",sortFunction:H.bySortField},{value:"creation_date",icon:De,label:"By Creation Date",sortFunction:H.byCreationDate}];function Ds({sortOption:s,setSortOption:o}){const t=Ie({}),n=fe.map(a=>e.jsx(k.Option,{value:a.value,active:s.value===a.value,onClick:()=>{o(a),t.closeDropdown()},style:{backgroundColor:s.value===a.value?"var(--mantine-primary-color-filled)":"",color:s.value===a.value?"var(--mantine-primary-color-contrast)":""},children:e.jsxs(g,{gap:"xs",wrap:"nowrap",w:"100%",children:[e.jsx(a.icon,{width:"1.2rem",strokeWidth:"1.5px"}),e.jsx(u,{fz:"sm",fw:500,style:{whiteSpace:"nowrap"},children:a.label})]})},a.value));return e.jsxs(k,{store:t,resetSelectionOnOptionHover:!0,withinPortal:!1,width:200,transitionProps:{duration:200,transition:"fade"},children:[e.jsx(k.Target,{targetType:"button",children:e.jsx(Oe,{component:"button",type:"button",pointer:!0,rightSection:e.jsx(k.Chevron,{}),rightSectionPointerEvents:"none",onClick:()=>t.toggleDropdown(),children:s.label})}),e.jsx(k.Dropdown,{children:e.jsx(k.Options,{children:n})})]})}function ks({excludeSubDecks:s,setExcludeSubDecks:o,showAnswer:t,setShowAnswer:n}){const[a]=O();return N([["Shift+Space",()=>n(!t)]]),e.jsxs(j,{closeOnItemClick:!1,children:[e.jsx(j.Target,{children:e.jsx(ee,{variant:"default","aria-label":a("notebook.options.menu"),children:e.jsx(se,{})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Item,{leftSection:e.jsx(Z,{}),rightSection:e.jsx(W,{checked:s,onChange:r=>{o(r.currentTarget.checked)}}),onClick:r=>{r.preventDefault(),o(!s)},children:a("notebook.options.exclude-subdecks")}),e.jsx(ne,{label:e.jsxs(e.Fragment,{children:["Press ",e.jsx(S,{children:"Shift"})," + ",e.jsx(S,{children:"Space"})," to toggle all answers"]}),children:e.jsx(j.Item,{leftSection:e.jsx(Ne,{}),rightSection:e.jsx(W,{checked:t,onChange:r=>{n(r.currentTarget.checked)}}),onClick:r=>{r.preventDefault(),n(!t)},children:a("notebook.options.show-answer")})})]})]})}function Ts(s,o){if(!s)return;const t=new FileReader;t.onload=n=>{n.target&&o(n.target.result)},t.readAsText(s)}function je({file:s,setFile:o,setFileText:t,acceptedFormats:n}){return i.useEffect(()=>{s&&Ts(s,t)},[s]),e.jsx(Me,{withBorder:!0,shadow:"xs",w:"100%",style:{display:"flex",placeContent:"center"},children:s?e.jsxs(g,{justify:"space-between",align:"center",w:"100%",children:[e.jsx(u,{fz:"sm",fw:500,children:s.name})," ",e.jsx(v,{variant:"default",onClick:()=>o(null),children:"Remove File"})]}):e.jsx(ze,{onChange:a=>{o(a)},accept:n,children:a=>e.jsx(v,{...a,children:"Choose File"})})})}function V({importFunction:s,importStatus:o,setImportStatus:t,disabled:n}){return e.jsx(v,{style:{alignSelf:"end"},loading:o==="importing",disabled:n,onClick:async()=>{t("importing");try{await s()}catch{t("error");return}finally{t("success")}},children:"Import and Add Cards"})}function Fs({file:s,setFile:o,fileText:t,setFileText:n,importStatus:a,setImportStatus:r,deck:l}){const[c,p]=i.useState("selectFile"),[d,f]=i.useState(null);return e.jsx(b,{align:"start",children:c==="selectFile"||!s?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{color:"gray",icon:e.jsx(_e,{}),children:"Here you can import decks from JSON such as those exportable using CrowdAnki. Please note, that there is only basic options and no media support."}),e.jsx(je,{file:s,setFile:o,setFileText:n,acceptedFormats:".json"}),e.jsx(v,{rightSection:e.jsx(Pe,{}),onClick:async()=>{let w=null;try{w=await Is(t)}catch{r("error");return}finally{w?(f(w),p("options"),r("passive")):r("error")}},style:{alignSelf:"end"},disabled:!s,children:"Parse File and Continue"})]}):e.jsx(Os,{extractedData:d,importStatus:a,setImportStatus:r,deck:l})})}async function Is(s){if(!s)throw new Error("This file has no contents.");const o=JSON.parse(s),t=[];if(o.__type__!=="Deck")throw new Error("At the moment only decks can be imported from JSON");const n=o.note_models;if(!n||n.length===0)throw new Error("No note models found");n.length>1&&t.push("Multiple note models found, only cards of the first one will be used");const a=n[0],r=o.notes.map(l=>({fields:l.fields}));return{description:o.desc,name:o.name,fields:a.flds.map(l=>({label:l.name,value:l.ord.toString()})),cards:r,warnMessages:t}}function Os({extractedData:s,importStatus:o,setImportStatus:t}){const[n,a]=i.useState(null),[r,l]=i.useState(null);return console.log(s==null?void 0:s.fields),s?e.jsxs(b,{align:"start",children:[e.jsxs(u,{fz:"sm",children:["Deck Name: ",s.name]}),e.jsxs(u,{fz:"sm",children:["Deck Description: ",s.description]}),e.jsxs(u,{fz:"sm",children:["Card Number: ",s.cards.length]}),e.jsx(G,{label:"Front",data:s.fields,value:n,onChange:c=>a(c)}),e.jsx(G,{label:"Back",data:s.fields,value:r,onChange:c=>l(c)}),e.jsx(V,{importFunction:async()=>console.log("not supported right now"),importStatus:o,setImportStatus:t,disabled:!n||!r})]}):null}async function me(s,o,t,n){if(!s||!o)return;const a=s.split(t).map(r=>r.trim()).filter(r=>r.length>0).map(r=>r.split(n));await Promise.all(a.map(async r=>{if(!(r.length<2))return ce(as.Basic).createNote({front:r[0],back:r[1]},o)}))}function Ns({importStatus:s,setImportStatus:o,deck:t}){const[n,a]=i.useState(""),[r]=i.useState(`
`),[l,c]=i.useState("	");return i.useEffect(()=>{s==="success"&&a("")},[s]),e.jsxs(b,{align:"start",children:[e.jsx(Re,{label:"Paste your cards here",placeholder:`Question1	Answer1
Question2	Answer2
...`,value:n,onChange:p=>a(p.currentTarget.value),minRows:8,autosize:!0,style:{width:"100%"}}),e.jsx(R,{label:"Question / Answer Separator",value:l,onChange:p=>c(p.currentTarget.value),description:"Default is Tab character. Change if your data uses a different separator."}),e.jsx(V,{importFunction:async()=>{await me(n,t,r,l)},importStatus:s,setImportStatus:o,disabled:!n.trim()||!t})]})}function Ms({file:s,setFile:o,fileText:t,setFileText:n,importStatus:a,setImportStatus:r,deck:l}){const[c,p]=i.useState(`
`),[d,f]=i.useState("	");return e.jsxs(b,{align:"start",children:[e.jsx(je,{file:s,setFile:o,setFileText:n,acceptedFormats:".csv, .txt, .md"}),e.jsx(R,{label:"Question / Answer Separator",value:d,onChange:w=>f(w.currentTarget.value)}),e.jsx(V,{importFunction:async()=>{await me(t,l,c,d)},importStatus:a,setImportStatus:r,disabled:!s||!t||!l})]})}function zs({opened:s,setOpened:o,deck:t}){const[n,a]=i.useState("cardsfrompaste"),[r,l]=i.useState(null),[c,p]=i.useState(null),[d,f]=i.useState("passive");return e.jsxs(M,{opened:s,onClose:()=>{o(!1),l(null),p(null)},title:"Import",children:[(d==="passive"||d==="importing")&&e.jsxs(m,{orientation:"horizontal",defaultValue:"General",variant:"pills",value:n,children:[e.jsxs(m.List,{children:[e.jsx(m.Tab,{value:"cardsfrompaste",leftSection:e.jsx(Be,{}),onClick:()=>a("cardsfrompaste"),children:"From Paste"}),e.jsx(m.Tab,{value:"cardsfromplaintext",leftSection:e.jsx(Ae,{}),onClick:()=>a("cardsfromplaintext"),children:"From Plain Text"}),e.jsx(m.Tab,{value:"deckfromjson",leftSection:e.jsx(He,{}),onClick:()=>a("deckfromjson"),children:"From JSON"})]}),e.jsx(m.Panel,{value:"cardsfrompaste",children:e.jsx(Ns,{file:r,setFile:l,fileText:c,setFileText:p,deck:t,importStatus:d,setImportStatus:f})}),e.jsx(m.Panel,{value:"cardsfromplaintext",children:e.jsx(Ms,{file:r,setFile:l,fileText:c,setFileText:p,deck:t,importStatus:d,setImportStatus:f})}),e.jsx(m.Panel,{value:"deckfromjson",children:e.jsx(Fs,{file:r,setFile:l,fileText:c,setFileText:p,deck:t,importStatus:d,setImportStatus:f})})]}),d!=="passive"&&d]})}async function ge(s,o){await h.transaction("rw",h.decks,h.cards,h.notes,async()=>{s&&(await Promise.all(s.subDecks.map(t=>K(t).then(n=>n&&ge(n,!0)))),!o&&s.superDecks&&s.superDecks[s.superDecks.length-1]&&K(s.superDecks[s.superDecks.length-1]).then(t=>t&&h.decks.update(t.id,{...t,subDecks:t==null?void 0:t.subDecks.filter(n=>n!==s.id)})),await Promise.all(s.cards.map(t=>h.cards.delete(t))),await Promise.all(s.notes.map(t=>h.notes.delete(t))),h.decks.delete(s.id))})}function Es(s){return i.useMemo(()=>{const o={[y.New]:0,[y.Learning]:0,[y.Review]:0,[y.Relearning]:0};return s==null||s.forEach(t=>{o[t.model.state]++}),o},[s])}function _s({opened:s,setOpened:o,deck:t}){const[n]=de(t),a=Es(n!=null?n:[]),[r]=pe(t),[l]=ue(t);return e.jsx(M,{opened:s,onClose:()=>o(!1),title:"Debug",children:e.jsx(b,{justify:"space-between",children:t?e.jsxs(b,{gap:"xs",children:[e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"Name: "}),'"',t.name,'"']}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"ID: "}),'"',t.id,'"']}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"SubDecks: "}),l==null?void 0:l.map(c=>e.jsxs("span",{children:[e.jsx(P,{href:"/deck/"+c.id,children:c.name}),","," "]},c.id))]}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"SuperDecks: "}),'"',r==null?void 0:r.map(c=>e.jsxs("span",{children:[e.jsx(P,{href:"/deck/"+c.id,children:c.name}),","," "]},c.id)),'"']}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"Cards: "}),'"',t.cards.map(c=>e.jsx("span",{children:c+", "},c)),'"']}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"Notes: "}),'"',t.notes.map(c=>e.jsx("span",{children:c+", "},c)),'"']}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"Direct Card Length: "}),t.cards.length]}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"Contained Card Length: "}),n==null?void 0:n.length]}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"New: "}),a[y.New]]}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"Learning: "}),a[y.Learning]]}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"Review: "}),a[y.Review]]}),e.jsxs(u,{fz:"xs",children:[e.jsx("b",{children:"Relearning: "}),a[y.Relearning]]})]}):e.jsx(u,{fz:"xs",children:"No deck"})})})}async function Ps(s,o){return h.transaction("rw",h.decks,async()=>{var a;const t=await h.decks.get(s);if(!t)throw new Error(`Deck with id ${s} not found`);const n=await h.decks.get(o);if(n)h.decks.update(n.id,{subDecks:[...n.subDecks,s]});else throw new Error(`Deck with id ${o} not found`);if(t.superDecks){const r=await h.decks.get(t.superDecks[t.superDecks.length-1]);if(r){if(r.id===o){console.warn("Tried to move deck to its current superdeck. Ignoring.");return}await h.decks.update(r.id,{subDecks:r.subDecks.filter(l=>l!==s)})}}await h.decks.update(t,{superDecks:[...(a=n.superDecks)!=null?a:[],o]})})}function Rs({deck:s,opened:o,setOpened:t}){var p;const n=s.superDecks?s.superDecks[s.superDecks.length-1]:null,[a,r]=os(d=>d==null?void 0:d.filter(f=>f.id!==n)),[l,c]=i.useState(null);return e.jsx(M,{title:"Move Deck",opened:o,onClose:()=>t(!1),children:e.jsxs(b,{children:[e.jsx(G,{searchable:!0,label:"Move To",nothingFoundMessage:"No Decks Found",disabled:!r,data:(p=a==null?void 0:a.map(d=>({value:d.id,label:d.name})))!=null?p:[],value:l,onChange:d=>{c(d)}}),(a==null?void 0:a.length)===0&&e.jsx(u,{fz:"sm",children:"It seems like there are no other valid decks to move this deck to. Try creating another one."}),e.jsx(g,{justify:"flex-end",children:e.jsx(v,{onClick:()=>{const d=a==null?void 0:a.find(f=>f.id===l);d!==void 0&&(Ps(s.id,d.id),is(d.name),t(!1))},leftSection:e.jsx(te,{}),disabled:!r||!l||l===n,children:"Move Deck"})})]})})}async function be(s,o){return h.decks.update(s,{name:o})}function Bs({deck:s,opened:o,setOpened:t}){const[n,a]=i.useState(s.name);i.useEffect(()=>a(s.name),[s]);const r=i.useCallback(()=>{n!==""&&be(s.id,n).then(()=>{t(!1)}).catch(()=>he())},[s,n,t]);return N([["mod+Enter",()=>r()]]),e.jsx(M,{title:D("deck.rename.title",{deckName:s.name}),opened:o,onClose:()=>t(!1),children:e.jsxs(b,{children:[e.jsx(R,{"data-autofocus":!0,label:D("deck.rename.new-name"),value:n,onChange:l=>a(l.currentTarget.value),onKeyDown:re([["mod+Enter",()=>r()]])}),e.jsxs(g,{justify:"flex-end",gap:"sm",children:[e.jsx(v,{variant:"default",onClick:()=>t(!1),children:D("global.cancel")}),e.jsx(v,{disabled:n==="",onClick:r,children:D("deck.rename.rename-button")})]})]})})}function As({deck:s,isDeckReady:o,setDeckOptionsOpened:t}){const n=z(),[a]=O(),[r]=ls("developerMode"),[l,c]=i.useState(!1),[p,d]=i.useState(!1),[f,w]=i.useState(!1),[B,T]=i.useState(!1),[A,F]=i.useState(!1),E=i.useCallback(async()=>{if(s)try{await ge(s),c(!1),n(s.superDecks&&s.superDecks[s.superDecks.length-1]?"/deck/"+s.superDecks[s.superDecks.length-1]:"/home")}catch(C){console.error("Failed to delete deck: "+C)}},[s,n]),I=i.useCallback(()=>{s&&n("/notes/"+s.id)},[s,n]),x=cs();return N([["r",()=>w(!0)],["m",()=>{}],["b",I],["i",()=>T(!0)],["o",()=>t(!0)],["shift+d",()=>F(!0)],["Backspace",()=>c(!0)]]),e.jsxs(e.Fragment,{children:[e.jsxs(j,{position:"bottom-end",children:[e.jsx(j.Target,{children:e.jsx(ee,{variant:"subtle",color:"gray","aria-label":a("deck.menu.label"),disabled:o&&!s,children:e.jsx(se,{})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Item,{leftSection:e.jsx(Le,{size:16}),rightSection:x&&e.jsx(S,{children:"r"}),onClick:()=>w(!0),children:a("deck.menu.rename")}),e.jsx(j.Item,{leftSection:e.jsx(te,{size:16}),rightSection:x&&e.jsx(S,{children:"m"}),onClick:()=>d(!0),children:a("deck.menu.move")}),e.jsx(j.Item,{leftSection:e.jsx(ae,{size:16}),rightSection:x&&e.jsx(S,{children:"b"}),onClick:I,children:a("deck.menu.manage-cards")}),e.jsx(j.Item,{leftSection:e.jsx(Ge,{size:16}),rightSection:x&&e.jsx(S,{children:"i"}),onClick:()=>T(!0),children:a("deck.menu.import-cards")}),e.jsx(j.Item,{leftSection:e.jsx(Qe,{size:16}),rightSection:x&&e.jsx(S,{children:"o"}),onClick:()=>t(!0),children:a("deck.menu.options")}),r?e.jsx(j.Item,{leftSection:e.jsx(Ve,{size:16}),rightSection:x&&e.jsxs(g,{align:"center",gap:"0.25rem",children:[e.jsx(S,{children:"shift"}),"+",e.jsx(S,{children:"d"})]}),onClick:()=>F(!0),children:a("deck.menu.debug")}):null,e.jsx(j.Item,{color:"red",leftSection:e.jsx(We,{size:16}),rightSection:x&&e.jsx(S,{children:"â†"}),onClick:()=>c(!0),children:a("deck.menu.delete")})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(ms,{dangerousAction:()=>E(),dangerousDependencies:[s],dangerousTitle:"Delete Deck",dangerousDescription:"You are about to delete this deck. This cannot be undone. Do you wish to continue?",opened:l,setOpened:c}),e.jsx(Bs,{deck:s,opened:f,setOpened:w}),e.jsx(Rs,{deck:s,opened:p,setOpened:d}),e.jsx(_s,{deck:s,opened:A,setOpened:F}),e.jsx(zs,{deck:s,opened:B,setOpened:T})]})]})}function Hs({opened:s,setOpened:o}){return e.jsx(M,{opened:s,onClose:()=>o(!1),title:"Options",children:"Here is where deck options will reside."})}const Ls="_container_1pd0c_1",Gs="_statsGroup_1pd0c_13",U={container:Ls,statsGroup:Gs};function Qs({deck:s}){const o=z(),[t]=O();N([["Space",c]]);const[n,a]=de(s),r=ds(n);function l(){return r.new+r.learning+r.review===0}function c(){o("/learn/"+(s==null?void 0:s.id)+(l()?"/all":""))}return e.jsx(X,{className:U.container,withBorder:!0,shadow:"xs",children:a&&(n?n.length===0?e.jsx(us,{icon:Je,description:t("hero-deck-section.no-cards")}):l()?e.jsxs(b,{gap:"md",align:"center",children:[e.jsx(oe,{order:3,children:t("hero-deck-section.all-cards-done-title")}),e.jsx(u,{fz:"sm",children:t("hero-deck-section.all-cards-done-subtitle")}),e.jsx(v,{variant:"subtle",w:"50%",onClick:c,children:t("hero-deck-section.all-cards-done-learn-anyway")})]}):e.jsxs(b,{gap:"md",align:"center",w:"100%",children:[e.jsxs(g,{wrap:"nowrap",w:"100%",justify:"center",className:U.statsGroup,children:[e.jsx(L,{value:r.new,name:t("deck.new-cards-label"),color:"grape",icon:Ke}),e.jsx(L,{value:r.learning,name:t("deck.learning-cards-label"),color:"orange",icon:$e}),e.jsx(L,{value:r.review,name:t("deck.review-cards-label"),color:"blue",icon:qe})]}),e.jsx(v,{disabled:!s||r.new+r.learning+r.review===0,leftSection:e.jsx(Ue,{}),w:"50%",onClick:c,children:t("hero-deck-section.learn")})]}):e.jsx(u,{c:"red",fw:700,children:t("hero-deck-section.error")}))})}function Vs({deck:s}){const[o,t]=ue(s),[n,a]=i.useState(!1),[r]=O();function l(){return e.jsx(v,{disabled:!s||!t||!o,variant:"default",leftSection:e.jsx(ie,{}),onClick:()=>{s&&a(!0)},children:r("deck.subdeck.add-subdeck-button")})}return e.jsxs(e.Fragment,{children:[e.jsxs(b,{gap:"sm",children:[e.jsx(g,{justify:"flex-end",children:e.jsx(l,{})}),t&&(o?e.jsx(hs,{deckList:o,isReady:!0}):e.jsx(u,{c:"dimmed",children:r("deck.subdeck.load-fail")}))]}),e.jsx(ps,{opened:n,setOpened:a,superDeck:s})]})}const Ws="_wrapper_1vdl9_1",Js="_breadcrumbs_1vdl9_27",Y={wrapper:Ws,breadcrumbs:Js};function Ks({superDecks:s}){const o=z(),[t]=O(),{width:n}=Ye();return e.jsx(Xe,{component:"div",className:Y.wrapper,w:n/3,style:{flexGrow:2},children:e.jsxs(Ze,{className:Y.breadcrumbs,children:[e.jsx(P,{component:"button",type:"button",onClick:()=>o("/home"),children:e.jsxs(g,{wrap:"nowrap",gap:"xs",children:[e.jsx(es,{size:"1em"})," ",t("home.title")]})},0),s==null?void 0:s.map((a,r)=>e.jsx(P,{component:"button",type:"button",style:{fontWeight:r===s.length-1?"bold":"normal",color:r===s.length-1?"red":"blue"},onClick:()=>o("/deck/"+a.id),children:e.jsxs(g,{wrap:"nowrap",gap:"xs",children:[e.jsx(ae,{size:"1rem"})," ",a.name]})},a.id))]})})}function $s({deck:s}){const o=z(),[t,n]=i.useState(!1),[a,r]=i.useState("");return i.useEffect(()=>{s&&r(s==null?void 0:s.name)},[s]),i.useEffect(()=>{!t&&a!==""&&s&&be(s.id,a).catch(()=>{he()})},[t]),e.jsxs(g,{justify:"space-between",align:"center",w:"100%",children:[t?e.jsx(R,{type:"text",value:a,onChange:l=>r(l.currentTarget.value),onKeyDown:re([["Enter",()=>n(!1)],["Escape",()=>{r((s==null?void 0:s.name)||""),n(!1)}]]),onBlur:()=>n(!1),autoFocus:!0}):e.jsx(oe,{order:3,lineClamp:1,onDoubleClick:()=>n(!0),children:s==null?void 0:s.name}),e.jsx(ne,{label:e.jsxs(e.Fragment,{children:[D("deck.add-cards-tooltip"),e.jsx(S,{children:"n"})]}),children:e.jsx(v,{leftSection:e.jsx(ie,{}),variant:"default",onClick:()=>o("/new/"+(s==null?void 0:s.id)),children:D("deck.add-cards")})})]})}function dn(){const s=z(),[o,t]=i.useState(!1),[n,a]=le(),[r]=pe(n);return xs(),ss(n!=null&&n.name?n==null?void 0:n.name:"Skola"),N([["n",()=>s("/new/"+(n==null?void 0:n.id))]]),a&&!n?e.jsx(ns,{}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{children:e.jsxs(g,{justify:"space-between",gap:"xs",wrap:"nowrap",children:[e.jsx(Ks,{superDecks:r}),e.jsx(As,{deck:n,isDeckReady:a,setDeckOptionsOpened:t})]})}),e.jsxs(b,{gap:"xl",align:"start",w:"100%",maw:"600px",pt:"lg",children:[e.jsx($s,{deck:n}),e.jsx(Qs,{deck:n,isDeckReady:a}),e.jsxs(m,{defaultValue:"subdecks",w:"100%",variant:"outline",children:[e.jsxs(m.List,{children:[e.jsxs(m.Tab,{value:"subdecks",children:[D("deck.subdeck.title"),e.jsx(J,{size:"sm",ml:"sm",variant:"light",color:n!=null&&n.subDecks.length?void 0:"gray",style:{textOverflow:"clip"},children:n==null?void 0:n.subDecks.length})]}),e.jsxs(m.Tab,{value:"notebook",children:[D("deck.notebook.title"),e.jsx(J,{size:"sm",ml:"sm",variant:"light",color:n!=null&&n.notes.length?void 0:"gray",style:{textOverflow:"clip"},children:n==null?void 0:n.notes.length})]})]}),e.jsx(m.Panel,{value:"notebook",children:e.jsx(ys,{})}),e.jsx(m.Panel,{value:"subdecks",children:e.jsx(Vs,{deck:n})})]}),n?e.jsx(Hs,{deck:n,opened:o,setOpened:t}):""]})]})}export{dn as default};
