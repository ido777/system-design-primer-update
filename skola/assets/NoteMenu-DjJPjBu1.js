import{x as M,r as m,af as y,j as e,e as k,G as j,h as v,d as N,k as S,g as b,Q as w,al as I,W as C,M as f,f as E,aJ as O,K as x,b3 as T,V as F}from"./react-vendor-CllrtqDN.js";import{D as A}from"./DangerousConfirmModal-DL1P1d32.js";import{d as r,b as q,h as z,r as B,k as H,t as Q,v as R}from"./index-DRsVs7hl.js";import{d as _}from"./deleteNote-wh9Y2_6_.js";import{t as h}from"./utils-UxpEuF8F.js";import{N as G}from"./NoteSubmitButton-B013PIhx.js";function K(t){return M(()=>r.decks.get(t.deck).then(n=>[n,!0]),[t],[void 0,!1])}const J="_modal_1tkhp_1",L={modal:J};function V({note:t,opened:n,setClose:a}){const[s]=K(t),[i,o]=m.useState(!1),l=y("(max-width: 50em)"),u=m.useMemo(()=>s?q(t).editor({note:t,deck:s,mode:"edit",requestedFinish:i,setRequestedFinish:o}):null,[t,s,i,o]);return e.jsxs(k,{className:L.modal,title:e.jsx(j,{justify:"space-between",align:"center",w:"100%","flex-grow":1,children:e.jsx("span",{children:"Edit Note"})}),fullScreen:l,opened:n,onClose:a,children:[u,e.jsx(j,{justify:"end",pt:"md",children:e.jsx(G,{finish:()=>{o(!0),a()},mode:"edit"})})]})}async function W(t){return await r.transaction("rw",r.notes,r.cards,r.decks,async()=>{const n=typeof t.note=="string"?await r.notes.get(t.note):t.note,a=typeof t.newDeck=="string"?await r.decks.get(t.newDeck):t.newDeck;if(!n||!a)throw new Error("Note or deck not found");const s=await r.cards.where("note").equals(n.id).toArray(),i=await r.decks.get(n.deck);return i&&(i.notes=i.notes.filter(o=>o!==n.id),i.cards=i.cards.filter(o=>!s.map(l=>l.id).includes(o)),await r.decks.update(i.id,{notes:i.notes,cards:i.cards})),a.notes.push(n.id),a.cards.push(...s.map(o=>o.id)),await r.decks.update(a.id,{notes:a.notes,cards:a.cards}),await r.cards.where("note").equals(n.id).modify({deck:a.id}),n.deck=a.id,await r.notes.update(n.id,{deck:a.id})})}function P({note:t,opened:n,setOpened:a}){var u;const[s,i]=z(d=>d==null?void 0:d.filter(c=>c.id!==t.deck)),[o,l]=m.useState(null);return e.jsx(k,{title:"Move",opened:n,onClose:()=>a(!1),children:e.jsxs(v,{children:[e.jsx(N,{searchable:!0,label:"Move To",nothingFoundMessage:"No Decks Found",disabled:!i,data:(u=s==null?void 0:s.map(d=>({value:d.id,label:d.name})))!=null?u:[],value:o,onChange:d=>{l(d)}}),(s==null?void 0:s.length)===0&&e.jsx(S,{fz:"sm",children:"It seems like there are no other valid decks to move this note to. Try creating another one."}),e.jsx(j,{justify:"flex-end",children:e.jsx(b,{onClick:()=>{const d=s==null?void 0:s.find(c=>c.id===o);d!==void 0&&(W({note:t,newDeck:d}),B(d.name),a(!1))},leftSection:e.jsx(w,{}),disabled:!i||!o||o===t.deck,children:"Move Note"})})]})})}function te({note:t,onDelete:n,withEdit:a=!0,withShortcuts:s=!0}){const[i,o]=I(!1);m.useState(!1);const[l,u]=m.useState(!1),[d,c]=m.useState(!1);async function g(){if(t)try{await _(t),n&&n(),c(!1),Q("note")}catch(D){R("note"),console.log(D)}}const p=H();return C(s?[["e",o.open],["Backspace",()=>c(!0)]]:[]),t?e.jsxs(e.Fragment,{children:[e.jsxs(f,{position:"bottom-end",children:[e.jsx(f.Target,{children:e.jsx(E,{variant:"subtle",color:"gray",children:e.jsx(O,{})})}),e.jsxs(f.Dropdown,{children:[a&&e.jsx(f.Item,{leftSection:e.jsx(T,{size:16}),rightSection:s&&p&&e.jsx(x,{children:"e"}),onClick:o.open,children:h("note.menu.edit")}),e.jsx(f.Item,{leftSection:e.jsx(w,{size:16}),rightSection:s&&p&&e.jsx(x,{children:"m"}),onClick:()=>u(!0),children:h("note.menu.move")}),e.jsx(f.Item,{color:"red",leftSection:e.jsx(F,{size:16}),rightSection:s&&p&&e.jsx(x,{children:"â†"}),onClick:()=>c(!0),children:h("note.menu.delete")})]})]}),e.jsx(A,{dangerousAction:()=>g(),dangerousDependencies:[t],dangerousTitle:h("note.delete-modal.title"),dangerousDescription:h("note.delete-modal.description"),opened:d,setOpened:c}),e.jsx(V,{note:t,opened:i,setClose:o.close}),e.jsx(P,{note:t,opened:l,setOpened:u})]}):null}export{V as E,te as N,K as u};
