import{a3 as D,r as l,b2 as k,j as e,C as j,i as C,h as p,bg as L,bB as R,bC as A}from"./react-vendor-CllrtqDN.js";import{d as w,h as N,e as E,w as T,x as q,A as F}from"./index-jGxgGxBB.js";import{S as a}from"./utils-UxpEuF8F.js";import{S as I}from"./SelectDecksHeader-CuZFQzvD.js";import"./vendor-kP31MWcD.js";import"./database-_ZSyCo0Q.js";import"./editor-C2bVNK98.js";import"./rxjs-DNGqVrHU.js";import"./mantine-charts-Bb-jmQwj.js";async function O(){return w.cards.toArray()}function J(){const[S]=N(),h=D(),[d,x]=l.useState("month"),s=k().deckId,[f,v]=l.useState([]);l.useEffect(()=>{r();async function r(){const n=[],o=new Date,u=d==="week"?7:d==="month"?30:365;for(let m=0;m<u;m++){const g=new Date(o.getTime()-m*24*60*60*1e3).toISOString().split("T")[0],t=await(s?w.statistics.where({deck:s,day:g}):w.statistics.where("day").equals(g)).toArray();n.push({day:g,[a.Review]:t==null?void 0:t.reduce((c,i)=>c+i.cards[a.Review],0),[a.Learning]:t==null?void 0:t.reduce((c,i)=>c+i.cards[a.Learning]+i.cards[a.Relearning],0),[a.New]:t==null?void 0:t.reduce((c,i)=>c+i.cards[a.New],0)})}v(await Promise.all(n))}},[d,s]);const[y,b]=l.useState([]);return l.useEffect(()=>{r();async function r(){const n=await(s?E(s).then(u=>T(u)):O()),o=q(n!=null?n:[]);b([{name:"New",value:o.new,color:"grape.6"},{name:"Learning",value:o.learning,color:"orange.6"},{name:"Review",value:o.review,color:"blue.6"},{name:"Not Due",value:o.notDue,color:"gray.6"}])}},[s]),e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsx(j,{children:e.jsx(C,{order:3,children:"Statistics"})})}),e.jsxs(p,{w:"100%",maw:"600px",gap:"xl",children:[e.jsx(I,{label:"Showing Statistics of",decks:S,onSelect:r=>h(`/stats/${r}`)}),e.jsxs(p,{gap:"xs",children:[e.jsx(L,{data:[{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"year",label:"Year"}],size:"xs",value:d,onChange:r=>x(r)}),e.jsx(R,{h:500,data:f,dataKey:"day",type:"stacked",withLegend:!0,xAxisProps:{reversed:!0},series:[{name:a.Review.toString(),label:"Review",color:"blue.6"},{name:a.Learning.toString(),label:"Learning",color:"orange.6"},{name:a.New.toString(),label:"New",color:"grape.6"}],tickLine:"y"})]}),e.jsx(A,{size:160,data:y,withLabels:!0,tooltipDataSource:"segment"})]})]})}export{J as default};
