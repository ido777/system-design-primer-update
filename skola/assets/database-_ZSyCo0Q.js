import{D as Is,r as gn,a as $r,b as rr,c as Wo,E as tu,w as Qn,d as Ii,e as Nr,f as zo,t as nu,h as ru,g as iu}from"./vendor-kP31MWcD.js";import{D as Ln,A as ou,e as su,r as au,m as js,a as Cs,b as uu}from"./editor-C2bVNK98.js";import{B as en,s as Lt,d as Ns,f as wn,o as yn,a as Zt,m as Yr,b as un,t as Ki,S as Vr,c as cr,e as _n,g as cu,O as ro,h as In,i as lu,j as Bs,k as Jo,l as Rs,n as Ho,p as Zn,q as Go,r as Yo,u as fu,v as du}from"./rxjs-DNGqVrHU.js";var Xo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Us={exports:{}};(function(n,r){(function(o,s){n.exports=s()})(Xo,function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,a){i.__proto__=a}||function(i,a){for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(i[d]=a[d])})(e,t)},s=function(){return(s=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var d in t=arguments[i])Object.prototype.hasOwnProperty.call(t,d)&&(e[d]=t[d]);return e}).apply(this,arguments)};function f(e,t,i){for(var a,d=0,v=t.length;d<v;d++)!a&&d in t||((a=a||Array.prototype.slice.call(t,0,d))[d]=t[d]);return e.concat(a||Array.prototype.slice.call(t))}var c=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Xo,u=Object.keys,y=Array.isArray;function b(e,t){return typeof t!="object"||u(t).forEach(function(i){e[i]=t[i]}),e}typeof Promise>"u"||c.Promise||(c.Promise=Promise);var l=Object.getPrototypeOf,m={}.hasOwnProperty;function h(e,t){return m.call(e,t)}function k(e,t){typeof t=="function"&&(t=t(l(e))),(typeof Reflect>"u"?u:Reflect.ownKeys)(t).forEach(function(i){N(e,i,t[i])})}var E=Object.defineProperty;function N(e,t,i,a){E(e,t,b(i&&h(i,"get")&&typeof i.get=="function"?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},a))}function D(e){return{from:function(t){return e.prototype=Object.create(t.prototype),N(e.prototype,"constructor",e),{extend:k.bind(null,e.prototype)}}}}var z=Object.getOwnPropertyDescriptor,ee=[].slice;function X(e,t,i){return ee.call(e,t,i)}function B(e,t){return t(e)}function de(e){if(!e)throw new Error("Assertion Failed")}function ne(e){c.setImmediate?setImmediate(e):setTimeout(e,0)}function se(e,t){if(typeof t=="string"&&h(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var i=[],a=0,d=t.length;a<d;++a){var v=se(e,t[a]);i.push(v)}return i}var S=t.indexOf(".");if(S!==-1){var O=e[t.substr(0,S)];return O==null?void 0:se(O,t.substr(S+1))}}function oe(e,t,i){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){de(typeof i!="string"&&"length"in i);for(var a=0,d=t.length;a<d;++a)oe(e,t[a],i[a])}else{var v,S,O=t.indexOf(".");O!==-1?(v=t.substr(0,O),(S=t.substr(O+1))===""?i===void 0?y(e)&&!isNaN(parseInt(v))?e.splice(v,1):delete e[v]:e[v]=i:oe(O=!(O=e[v])||!h(e,v)?e[v]={}:O,S,i)):i===void 0?y(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=i}}function Le(e){var t,i={};for(t in e)h(e,t)&&(i[t]=e[t]);return i}var I=[].concat;function g(e){return I.apply([],e)}var He="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(g([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return c[e]}),C=new Set(He.map(function(e){return c[e]})),K=null;function ke(e){return K=new WeakMap,e=function t(i){if(!i||typeof i!="object")return i;var a=K.get(i);if(a)return a;if(y(i)){a=[],K.set(i,a);for(var d=0,v=i.length;d<v;++d)a.push(t(i[d]))}else if(C.has(i.constructor))a=i;else{var S,O=l(i);for(S in a=O===Object.prototype?{}:Object.create(O),K.set(i,a),i)h(i,S)&&(a[S]=t(i[S]))}return a}(e),K=null,e}var be={}.toString;function Oe(e){return be.call(e).slice(8,-1)}var re=typeof Symbol<"u"?Symbol.iterator:"@@iterator",me=typeof re=="symbol"?function(e){var t;return e!=null&&(t=e[re])&&t.apply(e)}:function(){return null};function ce(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var Ue={};function De(e){var t,i,a,d;if(arguments.length===1){if(y(e))return e.slice();if(this===Ue&&typeof e=="string")return[e];if(d=me(e)){for(i=[];!(a=d.next()).done;)i.push(a.value);return i}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(i=new Array(t);t--;)i[t]=e[t];return i}for(t=arguments.length,i=new Array(t);t--;)i[t]=arguments[t];return i}var xe=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},it=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Yt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(it),Ce={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Fe(e,t){this.name=e,this.message=t}function Ne(e,t){return e+". Errors: "+Object.keys(t).map(function(i){return t[i].toString()}).filter(function(i,a,d){return d.indexOf(i)===a}).join(`
`)}function Me(e,t,i,a){this.failures=t,this.failedKeys=a,this.successCount=i,this.message=Ne(e,t)}function Xe(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(i){return t[i]}),this.failuresByPos=t,this.message=Ne(e,this.failures)}D(Fe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),D(Me).from(Fe),D(Xe).from(Fe);var J=Yt.reduce(function(e,t){return e[t]=t+"Error",e},{}),Y=Fe,$=Yt.reduce(function(e,t){var i=t+"Error";function a(d,v){this.name=i,d?typeof d=="string"?(this.message="".concat(d).concat(v?`
 `+v:""),this.inner=v||null):typeof d=="object"&&(this.message="".concat(d.name," ").concat(d.message),this.inner=d):(this.message=Ce[t]||i,this.inner=null)}return D(a).from(Y),e[t]=a,e},{});$.Syntax=SyntaxError,$.Type=TypeError,$.Range=RangeError;var H=it.reduce(function(e,t){return e[t+"Error"]=$[t],e},{}),ie=Yt.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=$[t]),e},{});function fe(){}function Ee(e){return e}function Ae(e,t){return e==null||e===Ee?t:function(i){return t(e(i))}}function he(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ut(e,t){return e===fe?t:function(){var i=e.apply(this,arguments);i!==void 0&&(arguments[0]=i);var a=this.onsuccess,d=this.onerror;this.onsuccess=null,this.onerror=null;var v=t.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?he(a,this.onsuccess):a),d&&(this.onerror=this.onerror?he(d,this.onerror):d),v!==void 0?v:i}}function wt(e,t){return e===fe?t:function(){e.apply(this,arguments);var i=this.onsuccess,a=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?he(i,this.onsuccess):i),a&&(this.onerror=this.onerror?he(a,this.onerror):a)}}function mt(e,t){return e===fe?t:function(i){var a=e.apply(this,arguments);b(i,a);var d=this.onsuccess,v=this.onerror;return this.onsuccess=null,this.onerror=null,i=t.apply(this,arguments),d&&(this.onsuccess=this.onsuccess?he(d,this.onsuccess):d),v&&(this.onerror=this.onerror?he(v,this.onerror):v),a===void 0?i===void 0?void 0:i:b(a,i)}}function zt(e,t){return e===fe?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function $t(e,t){return e===fe?t:function(){var i=e.apply(this,arguments);if(i&&typeof i.then=="function"){for(var a=this,d=arguments.length,v=new Array(d);d--;)v[d]=arguments[d];return i.then(function(){return t.apply(a,v)})}return t.apply(this,arguments)}}ie.ModifyError=Me,ie.DexieError=Fe,ie.BulkError=Xe;var kt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Bt(e){kt=e}var Ct={},bt=100,He=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,l(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,l(t),e]}(),it=He[0],Yt=He[1],He=He[2],Yt=Yt&&Yt.then,Ze=it&&it.constructor,pt=!!He,Be=function(e,t){Re.push([e,t]),p&&(queueMicrotask(qe),p=!1)},_=!0,p=!0,w=[],A=[],q=Ee,ue={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:fe,pgp:!1,env:{},finalize:fe},G=ue,Re=[],Se=0,$e=[];function te(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=G;if(typeof e!="function"){if(e!==Ct)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&et(this,this._value))}this._state=null,this._value=null,++t.ref,function i(a,d){try{d(function(v){if(a._state===null){if(v===a)throw new TypeError("A promise cannot be resolved with itself.");var S=a._lib&&gt();v&&typeof v.then=="function"?i(a,function(O,T){v instanceof te?v._then(O,T):v.then(O,T)}):(a._state=!0,a._value=v,tt(a)),S&&Te()}},et.bind(null,a))}catch(v){et(a,v)}}(this,e)}var ze={get:function(){var e=G,t=Et;function i(a,d){var v=this,S=!e.global&&(e!==G||t!==Et),O=S&&!ot(),T=new te(function(P,L){ct(v,new st(On(a,e,S,O),On(d,e,S,O),P,L,e))});return this._consoleTask&&(T._consoleTask=this._consoleTask),T}return i.prototype=Ct,i},set:function(e){N(this,"then",e&&e.prototype===Ct?ze:{get:function(){return e},set:ze.set})}};function st(e,t,i,a,d){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=i,this.reject=a,this.psd=d}function et(e,t){var i,a;A.push(t),e._state===null&&(i=e._lib&&gt(),t=q(t),e._state=!1,e._value=t,a=e,w.some(function(d){return d._value===a._value})||w.push(a),tt(e),i&&Te())}function tt(e){var t=e._listeners;e._listeners=[];for(var i=0,a=t.length;i<a;++i)ct(e,t[i]);var d=e._PSD;--d.ref||d.finalize(),Se===0&&(++Se,Be(function(){--Se==0&&ye()},[]))}function ct(e,t){if(e._state!==null){var i=e._state?t.onFulfilled:t.onRejected;if(i===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Se,Be(lt,[i,e,t])}else e._listeners.push(t)}function lt(e,t,i){try{var a,d=t._value;!t._state&&A.length&&(A=[]),a=kt&&t._consoleTask?t._consoleTask.run(function(){return e(d)}):e(d),t._state||A.indexOf(d)!==-1||function(v){for(var S=w.length;S;)if(w[--S]._value===v._value)return w.splice(S,1)}(t),i.resolve(a)}catch(v){i.reject(v)}finally{--Se==0&&ye(),--i.psd.ref||i.psd.finalize()}}function qe(){Qt(ue,function(){gt()&&Te()})}function gt(){var e=_;return p=_=!1,e}function Te(){var e,t,i;do for(;0<Re.length;)for(e=Re,Re=[],i=e.length,t=0;t<i;++t){var a=e[t];a[0].apply(null,a[1])}while(0<Re.length);p=_=!0}function ye(){var e=w;w=[],e.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)});for(var t=$e.slice(0),i=t.length;i;)t[--i]()}function Ke(e){return new te(Ct,!1,e)}function we(e,t){var i=G;return function(){var a=gt(),d=G;try{return Ot(i,!0),e.apply(this,arguments)}catch(v){t&&t(v)}finally{Ot(d,!1),a&&Te()}}}k(te.prototype,{then:ze,_then:function(e,t){ct(this,new st(null,null,e,t,G))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,i=arguments[1];return typeof t=="function"?this.then(null,function(a){return(a instanceof t?i:Ke)(a)}):this.then(null,function(a){return(a&&a.name===t?i:Ke)(a)})},finally:function(e){return this.then(function(t){return te.resolve(e()).then(function(){return t})},function(t){return te.resolve(e()).then(function(){return Ke(t)})})},timeout:function(e,t){var i=this;return e<1/0?new te(function(a,d){var v=setTimeout(function(){return d(new $.Timeout(t))},e);i.then(a,d).finally(clearTimeout.bind(null,v))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&N(te.prototype,Symbol.toStringTag,"Dexie.Promise"),ue.env=qt(),k(te,{all:function(){var e=De.apply(null,arguments).map(It);return new te(function(t,i){e.length===0&&t([]);var a=e.length;e.forEach(function(d,v){return te.resolve(d).then(function(S){e[v]=S,--a||t(e)},i)})})},resolve:function(e){return e instanceof te?e:e&&typeof e.then=="function"?new te(function(t,i){e.then(t,i)}):new te(Ct,!0,e)},reject:Ke,race:function(){var e=De.apply(null,arguments).map(It);return new te(function(t,i){e.map(function(a){return te.resolve(a).then(t,i)})})},PSD:{get:function(){return G},set:function(e){return G=e}},totalEchoes:{get:function(){return Et}},newPSD:Qe,usePSD:Qt,scheduler:{get:function(){return Be},set:function(e){Be=e}},rejectionMapper:{get:function(){return q},set:function(e){q=e}},follow:function(e,t){return new te(function(i,a){return Qe(function(d,v){var S=G;S.unhandleds=[],S.onunhandled=v,S.finalize=he(function(){var O,T=this;O=function(){T.unhandleds.length===0?d():v(T.unhandleds[0])},$e.push(function P(){O(),$e.splice($e.indexOf(P),1)}),++Se,Be(function(){--Se==0&&ye()},[])},S.finalize),e()},t,i,a)})}}),Ze&&(Ze.allSettled&&N(te,"allSettled",function(){var e=De.apply(null,arguments).map(It);return new te(function(t){e.length===0&&t([]);var i=e.length,a=new Array(i);e.forEach(function(d,v){return te.resolve(d).then(function(S){return a[v]={status:"fulfilled",value:S}},function(S){return a[v]={status:"rejected",reason:S}}).then(function(){return--i||t(a)})})})}),Ze.any&&typeof AggregateError<"u"&&N(te,"any",function(){var e=De.apply(null,arguments).map(It);return new te(function(t,i){e.length===0&&i(new AggregateError([]));var a=e.length,d=new Array(a);e.forEach(function(v,S){return te.resolve(v).then(function(O){return t(O)},function(O){d[S]=O,--a||i(new AggregateError(d))})})})}),Ze.withResolvers&&(te.withResolvers=Ze.withResolvers));var Pe={awaits:0,echoes:0,id:0},Ge=0,Pt=[],ft=0,Et=0,Mt=0;function Qe(e,t,i,a){var d=G,v=Object.create(d);return v.parent=d,v.ref=0,v.global=!1,v.id=++Mt,ue.env,v.env=pt?{Promise:te,PromiseProp:{value:te,configurable:!0,writable:!0},all:te.all,race:te.race,allSettled:te.allSettled,any:te.any,resolve:te.resolve,reject:te.reject}:{},t&&b(v,t),++d.ref,v.finalize=function(){--this.parent.ref||this.parent.finalize()},a=Qt(v,e,i,a),v.ref===0&&v.finalize(),a}function At(){return Pe.id||(Pe.id=++Ge),++Pe.awaits,Pe.echoes+=bt,Pe.id}function ot(){return!!Pe.awaits&&(--Pe.awaits==0&&(Pe.id=0),Pe.echoes=Pe.awaits*bt,!0)}function It(e){return Pe.echoes&&e&&e.constructor===Ze?(At(),e.then(function(t){return ot(),t},function(t){return ot(),ht(t)})):e}function Nt(){var e=Pt[Pt.length-1];Pt.pop(),Ot(e,!1)}function Ot(e,t){var i,a=G;(t?!Pe.echoes||ft++&&e===G:!ft||--ft&&e===G)||queueMicrotask(t?(function(d){++Et,Pe.echoes&&--Pe.echoes!=0||(Pe.echoes=Pe.awaits=Pe.id=0),Pt.push(G),Ot(d,!0)}).bind(null,e):Nt),e!==G&&(G=e,a===ue&&(ue.env=qt()),pt&&(i=ue.env.Promise,t=e.env,(a.global||e.global)&&(Object.defineProperty(c,"Promise",t.PromiseProp),i.all=t.all,i.race=t.race,i.resolve=t.resolve,i.reject=t.reject,t.allSettled&&(i.allSettled=t.allSettled),t.any&&(i.any=t.any))))}function qt(){var e=c.Promise;return pt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(c,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Qt(e,t,i,a,d){var v=G;try{return Ot(e,!0),t(i,a,d)}finally{Ot(v,!1)}}function On(e,t,i,a){return typeof e!="function"?e:function(){var d=G;i&&At(),Ot(t,!0);try{return e.apply(this,arguments)}finally{Ot(d,!1),a&&queueMicrotask(ot)}}}function nn(e){Promise===Ze&&Pe.echoes===0?ft===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Yt).indexOf("[native code]")===-1&&(At=ot=fe);var ht=te.reject,Rt="ï¿¿",yt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Gt="String expected.",Vt=[],cn="__dbnames",ii="readonly",oi="readwrite";function xn(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var mo={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function vr(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=ke(t))[e],t}}function bo(){throw $.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function rt(e,t){try{var i=go(e),a=go(t);if(i!==a)return i==="Array"?1:a==="Array"?-1:i==="binary"?1:a==="binary"?-1:i==="string"?1:a==="string"?-1:i==="Date"?1:a!=="Date"?NaN:-1;switch(i){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(d,v){for(var S=d.length,O=v.length,T=S<O?S:O,P=0;P<T;++P)if(d[P]!==v[P])return d[P]<v[P]?-1:1;return S===O?0:S<O?-1:1}(wo(e),wo(t));case"Array":return function(d,v){for(var S=d.length,O=v.length,T=S<O?S:O,P=0;P<T;++P){var L=rt(d[P],v[P]);if(L!==0)return L}return S===O?0:S<O?-1:1}(e,t)}}catch{}return NaN}function go(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=Oe(e),e==="ArrayBuffer"?"binary":e)}function wo(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function mr(e,t,i){var a=e.schema.yProps;return a?(t&&0<i.numFailures&&(t=t.filter(function(d,v){return!i.failures[v]})),Promise.all(a.map(function(d){return d=d.updatesTable,t?e.db.table(d).where("k").anyOf(t).delete():e.db.table(d).clear()})).then(function(){return i})):i}var qn=(_o.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var i=t.add;if(y(i))return f(f([],y(e)?e:[],!0),i).sort();if(typeof i=="number")return(Number(e)||0)+i;if(typeof i=="bigint")try{return BigInt(e)+i}catch{return BigInt(0)+i}throw new TypeError("Invalid term ".concat(i))}if(t.remove!==void 0){var a=t.remove;if(y(a))return y(e)?e.filter(function(d){return!a.includes(d)}).sort():[];if(typeof a=="number")return Number(e)-a;if(typeof a=="bigint")try{return BigInt(e)-a}catch{return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return i=(i=t.replacePrefix)===null||i===void 0?void 0:i[0],i&&typeof e=="string"&&e.startsWith(i)?t.replacePrefix[1]+e.substring(i.length):e},_o);function _o(e){this["@@propmod"]=e}function So(e,t){for(var i=u(t),a=i.length,d=!1,v=0;v<a;++v){var S=i[v],O=t[S],T=se(e,S);O instanceof qn?(oe(e,S,O.execute(T)),d=!0):T!==O&&(oe(e,S,O),d=!0)}return d}var ko=(dt.prototype._trans=function(e,t,i){var a=this._tx||G.trans,d=this.name,v=kt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function S(P,L,x){if(!x.schema[d])throw new $.NotFound("Table "+d+" not part of transaction");return t(x.idbtrans,x)}var O=gt();try{var T=a&&a.db._novip===this.db._novip?a===G.trans?a._promise(e,S,i):Qe(function(){return a._promise(e,S,i)},{trans:a,transless:G.transless||G}):function P(L,x,M,j){if(L.idbdb&&(L._state.openComplete||G.letThrough||L._vip)){var R=L._createTransaction(x,M,L._dbSchema);try{R.create(),L._state.PR1398_maxLoop=3}catch(U){return U.name===J.InvalidState&&L.isOpen()&&0<--L._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),L.close({disableAutoOpen:!1}),L.open().then(function(){return P(L,x,M,j)})):ht(U)}return R._promise(x,function(U,F){return Qe(function(){return G.trans=R,j(U,F,R)})}).then(function(U){if(x==="readwrite")try{R.idbtrans.commit()}catch{}return x==="readonly"?U:R._completion.then(function(){return U})})}if(L._state.openComplete)return ht(new $.DatabaseClosed(L._state.dbOpenError));if(!L._state.isBeingOpened){if(!L._state.autoOpen)return ht(new $.DatabaseClosed);L.open().catch(fe)}return L._state.dbReadyPromise.then(function(){return P(L,x,M,j)})}(this.db,e,[this.name],S);return v&&(T._consoleTask=v,T=T.catch(function(P){return console.trace(P),ht(P)})),T}finally{O&&Te()}},dt.prototype.get=function(e,t){var i=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?ht(new $.Type("Invalid argument to Table.get()")):this._trans("readonly",function(a){return i.core.get({trans:a,key:e}).then(function(d){return i.hook.reading.fire(d)})}).then(t)},dt.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(y(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=u(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var i=this.schema.indexes.concat(this.schema.primKey).filter(function(O){if(O.compound&&t.every(function(P){return 0<=O.keyPath.indexOf(P)})){for(var T=0;T<t.length;++T)if(t.indexOf(O.keyPath[T])===-1)return!1;return!0}return!1}).sort(function(O,T){return O.keyPath.length-T.keyPath.length})[0];if(i&&this.db._maxKey!==Rt){var v=i.keyPath.slice(0,t.length);return this.where(v).equals(v.map(function(T){return e[T]}))}!i&&kt&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var a=this.schema.idxByName;function d(O,T){return rt(O,T)===0}var S=t.reduce(function(x,T){var P=x[0],L=x[1],x=a[T],M=e[T];return[P||x,P||!x?xn(L,x&&x.multi?function(j){return j=se(j,T),y(j)&&j.some(function(R){return d(M,R)})}:function(j){return d(M,se(j,T))}):L]},[null,null]),v=S[0],S=S[1];return v?this.where(v.name).equals(e[v.keyPath]).filter(S):i?this.filter(S):this.where(t).equals("")},dt.prototype.filter=function(e){return this.toCollection().and(e)},dt.prototype.count=function(e){return this.toCollection().count(e)},dt.prototype.offset=function(e){return this.toCollection().offset(e)},dt.prototype.limit=function(e){return this.toCollection().limit(e)},dt.prototype.each=function(e){return this.toCollection().each(e)},dt.prototype.toArray=function(e){return this.toCollection().toArray(e)},dt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},dt.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,y(e)?"[".concat(e.join("+"),"]"):e))},dt.prototype.reverse=function(){return this.toCollection().reverse()},dt.prototype.mapToClass=function(e){var t,i=this.db,a=this.name;function d(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof bo&&(function(T,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function L(){this.constructor=T}o(T,P),T.prototype=P===null?Object.create(P):(L.prototype=P.prototype,new L)}(d,t=e),Object.defineProperty(d.prototype,"db",{get:function(){return i},enumerable:!1,configurable:!0}),d.prototype.table=function(){return a},e=d);for(var v=new Set,S=e.prototype;S;S=l(S))Object.getOwnPropertyNames(S).forEach(function(T){return v.add(T)});function O(T){if(!T)return T;var P,L=Object.create(e.prototype);for(P in T)if(!v.has(P))try{L[P]=T[P]}catch{}return L}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=O,this.hook("reading",O),e},dt.prototype.defineClass=function(){return this.mapToClass(function(e){b(this,e)})},dt.prototype.add=function(e,t){var i=this,a=this.schema.primKey,d=a.auto,v=a.keyPath,S=e;return v&&d&&(S=vr(v)(e)),this._trans("readwrite",function(O){return i.core.mutate({trans:O,type:"add",keys:t!=null?[t]:null,values:[S]})}).then(function(O){return O.numFailures?te.reject(O.failures[0]):O.lastResult}).then(function(O){if(v)try{oe(e,v,O)}catch{}return O})},dt.prototype.upsert=function(e,t){var i=this,a=this.schema.primKey.keyPath;return this._trans("readwrite",function(d){return i.core.get({trans:d,key:e}).then(function(v){var S=v!=null?v:{};return So(S,t),a&&oe(S,a,e),i.core.mutate({trans:d,type:"put",values:[S],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(O){return O.numFailures?te.reject(O.failures[0]):!!v})})})},dt.prototype.update=function(e,t){return typeof e!="object"||y(e)?this.where(":id").equals(e).modify(t):(e=se(e,this.schema.primKey.keyPath),e===void 0?ht(new $.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},dt.prototype.put=function(e,t){var i=this,a=this.schema.primKey,d=a.auto,v=a.keyPath,S=e;return v&&d&&(S=vr(v)(e)),this._trans("readwrite",function(O){return i.core.mutate({trans:O,type:"put",values:[S],keys:t!=null?[t]:null})}).then(function(O){return O.numFailures?te.reject(O.failures[0]):O.lastResult}).then(function(O){if(v)try{oe(e,v,O)}catch{}return O})},dt.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"delete",keys:[e]}).then(function(a){return mr(t,[e],a)}).then(function(a){return a.numFailures?te.reject(a.failures[0]):void 0})})},dt.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:mo}).then(function(i){return mr(e,null,i)})}).then(function(t){return t.numFailures?te.reject(t.failures[0]):void 0})},dt.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(i){return t.core.getMany({keys:e,trans:i}).then(function(a){return a.map(function(d){return t.hook.reading.fire(d)})})})},dt.prototype.bulkAdd=function(e,t,i){var a=this,d=Array.isArray(t)?t:void 0,v=(i=i||(d?void 0:t))?i.allKeys:void 0;return this._trans("readwrite",function(S){var P=a.schema.primKey,O=P.auto,P=P.keyPath;if(P&&d)throw new $.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(d&&d.length!==e.length)throw new $.InvalidArgument("Arguments objects and keys must have the same length");var T=e.length,P=P&&O?e.map(vr(P)):e;return a.core.mutate({trans:S,type:"add",keys:d,values:P,wantResults:v}).then(function(R){var x=R.numFailures,M=R.results,j=R.lastResult,R=R.failures;if(x===0)return v?M:j;throw new Xe("".concat(a.name,".bulkAdd(): ").concat(x," of ").concat(T," operations failed"),R)})})},dt.prototype.bulkPut=function(e,t,i){var a=this,d=Array.isArray(t)?t:void 0,v=(i=i||(d?void 0:t))?i.allKeys:void 0;return this._trans("readwrite",function(S){var P=a.schema.primKey,O=P.auto,P=P.keyPath;if(P&&d)throw new $.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(d&&d.length!==e.length)throw new $.InvalidArgument("Arguments objects and keys must have the same length");var T=e.length,P=P&&O?e.map(vr(P)):e;return a.core.mutate({trans:S,type:"put",keys:d,values:P,wantResults:v}).then(function(R){var x=R.numFailures,M=R.results,j=R.lastResult,R=R.failures;if(x===0)return v?M:j;throw new Xe("".concat(a.name,".bulkPut(): ").concat(x," of ").concat(T," operations failed"),R)})})},dt.prototype.bulkUpdate=function(e){var t=this,i=this.core,a=e.map(function(S){return S.key}),d=e.map(function(S){return S.changes}),v=[];return this._trans("readwrite",function(S){return i.getMany({trans:S,keys:a,cache:"clone"}).then(function(O){var T=[],P=[];e.forEach(function(x,M){var j=x.key,R=x.changes,U=O[M];if(U){for(var F=0,V=Object.keys(R);F<V.length;F++){var W=V[F],Q=R[W];if(W===t.schema.primKey.keyPath){if(rt(Q,j)!==0)throw new $.Constraint("Cannot update primary key in bulkUpdate()")}else oe(U,W,Q)}v.push(M),T.push(j),P.push(U)}});var L=T.length;return i.mutate({trans:S,type:"put",keys:T,values:P,updates:{keys:a,changeSpecs:d}}).then(function(x){var M=x.numFailures,j=x.failures;if(M===0)return L;for(var R=0,U=Object.keys(j);R<U.length;R++){var F,V=U[R],W=v[Number(V)];W!=null&&(F=j[V],delete j[V],j[W]=F)}throw new Xe("".concat(t.name,".bulkUpdate(): ").concat(M," of ").concat(L," operations failed"),j)})})})},dt.prototype.bulkDelete=function(e){var t=this,i=e.length;return this._trans("readwrite",function(a){return t.core.mutate({trans:a,type:"delete",keys:e}).then(function(d){return mr(t,e,d)})}).then(function(S){var d=S.numFailures,v=S.lastResult,S=S.failures;if(d===0)return v;throw new Xe("".concat(t.name,".bulkDelete(): ").concat(d," of ").concat(i," operations failed"),S)})},dt);function dt(){}function Vn(e){function t(S,O){if(O){for(var T=arguments.length,P=new Array(T-1);--T;)P[T-1]=arguments[T];return i[S].subscribe.apply(null,P),e}if(typeof S=="string")return i[S]}var i={};t.addEventType=v;for(var a=1,d=arguments.length;a<d;++a)v(arguments[a]);return t;function v(S,O,T){if(typeof S!="object"){var P;O=O||zt;var L={subscribers:[],fire:T=T||fe,subscribe:function(x){L.subscribers.indexOf(x)===-1&&(L.subscribers.push(x),L.fire=O(L.fire,x))},unsubscribe:function(x){L.subscribers=L.subscribers.filter(function(M){return M!==x}),L.fire=L.subscribers.reduce(O,T)}};return i[S]=t[S]=L}u(P=S).forEach(function(x){var M=P[x];if(y(M))v(x,P[x][0],P[x][1]);else{if(M!=="asap")throw new $.InvalidArgument("Invalid event config");var j=v(x,Ee,function(){for(var R=arguments.length,U=new Array(R);R--;)U[R]=arguments[R];j.subscribers.forEach(function(F){ne(function(){F.apply(null,U)})})})}})}}function Wn(e,t){return D(t).from({prototype:e}),t}function Cn(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function si(e,t){e.filter=xn(e.filter,t)}function ai(e,t,i){var a=e.replayFilter;e.replayFilter=a?function(){return xn(a(),t())}:t,e.justLimit=i&&!a}function br(e,t){if(e.isPrimKey)return t.primaryKey;var i=t.getIndexByKeyPath(e.index);if(!i)throw new $.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return i}function Oo(e,t,i){var a=br(e,t.schema);return t.openCursor({trans:i,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:a,range:e.range}})}function gr(e,t,i,a){var d=e.replayFilter?xn(e.filter,e.replayFilter()):e.filter;if(e.or){var v={},S=function(O,T,P){var L,x;d&&!d(T,P,function(M){return T.stop(M)},function(M){return T.fail(M)})||((x=""+(L=T.primaryKey))=="[object ArrayBuffer]"&&(x=""+new Uint8Array(L)),h(v,x)||(v[x]=!0,t(O,T,P)))};return Promise.all([e.or._iterate(S,i),xo(Oo(e,a,i),e.algorithm,S,!e.keysOnly&&e.valueMapper)])}return xo(Oo(e,a,i),xn(e.algorithm,d),t,!e.keysOnly&&e.valueMapper)}function xo(e,t,i,a){var d=we(a?function(v,S,O){return i(a(v),S,O)}:i);return e.then(function(v){if(v)return v.start(function(){var S=function(){return v.continue()};t&&!t(v,function(O){return S=O},function(O){v.stop(O),S=fe},function(O){v.fail(O),S=fe})||d(v.value,v,function(O){return S=O}),S()})})}var Ra=(at.prototype._read=function(e,t){var i=this._ctx;return i.error?i.table._trans(null,ht.bind(null,i.error)):i.table._trans("readonly",e).then(t)},at.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,ht.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},at.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=xn(t.algorithm,e)},at.prototype._iterate=function(e,t){return gr(this._ctx,e,t,this._ctx.table.core)},at.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),i=Object.create(this._ctx);return e&&b(i,e),t._ctx=i,t},at.prototype.raw=function(){return this._ctx.valueMapper=null,this},at.prototype.each=function(e){var t=this._ctx;return this._read(function(i){return gr(t,e,i,t.table.core)})},at.prototype.count=function(e){var t=this;return this._read(function(i){var a=t._ctx,d=a.table.core;if(Cn(a,!0))return d.count({trans:i,query:{index:br(a,d.schema),range:a.range}}).then(function(S){return Math.min(S,a.limit)});var v=0;return gr(a,function(){return++v,!1},i,d).then(function(){return v})}).then(e)},at.prototype.sortBy=function(e,t){var i=e.split(".").reverse(),a=i[0],d=i.length-1;function v(T,P){return P?v(T[i[P]],P-1):T[a]}var S=this._ctx.dir==="next"?1:-1;function O(T,P){return rt(v(T,d),v(P,d))*S}return this.toArray(function(T){return T.sort(O)}).then(t)},at.prototype.toArray=function(e){var t=this;return this._read(function(i){var a=t._ctx;if(a.dir==="next"&&Cn(a,!0)&&0<a.limit){var d=a.valueMapper,v=br(a,a.table.core.schema);return a.table.core.query({trans:i,limit:a.limit,values:!0,query:{index:v,range:a.range}}).then(function(O){return O=O.result,d?O.map(d):O})}var S=[];return gr(a,function(O){return S.push(O)},i,a.table.core).then(function(){return S})},e)},at.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Cn(t)?ai(t,function(){var i=e;return function(a,d){return i===0||(i===1?--i:d(function(){a.advance(i),i=0}),!1)}}):ai(t,function(){var i=e;return function(){return--i<0}})),this},at.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),ai(this._ctx,function(){var t=e;return function(i,a,d){return--t<=0&&a(d),0<=t}},!0),this},at.prototype.until=function(e,t){return si(this._ctx,function(i,a,d){return!e(i.value)||(a(d),t)}),this},at.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},at.prototype.last=function(e){return this.reverse().first(e)},at.prototype.filter=function(e){var t;return si(this._ctx,function(i){return e(i.value)}),(t=this._ctx).isMatch=xn(t.isMatch,e),this},at.prototype.and=function(e){return this.filter(e)},at.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},at.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},at.prototype.desc=function(){return this.reverse()},at.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(i,a){e(a.key,a)})},at.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},at.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(i,a){e(a.primaryKey,a)})},at.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var i=[];return this.each(function(a,d){i.push(d.key)}).then(function(){return i}).then(e)},at.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Cn(t,!0)&&0<t.limit)return this._read(function(a){var d=br(t,t.table.core.schema);return t.table.core.query({trans:a,values:!1,limit:t.limit,query:{index:d,range:t.range}})}).then(function(a){return a.result}).then(e);t.keysOnly=!t.isMatch;var i=[];return this.each(function(a,d){i.push(d.primaryKey)}).then(function(){return i}).then(e)},at.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},at.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},at.prototype.lastKey=function(e){return this.reverse().firstKey(e)},at.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return si(this._ctx,function(d){var a=d.primaryKey.toString(),d=h(t,a);return t[a]=!0,!d}),this},at.prototype.modify=function(e){var t=this,i=this._ctx;return this._write(function(a){var d=typeof e=="function"?e:function(U){return So(U,e)},v=i.table.core,P=v.schema.primaryKey,S=P.outbound,O=P.extractKey,T=200,P=t.db._options.modifyChunkSize;P&&(T=typeof P=="object"?P[v.name]||P["*"]||200:P);function L(U,W){var V=W.failures,W=W.numFailures;M+=U-W;for(var Q=0,Z=u(V);Q<Z.length;Q++){var le=Z[Q];x.push(V[le])}}var x=[],M=0,j=[],R=e===Eo;return t.clone().primaryKeys().then(function(U){function F(W){var Q=Math.min(T,U.length-W),Z=U.slice(W,W+Q);return(R?Promise.resolve([]):v.getMany({trans:a,keys:Z,cache:"immutable"})).then(function(le){var ge=[],ae=[],pe=S?[]:null,_e=R?Z:[];if(!R)for(var ve=0;ve<Q;++ve){var Ie=le[ve],We={value:ke(Ie),primKey:U[W+ve]};d.call(We,We.value,We)!==!1&&(We.value==null?_e.push(U[W+ve]):S||rt(O(Ie),O(We.value))===0?(ae.push(We.value),S&&pe.push(U[W+ve])):(_e.push(U[W+ve]),ge.push(We.value)))}return Promise.resolve(0<ge.length&&v.mutate({trans:a,type:"add",values:ge}).then(function(Je){for(var Ye in Je.failures)_e.splice(parseInt(Ye),1);L(ge.length,Je)})).then(function(){return(0<ae.length||V&&typeof e=="object")&&v.mutate({trans:a,type:"put",keys:pe,values:ae,criteria:V,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<W}).then(function(Je){return L(ae.length,Je)})}).then(function(){return(0<_e.length||V&&R)&&v.mutate({trans:a,type:"delete",keys:_e,criteria:V,isAdditionalChunk:0<W}).then(function(Je){return mr(i.table,_e,Je)}).then(function(Je){return L(_e.length,Je)})}).then(function(){return U.length>W+Q&&F(W+T)})})}var V=Cn(i)&&i.limit===1/0&&(typeof e!="function"||R)&&{index:i.index,range:i.range};return F(0).then(function(){if(0<x.length)throw new Me("Error modifying one or more objects",x,M,j);return U.length})})})},at.prototype.delete=function(){var e=this._ctx,t=e.range;return!Cn(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(Eo):this._write(function(i){var a=e.table.core.schema.primaryKey,d=t;return e.table.core.count({trans:i,query:{index:a,range:d}}).then(function(v){return e.table.core.mutate({trans:i,type:"deleteRange",range:d}).then(function(T){var O=T.failures,T=T.numFailures;if(T)throw new Me("Could not delete some values",Object.keys(O).map(function(P){return O[P]}),v-T);return v-T})})})},at);function at(){}var Eo=function(e,t){return t.value=null};function Ua(e,t){return e<t?-1:e===t?0:1}function Da(e,t){return t<e?-1:e===t?0:1}function Jt(e,t,i){return e=e instanceof To?new e.Collection(e):e,e._ctx.error=new(i||TypeError)(t),e}function Nn(e){return new e.Collection(e,function(){return Ao("")}).limit(0)}function wr(e,t,i,a){var d,v,S,O,T,P,L,x=i.length;if(!i.every(function(R){return typeof R=="string"}))return Jt(e,Gt);function M(R){d=R==="next"?function(F){return F.toUpperCase()}:function(F){return F.toLowerCase()},v=R==="next"?function(F){return F.toLowerCase()}:function(F){return F.toUpperCase()},S=R==="next"?Ua:Da;var U=i.map(function(F){return{lower:v(F),upper:d(F)}}).sort(function(F,V){return S(F.lower,V.lower)});O=U.map(function(F){return F.upper}),T=U.map(function(F){return F.lower}),L=(P=R)==="next"?"":a}M("next"),e=new e.Collection(e,function(){return vn(O[0],T[x-1]+a)}),e._ondirectionchange=function(R){M(R)};var j=0;return e._addAlgorithm(function(R,U,F){var V=R.key;if(typeof V!="string")return!1;var W=v(V);if(t(W,T,j))return!0;for(var Q=null,Z=j;Z<x;++Z){var le=function(ge,ae,pe,_e,ve,Ie){for(var We=Math.min(ge.length,_e.length),Je=-1,Ye=0;Ye<We;++Ye){var Ht=ae[Ye];if(Ht!==_e[Ye])return ve(ge[Ye],pe[Ye])<0?ge.substr(0,Ye)+pe[Ye]+pe.substr(Ye+1):ve(ge[Ye],_e[Ye])<0?ge.substr(0,Ye)+_e[Ye]+pe.substr(Ye+1):0<=Je?ge.substr(0,Je)+ae[Je]+pe.substr(Je+1):null;ve(ge[Ye],Ht)<0&&(Je=Ye)}return We<_e.length&&Ie==="next"?ge+pe.substr(ge.length):We<ge.length&&Ie==="prev"?ge.substr(0,pe.length):Je<0?null:ge.substr(0,Je)+_e[Je]+pe.substr(Je+1)}(V,W,O[Z],T[Z],S,P);le===null&&Q===null?j=Z+1:(Q===null||0<S(Q,le))&&(Q=le)}return U(Q!==null?function(){R.continue(Q+L)}:F),!1}),e}function vn(e,t,i,a){return{type:2,lower:e,upper:t,lowerOpen:i,upperOpen:a}}function Ao(e){return{type:1,lower:e,upper:e}}var To=(Object.defineProperty(jt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),jt.prototype.between=function(e,t,i,a){i=i!==!1,a=a===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(i||a)&&(!i||!a)?Nn(this):new this.Collection(this,function(){return vn(e,t,!i,!a)})}catch{return Jt(this,yt)}},jt.prototype.equals=function(e){return e==null?Jt(this,yt):new this.Collection(this,function(){return Ao(e)})},jt.prototype.above=function(e){return e==null?Jt(this,yt):new this.Collection(this,function(){return vn(e,void 0,!0)})},jt.prototype.aboveOrEqual=function(e){return e==null?Jt(this,yt):new this.Collection(this,function(){return vn(e,void 0,!1)})},jt.prototype.below=function(e){return e==null?Jt(this,yt):new this.Collection(this,function(){return vn(void 0,e,!1,!0)})},jt.prototype.belowOrEqual=function(e){return e==null?Jt(this,yt):new this.Collection(this,function(){return vn(void 0,e)})},jt.prototype.startsWith=function(e){return typeof e!="string"?Jt(this,Gt):this.between(e,e+Rt,!0,!0)},jt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):wr(this,function(t,i){return t.indexOf(i[0])===0},[e],Rt)},jt.prototype.equalsIgnoreCase=function(e){return wr(this,function(t,i){return t===i[0]},[e],"")},jt.prototype.anyOfIgnoreCase=function(){var e=De.apply(Ue,arguments);return e.length===0?Nn(this):wr(this,function(t,i){return i.indexOf(t)!==-1},e,"")},jt.prototype.startsWithAnyOfIgnoreCase=function(){var e=De.apply(Ue,arguments);return e.length===0?Nn(this):wr(this,function(t,i){return i.some(function(a){return t.indexOf(a)===0})},e,Rt)},jt.prototype.anyOf=function(){var e=this,t=De.apply(Ue,arguments),i=this._cmp;try{t.sort(i)}catch{return Jt(this,yt)}if(t.length===0)return Nn(this);var a=new this.Collection(this,function(){return vn(t[0],t[t.length-1])});a._ondirectionchange=function(v){i=v==="next"?e._ascending:e._descending,t.sort(i)};var d=0;return a._addAlgorithm(function(v,S,O){for(var T=v.key;0<i(T,t[d]);)if(++d===t.length)return S(O),!1;return i(T,t[d])===0||(S(function(){v.continue(t[d])}),!1)}),a},jt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},jt.prototype.noneOf=function(){var e=De.apply(Ue,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Jt(this,yt)}var t=e.reduce(function(i,a){return i?i.concat([[i[i.length-1][1],a]]):[[-1/0,a]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},jt.prototype.inAnyRange=function(V,t){var i=this,a=this._cmp,d=this._ascending,v=this._descending,S=this._min,O=this._max;if(V.length===0)return Nn(this);if(!V.every(function(W){return W[0]!==void 0&&W[1]!==void 0&&d(W[0],W[1])<=0}))return Jt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",$.InvalidArgument);var T=!t||t.includeLowers!==!1,P=t&&t.includeUppers===!0,L,x=d;function M(W,Q){return x(W[0],Q[0])}try{(L=V.reduce(function(W,Q){for(var Z=0,le=W.length;Z<le;++Z){var ge=W[Z];if(a(Q[0],ge[1])<0&&0<a(Q[1],ge[0])){ge[0]=S(ge[0],Q[0]),ge[1]=O(ge[1],Q[1]);break}}return Z===le&&W.push(Q),W},[])).sort(M)}catch{return Jt(this,yt)}var j=0,R=P?function(W){return 0<d(W,L[j][1])}:function(W){return 0<=d(W,L[j][1])},U=T?function(W){return 0<v(W,L[j][0])}:function(W){return 0<=v(W,L[j][0])},F=R,V=new this.Collection(this,function(){return vn(L[0][0],L[L.length-1][1],!T,!P)});return V._ondirectionchange=function(W){x=W==="next"?(F=R,d):(F=U,v),L.sort(M)},V._addAlgorithm(function(W,Q,Z){for(var le,ge=W.key;F(ge);)if(++j===L.length)return Q(Z),!1;return!R(le=ge)&&!U(le)||(i._cmp(ge,L[j][1])===0||i._cmp(ge,L[j][0])===0||Q(function(){x===d?W.continue(L[j][0]):W.continue(L[j][1])}),!1)}),V},jt.prototype.startsWithAnyOf=function(){var e=De.apply(Ue,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?Nn(this):this.inAnyRange(e.map(function(t){return[t,t+Rt]})):Jt(this,"startsWithAnyOf() only works with strings")},jt);function jt(){}function rn(e){return we(function(t){return zn(t),e(t.target.error),!1})}function zn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Jn="storagemutated",ui="x-storagemutated-1",mn=Vn(null,Jn),Ka=(on.prototype._lock=function(){return de(!G.global),++this._reculock,this._reculock!==1||G.global||(G.lockOwnerFor=this),this},on.prototype._unlock=function(){if(de(!G.global),--this._reculock==0)for(G.global||(G.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Qt(e[1],e[0])}catch{}}return this},on.prototype._locked=function(){return this._reculock&&G.lockOwnerFor!==this},on.prototype.create=function(e){var t=this;if(!this.mode)return this;var i=this.db.idbdb,a=this.db._state.dbOpenError;if(de(!this.idbtrans),!e&&!i)switch(a&&a.name){case"DatabaseClosedError":throw new $.DatabaseClosed(a);case"MissingAPIError":throw new $.MissingAPI(a.message,a);default:throw new $.OpenFailed(a)}if(!this.active)throw new $.TransactionInactive;return de(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||i).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=we(function(d){zn(d),t._reject(e.error)}),e.onabort=we(function(d){zn(d),t.active&&t._reject(new $.Abort(e.error)),t.active=!1,t.on("abort").fire(d)}),e.oncomplete=we(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&mn.storagemutated.fire(e.mutatedParts)}),this},on.prototype._promise=function(e,t,i){var a=this;if(e==="readwrite"&&this.mode!=="readwrite")return ht(new $.ReadOnly("Transaction is readonly"));if(!this.active)return ht(new $.TransactionInactive);if(this._locked())return new te(function(v,S){a._blockedFuncs.push([function(){a._promise(e,t,i).then(v,S)},G])});if(i)return Qe(function(){var v=new te(function(S,O){a._lock();var T=t(S,O,a);T&&T.then&&T.then(S,O)});return v.finally(function(){return a._unlock()}),v._lib=!0,v});var d=new te(function(v,S){var O=t(v,S,a);O&&O.then&&O.then(v,S)});return d._lib=!0,d},on.prototype._root=function(){return this.parent?this.parent._root():this},on.prototype.waitFor=function(e){var t,i=this._root(),a=te.resolve(e);i._waitingFor?i._waitingFor=i._waitingFor.then(function(){return a}):(i._waitingFor=a,i._waitingQueue=[],t=i.idbtrans.objectStore(i.storeNames[0]),function v(){for(++i._spinCount;i._waitingQueue.length;)i._waitingQueue.shift()();i._waitingFor&&(t.get(-1/0).onsuccess=v)}());var d=i._waitingFor;return new te(function(v,S){a.then(function(O){return i._waitingQueue.push(we(v.bind(null,O)))},function(O){return i._waitingQueue.push(we(S.bind(null,O)))}).finally(function(){i._waitingFor===d&&(i._waitingFor=null)})})},on.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new $.Abort))},on.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(h(t,e))return t[e];var i=this.schema[e];if(!i)throw new $.NotFound("Table "+e+" not part of transaction");return i=new this.db.Table(e,i,this),i.core=this.db.core.table(e),t[e]=i},on);function on(){}function ci(e,t,i,a,d,v,S,O){return{name:e,keyPath:t,unique:i,multi:a,auto:d,compound:v,src:(i&&!S?"&":"")+(a?"*":"")+(d?"++":"")+Po(t),type:O}}function Po(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function li(e,t,i){return{name:e,primKey:t,indexes:i,mappedClass:null,idxByName:(a=function(d){return[d.name,d]},i.reduce(function(d,v,S){return S=a(v,S),S&&(d[S[0]]=S[1]),d},{}))};var a}var Hn=function(e){try{return e.only([[]]),Hn=function(){return[[]]},[[]]}catch{return Hn=function(){return Rt},Rt}};function fi(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(i){return i[t]}:function(i){return se(i,t)}:function(i){return se(i,e)};var t}function Io(e){return[].slice.call(e)}var La=0;function Gn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function $a(e,t,T){function a(F){if(F.type===3)return null;if(F.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var j=F.lower,R=F.upper,U=F.lowerOpen,F=F.upperOpen;return j===void 0?R===void 0?null:t.upperBound(R,!!F):R===void 0?t.lowerBound(j,!!U):t.bound(j,R,!!U,!!F)}function d(M){var j,R=M.name;return{name:R,schema:M,mutate:function(U){var F=U.trans,V=U.type,W=U.keys,Q=U.values,Z=U.range;return new Promise(function(le,ge){le=we(le);var ae=F.objectStore(R),pe=ae.keyPath==null,_e=V==="put"||V==="add";if(!_e&&V!=="delete"&&V!=="deleteRange")throw new Error("Invalid operation type: "+V);var ve,Ie=(W||Q||{length:1}).length;if(W&&Q&&W.length!==Q.length)throw new Error("Given keys array must have same length as given values array.");if(Ie===0)return le({numFailures:0,failures:{},results:[],lastResult:void 0});function We(Ft){++Ht,zn(Ft)}var Je=[],Ye=[],Ht=0;if(V==="deleteRange"){if(Z.type===4)return le({numFailures:Ht,failures:Ye,results:[],lastResult:void 0});Z.type===3?Je.push(ve=ae.clear()):Je.push(ve=ae.delete(a(Z)))}else{var pe=_e?pe?[Q,W]:[Q,null]:[W,null],Ve=pe[0],Dt=pe[1];if(_e)for(var Kt=0;Kt<Ie;++Kt)Je.push(ve=Dt&&Dt[Kt]!==void 0?ae[V](Ve[Kt],Dt[Kt]):ae[V](Ve[Kt])),ve.onerror=We;else for(Kt=0;Kt<Ie;++Kt)Je.push(ve=ae[V](Ve[Kt])),ve.onerror=We}function Cr(Ft){Ft=Ft.target.result,Je.forEach(function(Tn,Pi){return Tn.error!=null&&(Ye[Pi]=Tn.error)}),le({numFailures:Ht,failures:Ye,results:V==="delete"?W:Je.map(function(Tn){return Tn.result}),lastResult:Ft})}ve.onerror=function(Ft){We(Ft),Cr(Ft)},ve.onsuccess=Cr})},getMany:function(U){var F=U.trans,V=U.keys;return new Promise(function(W,Q){W=we(W);for(var Z,le=F.objectStore(R),ge=V.length,ae=new Array(ge),pe=0,_e=0,ve=function(Je){Je=Je.target,ae[Je._pos]=Je.result,++_e===pe&&W(ae)},Ie=rn(Q),We=0;We<ge;++We)V[We]!=null&&((Z=le.get(V[We]))._pos=We,Z.onsuccess=ve,Z.onerror=Ie,++pe);pe===0&&W(ae)})},get:function(U){var F=U.trans,V=U.key;return new Promise(function(W,Q){W=we(W);var Z=F.objectStore(R).get(V);Z.onsuccess=function(le){return W(le.target.result)},Z.onerror=rn(Q)})},query:(j=P,function(U){return new Promise(function(F,V){F=we(F);var W,Q,Z,pe=U.trans,le=U.values,ge=U.limit,ve=U.query,ae=ge===1/0?void 0:ge,_e=ve.index,ve=ve.range,pe=pe.objectStore(R),_e=_e.isPrimaryKey?pe:pe.index(_e.name),ve=a(ve);if(ge===0)return F({result:[]});j?((ae=le?_e.getAll(ve,ae):_e.getAllKeys(ve,ae)).onsuccess=function(Ie){return F({result:Ie.target.result})},ae.onerror=rn(V)):(W=0,Q=!le&&"openKeyCursor"in _e?_e.openKeyCursor(ve):_e.openCursor(ve),Z=[],Q.onsuccess=function(Ie){var We=Q.result;return We?(Z.push(le?We.value:We.primaryKey),++W===ge?F({result:Z}):void We.continue()):F({result:Z})},Q.onerror=rn(V))})}),openCursor:function(U){var F=U.trans,V=U.values,W=U.query,Q=U.reverse,Z=U.unique;return new Promise(function(le,ge){le=we(le);var _e=W.index,ae=W.range,pe=F.objectStore(R),pe=_e.isPrimaryKey?pe:pe.index(_e.name),_e=Q?Z?"prevunique":"prev":Z?"nextunique":"next",ve=!V&&"openKeyCursor"in pe?pe.openKeyCursor(a(ae),_e):pe.openCursor(a(ae),_e);ve.onerror=rn(ge),ve.onsuccess=we(function(Ie){var We,Je,Ye,Ht,Ve=ve.result;Ve?(Ve.___id=++La,Ve.done=!1,We=Ve.continue.bind(Ve),Je=(Je=Ve.continuePrimaryKey)&&Je.bind(Ve),Ye=Ve.advance.bind(Ve),Ht=function(){throw new Error("Cursor not stopped")},Ve.trans=F,Ve.stop=Ve.continue=Ve.continuePrimaryKey=Ve.advance=function(){throw new Error("Cursor not started")},Ve.fail=we(ge),Ve.next=function(){var Dt=this,Kt=1;return this.start(function(){return Kt--?Dt.continue():Dt.stop()}).then(function(){return Dt})},Ve.start=function(Dt){function Kt(){if(ve.result)try{Dt()}catch(Ft){Ve.fail(Ft)}else Ve.done=!0,Ve.start=function(){throw new Error("Cursor behind last entry")},Ve.stop()}var Cr=new Promise(function(Ft,Tn){Ft=we(Ft),ve.onerror=rn(Tn),Ve.fail=Tn,Ve.stop=function(Pi){Ve.stop=Ve.continue=Ve.continuePrimaryKey=Ve.advance=Ht,Ft(Pi)}});return ve.onsuccess=we(function(Ft){ve.onsuccess=Kt,Kt()}),Ve.continue=We,Ve.continuePrimaryKey=Je,Ve.advance=Ye,Kt(),Cr},le(Ve)):le(null)},ge)})},count:function(U){var F=U.query,V=U.trans,W=F.index,Q=F.range;return new Promise(function(Z,le){var ge=V.objectStore(R),ae=W.isPrimaryKey?ge:ge.index(W.name),ge=a(Q),ae=ge?ae.count(ge):ae.count();ae.onsuccess=we(function(pe){return Z(pe.target.result)}),ae.onerror=rn(le)})}}}var v,S,O,L=(S=T,O=Io((v=e).objectStoreNames),{schema:{name:v.name,tables:O.map(function(M){return S.objectStore(M)}).map(function(M){var j=M.keyPath,F=M.autoIncrement,R=y(j),U={},F={name:M.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:j==null,compound:R,keyPath:j,autoIncrement:F,unique:!0,extractKey:fi(j)},indexes:Io(M.indexNames).map(function(V){return M.index(V)}).map(function(Z){var W=Z.name,Q=Z.unique,le=Z.multiEntry,Z=Z.keyPath,le={name:W,compound:y(Z),keyPath:Z,unique:Q,multiEntry:le,extractKey:fi(Z)};return U[Gn(Z)]=le}),getIndexByKeyPath:function(V){return U[Gn(V)]}};return U[":id"]=F.primaryKey,j!=null&&(U[Gn(j)]=F.primaryKey),F})},hasGetAll:0<O.length&&"getAll"in S.objectStore(O[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),T=L.schema,P=L.hasGetAll,L=T.tables.map(d),x={};return L.forEach(function(M){return x[M.name]=M}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(M){if(!x[M])throw new Error("Table '".concat(M,"' not found"));return x[M]},MIN_KEY:-1/0,MAX_KEY:Hn(t),schema:T}}function Fa(e,t,i,a){var d=i.IDBKeyRange;return i.indexedDB,{dbcore:(a=$a(t,d,a),e.dbcore.reduce(function(v,S){return S=S.create,s(s({},v),S(v))},a))}}function _r(e,a){var i=a.db,a=Fa(e._middlewares,i,e._deps,a);e.core=a.dbcore,e.tables.forEach(function(d){var v=d.name;e.core.schema.tables.some(function(S){return S.name===v})&&(d.core=e.core.table(v),e[v]instanceof e.Table&&(e[v].core=d.core))})}function Sr(e,t,i,a){i.forEach(function(d){var v=a[d];t.forEach(function(S){var O=function T(P,L){return z(P,L)||(P=l(P))&&T(P,L)}(S,d);(!O||"value"in O&&O.value===void 0)&&(S===e.Transaction.prototype||S instanceof e.Transaction?N(S,d,{get:function(){return this.table(d)},set:function(T){E(this,d,{value:T,writable:!0,configurable:!0,enumerable:!0})}}):S[d]=new e.Table(d,v))})})}function di(e,t){t.forEach(function(i){for(var a in i)i[a]instanceof e.Table&&delete i[a]})}function Ma(e,t){return e._cfg.version-t._cfg.version}function qa(e,t,i,a){var d=e._dbSchema;i.objectStoreNames.contains("$meta")&&!d.$meta&&(d.$meta=li("$meta",Co("")[0],[]),e._storeNames.push("$meta"));var v=e._createTransaction("readwrite",e._storeNames,d);v.create(i),v._completion.catch(a);var S=v._reject.bind(v),O=G.transless||G;Qe(function(){return G.trans=v,G.transless=O,t!==0?(_r(e,i),P=t,((T=v).storeNames.includes("$meta")?T.table("$meta").get("version").then(function(L){return L!=null?L:P}):te.resolve(P)).then(function(L){return M=L,j=v,R=i,U=[],L=(x=e)._versions,F=x._dbSchema=Or(0,x.idbdb,R),(L=L.filter(function(V){return V._cfg.version>=M})).length!==0?(L.forEach(function(V){U.push(function(){var W=F,Q=V._cfg.dbschema;xr(x,W,R),xr(x,Q,R),F=x._dbSchema=Q;var Z=pi(W,Q);Z.add.forEach(function(_e){hi(R,_e[0],_e[1].primKey,_e[1].indexes)}),Z.change.forEach(function(_e){if(_e.recreate)throw new $.Upgrade("Not yet support for changing primary key");var ve=R.objectStore(_e.name);_e.add.forEach(function(Ie){return kr(ve,Ie)}),_e.change.forEach(function(Ie){ve.deleteIndex(Ie.name),kr(ve,Ie)}),_e.del.forEach(function(Ie){return ve.deleteIndex(Ie)})});var le=V._cfg.contentUpgrade;if(le&&V._cfg.version>M){_r(x,R),j._memoizedTables={};var ge=Le(Q);Z.del.forEach(function(_e){ge[_e]=W[_e]}),di(x,[x.Transaction.prototype]),Sr(x,[x.Transaction.prototype],u(ge),ge),j.schema=ge;var ae,pe=xe(le);return pe&&At(),Z=te.follow(function(){var _e;(ae=le(j))&&pe&&(_e=ot.bind(null,null),ae.then(_e,_e))}),ae&&typeof ae.then=="function"?te.resolve(ae):Z.then(function(){return ae})}}),U.push(function(W){var Q,Z,le=V._cfg.dbschema;Q=le,Z=W,[].slice.call(Z.db.objectStoreNames).forEach(function(ge){return Q[ge]==null&&Z.db.deleteObjectStore(ge)}),di(x,[x.Transaction.prototype]),Sr(x,[x.Transaction.prototype],x._storeNames,x._dbSchema),j.schema=x._dbSchema}),U.push(function(W){x.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(x.idbdb.version/10)===V._cfg.version?(x.idbdb.deleteObjectStore("$meta"),delete x._dbSchema.$meta,x._storeNames=x._storeNames.filter(function(Q){return Q!=="$meta"})):W.objectStore("$meta").put(V._cfg.version,"version"))})}),function V(){return U.length?te.resolve(U.shift()(j.idbtrans)).then(V):te.resolve()}().then(function(){jo(F,R)})):te.resolve();var x,M,j,R,U,F}).catch(S)):(u(d).forEach(function(L){hi(i,L,d[L].primKey,d[L].indexes)}),_r(e,i),void te.follow(function(){return e.on.populate.fire(v)}).catch(S));var T,P})}function Va(e,t){jo(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var i=Or(0,e.idbdb,t);xr(e,e._dbSchema,t);for(var a=0,d=pi(i,e._dbSchema).change;a<d.length;a++){var v=function(S){if(S.change.length||S.recreate)return console.warn("Unable to patch indexes of table ".concat(S.name," because it has changes on the type of index or primary key.")),{value:void 0};var O=t.objectStore(S.name);S.add.forEach(function(T){kt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(S.name,".").concat(T.src)),kr(O,T)})}(d[a]);if(typeof v=="object")return v.value}}function pi(e,t){var i,a={del:[],add:[],change:[]};for(i in e)t[i]||a.del.push(i);for(i in t){var d=e[i],v=t[i];if(d){var S={name:i,def:v,recreate:!1,del:[],add:[],change:[]};if(""+(d.primKey.keyPath||"")!=""+(v.primKey.keyPath||"")||d.primKey.auto!==v.primKey.auto)S.recreate=!0,a.change.push(S);else{var O=d.idxByName,T=v.idxByName,P=void 0;for(P in O)T[P]||S.del.push(P);for(P in T){var L=O[P],x=T[P];L?L.src!==x.src&&S.change.push(x):S.add.push(x)}(0<S.del.length||0<S.add.length||0<S.change.length)&&a.change.push(S)}}else a.add.push([i,v])}return a}function hi(e,t,i,a){var d=e.db.createObjectStore(t,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return a.forEach(function(v){return kr(d,v)}),d}function jo(e,t){u(e).forEach(function(i){t.db.objectStoreNames.contains(i)||(kt&&console.debug("Dexie: Creating missing table",i),hi(t,i,e[i].primKey,e[i].indexes))})}function kr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Or(e,t,i){var a={};return X(t.objectStoreNames,0).forEach(function(d){for(var v=i.objectStore(d),S=ci(Po(P=v.keyPath),P||"",!0,!1,!!v.autoIncrement,P&&typeof P!="string",!0),O=[],T=0;T<v.indexNames.length;++T){var L=v.index(v.indexNames[T]),P=L.keyPath,L=ci(L.name,P,!!L.unique,!!L.multiEntry,!1,P&&typeof P!="string",!1);O.push(L)}a[d]=li(d,S,O)}),a}function xr(e,t,i){for(var a=i.db.objectStoreNames,d=0;d<a.length;++d){var v=a[d],S=i.objectStore(v);e._hasGetAll="getAll"in S;for(var O=0;O<S.indexNames.length;++O){var T=S.indexNames[O],P=S.index(T).keyPath,L=typeof P=="string"?P:"["+X(P).join("+")+"]";!t[v]||(P=t[v].idxByName[L])&&(P.name=T,delete t[v].idxByName[L],t[v].idxByName[T]=P)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&c.WorkerGlobalScope&&c instanceof c.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Co(e){return e.split(",").map(function(t,i){var v=t.split(":"),a=(d=v[1])===null||d===void 0?void 0:d.trim(),d=(t=v[0].trim()).replace(/([&*]|\+\+)/g,""),v=/^\[/.test(d)?d.match(/^\[(.*)\]$/)[1].split("+"):d;return ci(d,v||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),y(v),i===0,a)})}var Wa=(Bn.prototype._createTableSchema=li,Bn.prototype._parseIndexSyntax=Co,Bn.prototype._parseStoresSpec=function(e,t){var i=this;u(e).forEach(function(a){if(e[a]!==null){var d=i._parseIndexSyntax(e[a]),v=d.shift();if(!v)throw new $.Schema("Invalid schema for table "+a+": "+e[a]);if(v.unique=!0,v.multi)throw new $.Schema("Primary key cannot be multiEntry*");d.forEach(function(S){if(S.auto)throw new $.Schema("Only primary key can be marked as autoIncrement (++)");if(!S.keyPath)throw new $.Schema("Index must have a name and cannot be an empty string")}),d=i._createTableSchema(a,v,d),t[a]=d}})},Bn.prototype.stores=function(i){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?b(this._cfg.storesSource,i):i;var i=t._versions,a={},d={};return i.forEach(function(v){b(a,v._cfg.storesSource),d=v._cfg.dbschema={},v._parseStoresSpec(a,d)}),t._dbSchema=d,di(t,[t._allTables,t,t.Transaction.prototype]),Sr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],u(d),d),t._storeNames=u(d),this},Bn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=$t(this._cfg.contentUpgrade||fe,e),this},Bn);function Bn(){}function yi(e,t){var i=e._dbNamesDB;return i||(i=e._dbNamesDB=new ln(cn,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),i.table("dbnames")}function vi(e){return e&&typeof e.databases=="function"}function mi(e){return Qe(function(){return G.letThrough=!0,e()})}function bi(e){return!("from"in e)}var Ut=function(e,t){if(!this){var i=new Ut;return e&&"d"in e&&b(i,e),i}b(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Yn(e,t,i){var a=rt(t,i);if(!isNaN(a)){if(0<a)throw RangeError();if(bi(e))return b(e,{from:t,to:i,d:1});var d=e.l,a=e.r;if(rt(i,e.from)<0)return d?Yn(d,t,i):e.l={from:t,to:i,d:1,l:null,r:null},Bo(e);if(0<rt(t,e.to))return a?Yn(a,t,i):e.r={from:t,to:i,d:1,l:null,r:null},Bo(e);rt(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),0<rt(i,e.to)&&(e.to=i,e.r=null,e.d=e.l?e.l.d+1:1),i=!e.r,d&&!e.l&&Xn(e,d),a&&i&&Xn(e,a)}}function Xn(e,t){bi(t)||function i(a,T){var v=T.from,S=T.to,O=T.l,T=T.r;Yn(a,v,S),O&&i(a,O),T&&i(a,T)}(e,t)}function No(e,t){var i=Er(t),a=i.next();if(a.done)return!1;for(var d=a.value,v=Er(e),S=v.next(d.from),O=S.value;!a.done&&!S.done;){if(rt(O.from,d.to)<=0&&0<=rt(O.to,d.from))return!0;rt(d.from,O.from)<0?d=(a=i.next(O.from)).value:O=(S=v.next(d.from)).value}return!1}function Er(e){var t=bi(e)?null:{s:0,n:e};return{next:function(i){for(var a=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,a)for(;t.n.l&&rt(i,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!a||rt(i,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Bo(e){var t,i,a=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((i=e.l)===null||i===void 0?void 0:i.d)||0),d=1<a?"r":a<-1?"l":"";d&&(t=d=="r"?"l":"r",i=s({},e),a=e[d],e.from=a.from,e.to=a.to,e[d]=a[d],i[d]=a[t],(e[t]=i).d=Ro(i)),e.d=Ro(e)}function Ro(i){var t=i.r,i=i.l;return(t?i?Math.max(t.d,i.d):t.d:i?i.d:0)+1}function Ar(e,t){return u(t).forEach(function(i){e[i]?Xn(e[i],t[i]):e[i]=function a(d){var v,S,O={};for(v in d)h(d,v)&&(S=d[v],O[v]=!S||typeof S!="object"||C.has(S.constructor)?S:a(S));return O}(t[i])}),e}function gi(e,t){return e.all||t.all||Object.keys(e).some(function(i){return t[i]&&No(t[i],e[i])})}k(Ut.prototype,((Yt={add:function(e){return Xn(this,e),this},addKey:function(e){return Yn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(i){return Yn(t,i,i)}),this},hasKey:function(e){var t=Er(this).next(e).value;return t&&rt(t.from,e)<=0&&0<=rt(t.to,e)}})[re]=function(){return Er(this)},Yt));var En={},wi={},_i=!1;function Tr(e){Ar(wi,e),_i||(_i=!0,setTimeout(function(){_i=!1,Si(wi,!(wi={}))},0))}function Si(e,t){t===void 0&&(t=!1);var i=new Set;if(e.all)for(var a=0,d=Object.values(En);a<d.length;a++)Uo(S=d[a],e,i,t);else for(var v in e){var S,O=/^idb\:\/\/(.*)\/(.*)\//.exec(v);O&&(v=O[1],O=O[2],(S=En["idb://".concat(v,"/").concat(O)])&&Uo(S,e,i,t))}i.forEach(function(T){return T()})}function Uo(e,t,i,a){for(var d=[],v=0,S=Object.entries(e.queries.query);v<S.length;v++){for(var O=S[v],T=O[0],P=[],L=0,x=O[1];L<x.length;L++){var M=x[L];gi(t,M.obsSet)?M.subscribers.forEach(function(F){return i.add(F)}):a&&P.push(M)}a&&d.push([T,P])}if(a)for(var j=0,R=d;j<R.length;j++){var U=R[j],T=U[0],P=U[1];e.queries.query[T]=P}}function za(e){var t=e._state,i=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?ht(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var a=t.openCanceller,d=Math.round(10*e.verno),v=!1;function S(){if(t.openCanceller!==a)throw new $.DatabaseClosed("db.open() was cancelled")}function O(){return new te(function(M,j){if(S(),!i)throw new $.MissingAPI;var R=e.name,U=t.autoSchema||!d?i.open(R):i.open(R,d);if(!U)throw new $.MissingAPI;U.onerror=rn(j),U.onblocked=we(e._fireOnBlocked),U.onupgradeneeded=we(function(F){var V;L=U.transaction,t.autoSchema&&!e._options.allowEmptyDB?(U.onerror=zn,L.abort(),U.result.close(),(V=i.deleteDatabase(R)).onsuccess=V.onerror=we(function(){j(new $.NoSuchDatabase("Database ".concat(R," doesnt exist")))})):(L.onerror=rn(j),F=F.oldVersion>Math.pow(2,62)?0:F.oldVersion,x=F<1,e.idbdb=U.result,v&&Va(e,L),qa(e,F/10,L,j))},j),U.onsuccess=we(function(){L=null;var F,V,W,Q,Z,le=e.idbdb=U.result,ge=X(le.objectStoreNames);if(0<ge.length)try{var ae=le.transaction((Q=ge).length===1?Q[0]:Q,"readonly");if(t.autoSchema)V=le,W=ae,(F=e).verno=V.version/10,W=F._dbSchema=Or(0,V,W),F._storeNames=X(V.objectStoreNames,0),Sr(F,[F._allTables],u(W),W);else if(xr(e,e._dbSchema,ae),((Z=pi(Or(0,(Z=e).idbdb,ae),Z._dbSchema)).add.length||Z.change.some(function(pe){return pe.add.length||pe.change.length}))&&!v)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),le.close(),d=le.version+1,v=!0,M(O());_r(e,ae)}catch{}Vt.push(e),le.onversionchange=we(function(pe){t.vcFired=!0,e.on("versionchange").fire(pe)}),le.onclose=we(function(){e.close({disableAutoOpen:!1})}),x&&(Z=e._deps,ae=R,le=Z.indexedDB,Z=Z.IDBKeyRange,vi(le)||ae===cn||yi(le,Z).put({name:ae}).catch(fe)),M()},j)}).catch(function(M){switch(M==null?void 0:M.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),O();break;case"VersionError":if(0<d)return d=0,O()}return te.reject(M)})}var T,P=t.dbReadyResolve,L=null,x=!1;return te.race([a,(typeof navigator>"u"?te.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(M){function j(){return indexedDB.databases().finally(M)}T=setInterval(j,100),j()}).finally(function(){return clearInterval(T)}):Promise.resolve()).then(O)]).then(function(){return S(),t.onReadyBeingFired=[],te.resolve(mi(function(){return e.on.ready.fire(e.vip)})).then(function M(){if(0<t.onReadyBeingFired.length){var j=t.onReadyBeingFired.reduce($t,fe);return t.onReadyBeingFired=[],te.resolve(mi(function(){return j(e.vip)})).then(M)}})}).finally(function(){t.openCanceller===a&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(M){t.dbOpenError=M;try{L&&L.abort()}catch{}return a===t.openCanceller&&e._close(),ht(M)}).finally(function(){t.openComplete=!0,P()}).then(function(){var M;return x&&(M={},e.tables.forEach(function(j){j.schema.indexes.forEach(function(R){R.name&&(M["idb://".concat(e.name,"/").concat(j.name,"/").concat(R.name)]=new Ut(-1/0,[[[]]]))}),M["idb://".concat(e.name,"/").concat(j.name,"/")]=M["idb://".concat(e.name,"/").concat(j.name,"/:dels")]=new Ut(-1/0,[[[]]])}),mn(Jn).fire(M),Si(M,!0)),e})}function ki(e){function t(v){return e.next(v)}var i=d(t),a=d(function(v){return e.throw(v)});function d(v){return function(T){var O=v(T),T=O.value;return O.done?T:T&&typeof T.then=="function"?T.then(i,a):y(T)?Promise.all(T).then(i,a):i(T)}}return d(t)()}function Pr(e,t,i){for(var a=y(e)?e.slice():[e],d=0;d<i;++d)a.push(t);return a}var Ja={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return s(s({},e),{table:function(t){var i=e.table(t),a=i.schema,d={},v=[];function S(x,M,j){var R=Gn(x),U=d[R]=d[R]||[],F=x==null?0:typeof x=="string"?1:x.length,V=0<M,V=s(s({},j),{name:V?"".concat(R,"(virtual-from:").concat(j.name,")"):j.name,lowLevelIndex:j,isVirtual:V,keyTail:M,keyLength:F,extractKey:fi(x),unique:!V&&j.unique});return U.push(V),V.isPrimaryKey||v.push(V),1<F&&S(F===2?x[0]:x.slice(0,F-1),M+1,j),U.sort(function(W,Q){return W.keyTail-Q.keyTail}),V}t=S(a.primaryKey.keyPath,0,a.primaryKey),d[":id"]=[t];for(var O=0,T=a.indexes;O<T.length;O++){var P=T[O];S(P.keyPath,0,P)}function L(x){var M,j=x.query.index;return j.isVirtual?s(s({},x),{query:{index:j.lowLevelIndex,range:(M=x.query.range,j=j.keyTail,{type:M.type===1?2:M.type,lower:Pr(M.lower,M.lowerOpen?e.MAX_KEY:e.MIN_KEY,j),lowerOpen:!0,upper:Pr(M.upper,M.upperOpen?e.MIN_KEY:e.MAX_KEY,j),upperOpen:!0})}}):x}return s(s({},i),{schema:s(s({},a),{primaryKey:t,indexes:v,getIndexByKeyPath:function(x){return(x=d[Gn(x)])&&x[0]}}),count:function(x){return i.count(L(x))},query:function(x){return i.query(L(x))},openCursor:function(x){var M=x.query.index,j=M.keyTail,R=M.isVirtual,U=M.keyLength;return R?i.openCursor(L(x)).then(function(V){return V&&F(V)}):i.openCursor(x);function F(V){return Object.create(V,{continue:{value:function(W){W!=null?V.continue(Pr(W,x.reverse?e.MAX_KEY:e.MIN_KEY,j)):x.unique?V.continue(V.key.slice(0,U).concat(x.reverse?e.MIN_KEY:e.MAX_KEY,j)):V.continue()}},continuePrimaryKey:{value:function(W,Q){V.continuePrimaryKey(Pr(W,e.MAX_KEY,j),Q)}},primaryKey:{get:function(){return V.primaryKey}},key:{get:function(){var W=V.key;return U===1?W[0]:W.slice(0,U)}},value:{get:function(){return V.value}}})}}})}})}};function Oi(e,t,i,a){return i=i||{},a=a||"",u(e).forEach(function(d){var v,S,O;h(t,d)?(v=e[d],S=t[d],typeof v=="object"&&typeof S=="object"&&v&&S?(O=Oe(v))!==Oe(S)?i[a+d]=t[d]:O==="Object"?Oi(v,S,i,a+d+"."):v!==S&&(i[a+d]=t[d]):v!==S&&(i[a+d]=t[d])):i[a+d]=void 0}),u(t).forEach(function(d){h(e,d)||(i[a+d]=t[d])}),i}function xi(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Ha={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return s(s({},e),{table:function(t){var i=e.table(t),a=i.schema.primaryKey;return s(s({},i),{mutate:function(d){var v=G.trans,S=v.table(t).hook,O=S.deleting,T=S.creating,P=S.updating;switch(d.type){case"add":if(T.fire===fe)break;return v._promise("readwrite",function(){return L(d)},!0);case"put":if(T.fire===fe&&P.fire===fe)break;return v._promise("readwrite",function(){return L(d)},!0);case"delete":if(O.fire===fe)break;return v._promise("readwrite",function(){return L(d)},!0);case"deleteRange":if(O.fire===fe)break;return v._promise("readwrite",function(){return function x(M,j,R){return i.query({trans:M,values:!1,query:{index:a,range:j},limit:R}).then(function(U){var F=U.result;return L({type:"delete",keys:F,trans:M}).then(function(V){return 0<V.numFailures?Promise.reject(V.failures[0]):F.length<R?{failures:[],numFailures:0,lastResult:void 0}:x(M,s(s({},j),{lower:F[F.length-1],lowerOpen:!0}),R)})})}(d.trans,d.range,1e4)},!0)}return i.mutate(d);function L(x){var M,j,R,U=G.trans,F=x.keys||xi(a,x);if(!F)throw new Error("Keys missing");return(x=x.type==="add"||x.type==="put"?s(s({},x),{keys:F}):s({},x)).type!=="delete"&&(x.values=f([],x.values)),x.keys&&(x.keys=f([],x.keys)),M=i,R=F,((j=x).type==="add"?Promise.resolve([]):M.getMany({trans:j.trans,keys:R,cache:"immutable"})).then(function(V){var W=F.map(function(Q,Z){var le,ge,ae,pe=V[Z],_e={onerror:null,onsuccess:null};return x.type==="delete"?O.fire.call(_e,Q,pe,U):x.type==="add"||pe===void 0?(le=T.fire.call(_e,Q,x.values[Z],U),Q==null&&le!=null&&(x.keys[Z]=Q=le,a.outbound||oe(x.values[Z],a.keyPath,Q))):(le=Oi(pe,x.values[Z]),(ge=P.fire.call(_e,le,Q,pe,U))&&(ae=x.values[Z],Object.keys(ge).forEach(function(ve){h(ae,ve)?ae[ve]=ge[ve]:oe(ae,ve,ge[ve])}))),_e});return i.mutate(x).then(function(Q){for(var Z=Q.failures,le=Q.results,ge=Q.numFailures,Q=Q.lastResult,ae=0;ae<F.length;++ae){var pe=(le||F)[ae],_e=W[ae];pe==null?_e.onerror&&_e.onerror(Z[ae]):_e.onsuccess&&_e.onsuccess(x.type==="put"&&V[ae]?x.values[ae]:pe)}return{failures:Z,results:le,numFailures:ge,lastResult:Q}}).catch(function(Q){return W.forEach(function(Z){return Z.onerror&&Z.onerror(Q)}),Promise.reject(Q)})})}}})}})}};function Do(e,t,i){try{if(!t||t.keys.length<e.length)return null;for(var a=[],d=0,v=0;d<t.keys.length&&v<e.length;++d)rt(t.keys[d],e[v])===0&&(a.push(i?ke(t.values[d]):t.values[d]),++v);return a.length===e.length?a:null}catch{return null}}var Ga={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var i=e.table(t);return s(s({},i),{getMany:function(a){if(!a.cache)return i.getMany(a);var d=Do(a.keys,a.trans._cache,a.cache==="clone");return d?te.resolve(d):i.getMany(a).then(function(v){return a.trans._cache={keys:a.keys,values:a.cache==="clone"?ke(v):v},v})},mutate:function(a){return a.type!=="add"&&(a.trans._cache=null),i.mutate(a)}})}}}};function Ko(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Lo(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ya={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,i=new Ut(e.MIN_KEY,e.MAX_KEY);return s(s({},e),{transaction:function(a,d,v){if(G.subscr&&d!=="readonly")throw new $.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(G.querier));return e.transaction(a,d,v)},table:function(a){var d=e.table(a),v=d.schema,S=v.primaryKey,x=v.indexes,O=S.extractKey,T=S.outbound,P=S.autoIncrement&&x.filter(function(j){return j.compound&&j.keyPath.includes(S.keyPath)}),L=s(s({},d),{mutate:function(j){function R(ve){return ve="idb://".concat(t,"/").concat(a,"/").concat(ve),Q[ve]||(Q[ve]=new Ut)}var U,F,V,W=j.trans,Q=j.mutatedParts||(j.mutatedParts={}),Z=R(""),le=R(":dels"),ge=j.type,_e=j.type==="deleteRange"?[j.range]:j.type==="delete"?[j.keys]:j.values.length<50?[xi(S,j).filter(function(ve){return ve}),j.values]:[],ae=_e[0],pe=_e[1],_e=j.trans._cache;return y(ae)?(Z.addKeys(ae),(_e=ge==="delete"||ae.length===pe.length?Do(ae,_e):null)||le.addKeys(ae),(_e||pe)&&(U=R,F=_e,V=pe,v.indexes.forEach(function(ve){var Ie=U(ve.name||"");function We(Ye){return Ye!=null?ve.extractKey(Ye):null}function Je(Ye){return ve.multiEntry&&y(Ye)?Ye.forEach(function(Ht){return Ie.addKey(Ht)}):Ie.addKey(Ye)}(F||V).forEach(function(Ye,Dt){var Ve=F&&We(F[Dt]),Dt=V&&We(V[Dt]);rt(Ve,Dt)!==0&&(Ve!=null&&Je(Ve),Dt!=null&&Je(Dt))})}))):ae?(pe={from:(pe=ae.lower)!==null&&pe!==void 0?pe:e.MIN_KEY,to:(pe=ae.upper)!==null&&pe!==void 0?pe:e.MAX_KEY},le.add(pe),Z.add(pe)):(Z.add(i),le.add(i),v.indexes.forEach(function(ve){return R(ve.name).add(i)})),d.mutate(j).then(function(ve){return!ae||j.type!=="add"&&j.type!=="put"||(Z.addKeys(ve.results),P&&P.forEach(function(Ie){for(var We=j.values.map(function(Ve){return Ie.extractKey(Ve)}),Je=Ie.keyPath.findIndex(function(Ve){return Ve===S.keyPath}),Ye=0,Ht=ve.results.length;Ye<Ht;++Ye)We[Ye][Je]=ve.results[Ye];R(Ie.name).addKeys(We)})),W.mutatedParts=Ar(W.mutatedParts||{},Q),ve})}}),x=function(R){var U=R.query,R=U.index,U=U.range;return[R,new Ut((R=U.lower)!==null&&R!==void 0?R:e.MIN_KEY,(U=U.upper)!==null&&U!==void 0?U:e.MAX_KEY)]},M={get:function(j){return[S,new Ut(j.key)]},getMany:function(j){return[S,new Ut().addKeys(j.keys)]},count:x,query:x,openCursor:x};return u(M).forEach(function(j){L[j]=function(R){var U=G.subscr,F=!!U,V=Ko(G,d)&&Lo(j,R)?R.obsSet={}:U;if(F){var W=function(pe){return pe="idb://".concat(t,"/").concat(a,"/").concat(pe),V[pe]||(V[pe]=new Ut)},Q=W(""),Z=W(":dels"),U=M[j](R),F=U[0],U=U[1];if((j==="query"&&F.isPrimaryKey&&!R.values?Z:W(F.name||"")).add(U),!F.isPrimaryKey){if(j!=="count"){var le=j==="query"&&T&&R.values&&d.query(s(s({},R),{values:!1}));return d[j].apply(this,arguments).then(function(pe){if(j==="query"){if(T&&R.values)return le.then(function(We){return We=We.result,Q.addKeys(We),pe});var _e=R.values?pe.result.map(O):pe.result;(R.values?Q:Z).addKeys(_e)}else if(j==="openCursor"){var ve=pe,Ie=R.values;return ve&&Object.create(ve,{key:{get:function(){return Z.addKey(ve.primaryKey),ve.key}},primaryKey:{get:function(){var We=ve.primaryKey;return Z.addKey(We),We}},value:{get:function(){return Ie&&Q.addKey(ve.primaryKey),ve.value}}})}return pe})}Z.add(i)}}return d[j].apply(this,arguments)}}),L}})}};function $o(e,t,i){if(i.numFailures===0)return t;if(t.type==="deleteRange")return null;var a=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return i.numFailures===a?null:(t=s({},t),y(t.keys)&&(t.keys=t.keys.filter(function(d,v){return!(v in i.failures)})),"values"in t&&y(t.values)&&(t.values=t.values.filter(function(d,v){return!(v in i.failures)})),t)}function Ei(e,t){return i=e,((a=t).lower===void 0||(a.lowerOpen?0<rt(i,a.lower):0<=rt(i,a.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?rt(e,t.upper)<0:rt(e,t.upper)<=0));var i,a}function Fo(e,t,M,a,d,v){if(!M||M.length===0)return e;var S=t.query.index,O=S.multiEntry,T=t.query.range,P=a.schema.primaryKey.extractKey,L=S.extractKey,x=(S.lowLevelIndex||S).extractKey,M=M.reduce(function(j,R){var U=j,F=[];if(R.type==="add"||R.type==="put")for(var V=new Ut,W=R.values.length-1;0<=W;--W){var Q,Z=R.values[W],le=P(Z);V.hasKey(le)||(Q=L(Z),(O&&y(Q)?Q.some(function(ve){return Ei(ve,T)}):Ei(Q,T))&&(V.addKey(le),F.push(Z)))}switch(R.type){case"add":var ge=new Ut().addKeys(t.values?j.map(function(Ie){return P(Ie)}):j),U=j.concat(t.values?F.filter(function(Ie){return Ie=P(Ie),!ge.hasKey(Ie)&&(ge.addKey(Ie),!0)}):F.map(function(Ie){return P(Ie)}).filter(function(Ie){return!ge.hasKey(Ie)&&(ge.addKey(Ie),!0)}));break;case"put":var ae=new Ut().addKeys(R.values.map(function(Ie){return P(Ie)}));U=j.filter(function(Ie){return!ae.hasKey(t.values?P(Ie):Ie)}).concat(t.values?F:F.map(function(Ie){return P(Ie)}));break;case"delete":var pe=new Ut().addKeys(R.keys);U=j.filter(function(Ie){return!pe.hasKey(t.values?P(Ie):Ie)});break;case"deleteRange":var _e=R.range;U=j.filter(function(Ie){return!Ei(P(Ie),_e)})}return U},e);return M===e?e:(M.sort(function(j,R){return rt(x(j),x(R))||rt(P(j),P(R))}),t.limit&&t.limit<1/0&&(M.length>t.limit?M.length=t.limit:e.length===t.limit&&M.length<t.limit&&(d.dirty=!0)),v?Object.freeze(M):M)}function Mo(e,t){return rt(e.lower,t.lower)===0&&rt(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Xa(e,t){return function(i,a,d,v){if(i===void 0)return a!==void 0?-1:0;if(a===void 0)return 1;if((a=rt(i,a))===0){if(d&&v)return 0;if(d)return 1;if(v)return-1}return a}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(i,a,d,v){if(i===void 0)return a!==void 0?1:0;if(a===void 0)return-1;if((a=rt(i,a))===0){if(d&&v)return 0;if(d)return-1;if(v)return 1}return a}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Qa(e,t,i,a){e.subscribers.add(i),a.addEventListener("abort",function(){var d,v;e.subscribers.delete(i),e.subscribers.size===0&&(d=e,v=t,setTimeout(function(){d.subscribers.size===0&&ce(v,d)},3e3))})}var Za={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return s(s({},e),{transaction:function(i,a,d){var v,S,O=e.transaction(i,a,d);return a==="readwrite"&&(S=(v=new AbortController).signal,d=function(T){return function(){if(v.abort(),a==="readwrite"){for(var P=new Set,L=0,x=i;L<x.length;L++){var M=x[L],j=En["idb://".concat(t,"/").concat(M)];if(j){var R=e.table(M),U=j.optimisticOps.filter(function(Ie){return Ie.trans===O});if(O._explicit&&T&&O.mutatedParts)for(var F=0,V=Object.values(j.queries.query);F<V.length;F++)for(var W=0,Q=(ge=V[F]).slice();W<Q.length;W++)gi((ae=Q[W]).obsSet,O.mutatedParts)&&(ce(ge,ae),ae.subscribers.forEach(function(Ie){return P.add(Ie)}));else if(0<U.length){j.optimisticOps=j.optimisticOps.filter(function(Ie){return Ie.trans!==O});for(var Z=0,le=Object.values(j.queries.query);Z<le.length;Z++)for(var ge,ae,pe,_e=0,ve=(ge=le[Z]).slice();_e<ve.length;_e++)(ae=ve[_e]).res!=null&&O.mutatedParts&&(T&&!ae.dirty?(pe=Object.isFrozen(ae.res),pe=Fo(ae.res,ae.req,U,R,ae,pe),ae.dirty?(ce(ge,ae),ae.subscribers.forEach(function(Ie){return P.add(Ie)})):pe!==ae.res&&(ae.res=pe,ae.promise=te.resolve({result:pe}))):(ae.dirty&&ce(ge,ae),ae.subscribers.forEach(function(Ie){return P.add(Ie)})))}}}P.forEach(function(Ie){return Ie()})}}},O.addEventListener("abort",d(!1),{signal:S}),O.addEventListener("error",d(!1),{signal:S}),O.addEventListener("complete",d(!0),{signal:S})),O},table:function(i){var a=e.table(i),d=a.schema.primaryKey;return s(s({},a),{mutate:function(v){var S=G.trans;if(d.outbound||S.db._options.cache==="disabled"||S.explicit||S.idbtrans.mode!=="readwrite")return a.mutate(v);var O=En["idb://".concat(t,"/").concat(i)];return O?(S=a.mutate(v),v.type!=="add"&&v.type!=="put"||!(50<=v.values.length||xi(d,v).some(function(T){return T==null}))?(O.optimisticOps.push(v),v.mutatedParts&&Tr(v.mutatedParts),S.then(function(T){0<T.numFailures&&(ce(O.optimisticOps,v),(T=$o(0,v,T))&&O.optimisticOps.push(T),v.mutatedParts&&Tr(v.mutatedParts))}),S.catch(function(){ce(O.optimisticOps,v),v.mutatedParts&&Tr(v.mutatedParts)})):S.then(function(T){var P=$o(0,s(s({},v),{values:v.values.map(function(L,x){var M;return T.failures[x]?L:(L=(M=d.keyPath)!==null&&M!==void 0&&M.includes(".")?ke(L):s({},L),oe(L,d.keyPath,T.results[x]),L)})}),T);O.optimisticOps.push(P),queueMicrotask(function(){return v.mutatedParts&&Tr(v.mutatedParts)})}),S):a.mutate(v)},query:function(v){if(!Ko(G,a)||!Lo("query",v))return a.query(v);var S=((P=G.trans)===null||P===void 0?void 0:P.db._options.cache)==="immutable",x=G,O=x.requery,T=x.signal,P=function(R,U,F,V){var W=En["idb://".concat(R,"/").concat(U)];if(!W)return[];if(!(U=W.queries[F]))return[null,!1,W,null];var Q=U[(V.query?V.query.index.name:null)||""];if(!Q)return[null,!1,W,null];switch(F){case"query":var Z=Q.find(function(le){return le.req.limit===V.limit&&le.req.values===V.values&&Mo(le.req.query.range,V.query.range)});return Z?[Z,!0,W,Q]:[Q.find(function(le){return("limit"in le.req?le.req.limit:1/0)>=V.limit&&(!V.values||le.req.values)&&Xa(le.req.query.range,V.query.range)}),!1,W,Q];case"count":return Z=Q.find(function(le){return Mo(le.req.query.range,V.query.range)}),[Z,!!Z,W,Q]}}(t,i,"query",v),L=P[0],x=P[1],M=P[2],j=P[3];return L&&x?L.obsSet=v.obsSet:(x=a.query(v).then(function(R){var U=R.result;if(L&&(L.res=U),S){for(var F=0,V=U.length;F<V;++F)Object.freeze(U[F]);Object.freeze(U)}else R.result=ke(U);return R}).catch(function(R){return j&&L&&ce(j,L),Promise.reject(R)}),L={obsSet:v.obsSet,promise:x,subscribers:new Set,type:"query",req:v,dirty:!1},j?j.push(L):(j=[L],(M=M||(En["idb://".concat(t,"/").concat(i)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[v.query.index.name||""]=j)),Qa(L,j,O,T),L.promise.then(function(R){return{result:Fo(R.result,v,M==null?void 0:M.optimisticOps,a,L,S)}})}})}})}};function Ir(e,t){return new Proxy(e,{get:function(i,a,d){return a==="db"?t:Reflect.get(i,a,d)}})}var ln=(_t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new $.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new $.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,i=t.filter(function(a){return a._cfg.version===e})[0];return i||(i=new this.Version(e),t.push(i),t.sort(Ma),i.stores({}),this._state.autoSchema=!1,i)},_t.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||G.letThrough||this._vip)?e():new te(function(i,a){if(t._state.openComplete)return a(new $.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void a(new $.DatabaseClosed);t.open().catch(fe)}t._state.dbReadyPromise.then(i,a)}).then(e)},_t.prototype.use=function(e){var t=e.stack,i=e.create,a=e.level,d=e.name;return d&&this.unuse({stack:t,name:d}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:i,level:a==null?10:a,name:d}),e.sort(function(v,S){return v.level-S.level}),this},_t.prototype.unuse=function(e){var t=e.stack,i=e.name,a=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(d){return a?d.create!==a:!!i&&d.name!==i})),this},_t.prototype.open=function(){var e=this;return Qt(ue,function(){return za(e)})},_t.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=Vt.indexOf(this);if(0<=t&&Vt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new te(function(i){e.dbReadyResolve=i}),e.openCanceller=new te(function(i,a){e.cancelOpen=a}))},_t.prototype.close=function(i){var t=(i===void 0?{disableAutoOpen:!0}:i).disableAutoOpen,i=this._state;t?(i.isBeingOpened&&i.cancelOpen(new $.DatabaseClosed),this._close(),i.autoOpen=!1,i.dbOpenError=new $.DatabaseClosed):(this._close(),i.autoOpen=this._options.autoOpen||i.isBeingOpened,i.openComplete=!1,i.dbOpenError=null)},_t.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var i=0<arguments.length&&typeof arguments[0]!="object",a=this._state;return new te(function(d,v){function S(){t.close(e);var O=t._deps.indexedDB.deleteDatabase(t.name);O.onsuccess=we(function(){var T,P,L;T=t._deps,P=t.name,L=T.indexedDB,T=T.IDBKeyRange,vi(L)||P===cn||yi(L,T).delete(P).catch(fe),d()}),O.onerror=rn(v),O.onblocked=t._fireOnBlocked}if(i)throw new $.InvalidArgument("Invalid closeOptions argument to db.delete()");a.isBeingOpened?a.dbReadyPromise.then(S):S()})},_t.prototype.backendDB=function(){return this.idbdb},_t.prototype.isOpen=function(){return this.idbdb!==null},_t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},_t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},_t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(_t.prototype,"tables",{get:function(){var e=this;return u(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),_t.prototype.transaction=function(){var e=(function(t,i,a){var d=arguments.length;if(d<2)throw new $.InvalidArgument("Too few arguments");for(var v=new Array(d-1);--d;)v[d-1]=arguments[d];return a=v.pop(),[t,g(v),a]}).apply(this,arguments);return this._transaction.apply(this,e)},_t.prototype._transaction=function(e,t,i){var a=this,d=G.trans;d&&d.db===this&&e.indexOf("!")===-1||(d=null);var v,S,O=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(S=t.map(function(P){if(P=P instanceof a.Table?P.name:P,typeof P!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return P}),e=="r"||e===ii)v=ii;else{if(e!="rw"&&e!=oi)throw new $.InvalidArgument("Invalid transaction mode: "+e);v=oi}if(d){if(d.mode===ii&&v===oi){if(!O)throw new $.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");d=null}d&&S.forEach(function(P){if(d&&d.storeNames.indexOf(P)===-1){if(!O)throw new $.SubTransaction("Table "+P+" not included in parent transaction.");d=null}}),O&&d&&!d.active&&(d=null)}}catch(P){return d?d._promise(null,function(L,x){x(P)}):ht(P)}var T=(function P(L,x,M,j,R){return te.resolve().then(function(){var U=G.transless||G,F=L._createTransaction(x,M,L._dbSchema,j);if(F.explicit=!0,U={trans:F,transless:U},j)F.idbtrans=j.idbtrans;else try{F.create(),F.idbtrans._explicit=!0,L._state.PR1398_maxLoop=3}catch(Q){return Q.name===J.InvalidState&&L.isOpen()&&0<--L._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),L.close({disableAutoOpen:!1}),L.open().then(function(){return P(L,x,M,null,R)})):ht(Q)}var V,W=xe(R);return W&&At(),U=te.follow(function(){var Q;(V=R.call(F,F))&&(W?(Q=ot.bind(null,null),V.then(Q,Q)):typeof V.next=="function"&&typeof V.throw=="function"&&(V=ki(V)))},U),(V&&typeof V.then=="function"?te.resolve(V).then(function(Q){return F.active?Q:ht(new $.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):U.then(function(){return V})).then(function(Q){return j&&F._resolve(),F._completion.then(function(){return Q})}).catch(function(Q){return F._reject(Q),ht(Q)})})}).bind(null,this,v,S,d,i);return d?d._promise(v,T,"lock"):G.trans?Qt(G.transless,function(){return a._whenReady(T)}):this._whenReady(T)},_t.prototype.table=function(e){if(!h(this._allTables,e))throw new $.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},_t);function _t(e,t){var i=this;this._middlewares={},this.verno=0;var a=_t.dependencies;this._options=t=s({addons:_t.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},a=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var d,v,S,O,T,P={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:fe,dbReadyPromise:null,cancelOpen:fe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};P.dbReadyPromise=new te(function(x){P.dbReadyResolve=x}),P.openCanceller=new te(function(x,M){P.cancelOpen=M}),this._state=P,this.name=e,this.on=Vn(this,"populate","blocked","versionchange","close",{ready:[$t,fe]}),this.once=function(x,M){var j=function(){for(var R=[],U=0;U<arguments.length;U++)R[U]=arguments[U];i.on(x).unsubscribe(j),M.apply(i,R)};return i.on(x,j)},this.on.ready.subscribe=B(this.on.ready.subscribe,function(x){return function(M,j){_t.vip(function(){var R,U=i._state;U.openComplete?(U.dbOpenError||te.resolve().then(M),j&&x(M)):U.onReadyBeingFired?(U.onReadyBeingFired.push(M),j&&x(M)):(x(M),R=i,j||x(function F(){R.on.ready.unsubscribe(M),R.on.ready.unsubscribe(F)}))})}}),this.Collection=(d=this,Wn(Ra.prototype,function(V,F){this.db=d;var j=mo,R=null;if(F)try{j=F()}catch(W){R=W}var U=V._ctx,F=U.table,V=F.hook.reading.fire;this._ctx={table:F,index:U.index,isPrimKey:!U.index||F.schema.primKey.keyPath&&U.index===F.schema.primKey.name,range:j,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:R,or:U.or,valueMapper:V!==Ee?V:null}})),this.Table=(v=this,Wn(ko.prototype,function(x,M,j){this.db=v,this._tx=j,this.name=x,this.schema=M,this.hook=v._allTables[x]?v._allTables[x].hook:Vn(null,{creating:[ut,fe],reading:[Ae,Ee],updating:[mt,fe],deleting:[wt,fe]})})),this.Transaction=(S=this,Wn(Ka.prototype,function(x,M,j,R,U){var F=this;x!=="readonly"&&M.forEach(function(V){V=(V=j[V])===null||V===void 0?void 0:V.yProps,V&&(M=M.concat(V.map(function(W){return W.updatesTable})))}),this.db=S,this.mode=x,this.storeNames=M,this.schema=j,this.chromeTransactionDurability=R,this.idbtrans=null,this.on=Vn(this,"complete","error","abort"),this.parent=U||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new te(function(V,W){F._resolve=V,F._reject=W}),this._completion.then(function(){F.active=!1,F.on.complete.fire()},function(V){var W=F.active;return F.active=!1,F.on.error.fire(V),F.parent?F.parent._reject(V):W&&F.idbtrans&&F.idbtrans.abort(),ht(V)})})),this.Version=(O=this,Wn(Wa.prototype,function(x){this.db=O,this._cfg={version:x,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(T=this,Wn(To.prototype,function(x,M,j){if(this.db=T,this._ctx={table:x,index:M===":id"?null:M,or:j},this._cmp=this._ascending=rt,this._descending=function(R,U){return rt(U,R)},this._max=function(R,U){return 0<rt(R,U)?R:U},this._min=function(R,U){return rt(R,U)<0?R:U},this._IDBKeyRange=T._deps.IDBKeyRange,!this._IDBKeyRange)throw new $.MissingAPI})),this.on("versionchange",function(x){0<x.newVersion?console.warn("Another connection wants to upgrade database '".concat(i.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(i.name,"'. Closing db now to resume the delete request.")),i.close({disableAutoOpen:!1})}),this.on("blocked",function(x){!x.newVersion||x.newVersion<x.oldVersion?console.warn("Dexie.delete('".concat(i.name,"') was blocked")):console.warn("Upgrade '".concat(i.name,"' blocked by other connection holding version ").concat(x.oldVersion/10))}),this._maxKey=Hn(t.IDBKeyRange),this._createTransaction=function(x,M,j,R){return new i.Transaction(x,M,j,i._options.chromeTransactionDurability,R)},this._fireOnBlocked=function(x){i.on("blocked").fire(x),Vt.filter(function(M){return M.name===i.name&&M!==i&&!M._state.vcFired}).map(function(M){return M.on("versionchange").fire(x)})},this.use(Ga),this.use(Za),this.use(Ya),this.use(Ja),this.use(Ha);var L=new Proxy(this,{get:function(x,M,j){if(M==="_vip")return!0;if(M==="table")return function(U){return Ir(i.table(U),L)};var R=Reflect.get(x,M,j);return R instanceof ko?Ir(R,L):M==="tables"?R.map(function(U){return Ir(U,L)}):M==="_createTransaction"?function(){return Ir(R.apply(this,arguments),L)}:R}});this.vip=L,a.forEach(function(x){return x(i)})}var jr,Yt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",eu=(Ai.prototype.subscribe=function(e,t,i){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:i})},Ai.prototype[Yt]=function(){return this},Ai);function Ai(e){this._subscribe=e}try{jr={indexedDB:c.indexedDB||c.mozIndexedDB||c.webkitIndexedDB||c.msIndexedDB,IDBKeyRange:c.IDBKeyRange||c.webkitIDBKeyRange}}catch{jr={indexedDB:null,IDBKeyRange:null}}function qo(e){var t,i=!1,a=new eu(function(d){var v=xe(e),S,O=!1,T={},P={},L={get closed(){return O},unsubscribe:function(){O||(O=!0,S&&S.abort(),x&&mn.storagemutated.unsubscribe(j))}};d.start&&d.start(L);var x=!1,M=function(){return nn(R)},j=function(U){Ar(T,U),gi(P,T)&&M()},R=function(){var U,F,V;!O&&jr.indexedDB&&(T={},U={},S&&S.abort(),S=new AbortController,V=function(W){var Q=gt();try{v&&At();var Z=Qe(e,W);return Z=v?Z.finally(ot):Z}finally{Q&&Te()}}(F={subscr:U,signal:S.signal,requery:M,querier:e,trans:null}),Promise.resolve(V).then(function(W){i=!0,t=W,O||F.signal.aborted||(T={},function(Q){for(var Z in Q)if(h(Q,Z))return;return 1}(P=U)||x||(mn(Jn,j),x=!0),nn(function(){return!O&&d.next&&d.next(W)}))},function(W){i=!1,["DatabaseClosedError","AbortError"].includes(W==null?void 0:W.name)||O||nn(function(){O||d.error&&d.error(W)})}))};return setTimeout(M,0),L});return a.hasValue=function(){return i},a.getValue=function(){return t},a}var An=ln;function Ti(e){var t=bn;try{bn=!0,mn.storagemutated.fire(e),Si(e,!0)}finally{bn=t}}k(An,s(s({},ie),{delete:function(e){return new An(e,{addons:[]}).delete()},exists:function(e){return new An(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=An.dependencies,i=t.indexedDB,t=t.IDBKeyRange,(vi(i)?Promise.resolve(i.databases()).then(function(a){return a.map(function(d){return d.name}).filter(function(d){return d!==cn})}):yi(i,t).toCollection().primaryKeys()).then(e)}catch{return ht(new $.MissingAPI)}var t,i},defineClass:function(){return function(e){b(this,e)}},ignoreTransaction:function(e){return G.trans?Qt(G.transless,e):e()},vip:mi,async:function(e){return function(){try{var t=ki(e.apply(this,arguments));return t&&typeof t.then=="function"?t:te.resolve(t)}catch(i){return ht(i)}}},spawn:function(e,t,i){try{var a=ki(e.apply(i,t||[]));return a&&typeof a.then=="function"?a:te.resolve(a)}catch(d){return ht(d)}},currentTransaction:{get:function(){return G.trans||null}},waitFor:function(e,t){return t=te.resolve(typeof e=="function"?An.ignoreTransaction(e):e).timeout(t||6e4),G.trans?G.trans.waitFor(t):t},Promise:te,debug:{get:function(){return kt},set:function(e){Bt(e)}},derive:D,extend:b,props:k,override:B,Events:Vn,on:mn,liveQuery:qo,extendObservabilitySet:Ar,getByKeyPath:se,setByKeyPath:oe,delByKeyPath:function(e,t){typeof t=="string"?oe(e,t,void 0):"length"in t&&[].map.call(t,function(i){oe(e,i,void 0)})},shallowClone:Le,deepClone:ke,getObjectDiff:Oi,cmp:rt,asap:ne,minKey:-1/0,addons:[],connections:Vt,errnames:J,dependencies:jr,cache:En,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,i){return e+t/Math.pow(10,2*i)})})),An.maxKey=Hn(An.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(mn(Jn,function(e){bn||(e=new CustomEvent(ui,{detail:e}),bn=!0,dispatchEvent(e),bn=!1)}),addEventListener(ui,function(e){e=e.detail,bn||Ti(e)}));var Rn,bn=!1,Vo=function(){};return typeof BroadcastChannel<"u"&&((Vo=function(){(Rn=new BroadcastChannel(ui)).onmessage=function(e){return e.data&&Ti(e.data)}})(),typeof Rn.unref=="function"&&Rn.unref(),mn(Jn,function(e){bn||Rn.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!ln.disableBfCache&&e.persisted){kt&&console.debug("Dexie: handling persisted pagehide"),Rn!=null&&Rn.close();for(var t=0,i=Vt;t<i.length;t++)i[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!ln.disableBfCache&&e.persisted&&(kt&&console.debug("Dexie: handling persisted pageshow"),Vo(),Ti({all:new Ut(-1/0,[[]])}))})),te.rejectionMapper=function(e,t){return!e||e instanceof Fe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!H[e.name]?e:(t=new H[e.name](t||e.message,e),"stack"in e&&N(t,"stack",{get:function(){return this.inner.stack}}),t)},Bt(kt),s(ln,Object.freeze({__proto__:null,Dexie:ln,liveQuery:qo,Entity:bo,cmp:rt,PropModification:qn,replacePrefix:function(e,t){return new qn({replacePrefix:[e,t]})},add:function(e){return new qn({add:e})},remove:function(e){return new qn({remove:e})},default:ln,RangeSet:Ut,mergeRanges:Xn,rangesOverlap:No}),{default:ln}),ln})})(Us);var hu=Us.exports;const Li=pu(hu),Qo=Symbol.for("Dexie"),nt=globalThis[Qo]||(globalThis[Qo]=Li);if(Li.semVer!==nt.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Li.semVer} and ${nt.semVer}`);const{liveQuery:jn,mergeRanges:Qc,rangesOverlap:Zc,RangeSet:yu,cmp:io,Entity:el,PropModification:Zo,replacePrefix:tl,add:nl,remove:rl,DexieYProvider:il}=nt;function je(n,r,o,s){return new(o||(o=Promise))(function(f,c){function u(l){try{b(s.next(l))}catch(m){c(m)}}function y(l){try{b(s.throw(l))}catch(m){c(m)}}function b(l){var m;l.done?f(l.value):(m=l.value,m instanceof o?m:new o(function(h){h(m)})).then(u,y)}b((s=s.apply(n,r||[])).next())})}function vu(n){var r=typeof Symbol=="function"&&Symbol.iterator,o=r&&n[r],s=0;if(o)return o.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function sn(n){return this instanceof sn?(this.v=n,this):new sn(n)}function mu(n,r,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,f=o.apply(n,r||[]),c=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",function(h){return function(k){return Promise.resolve(k).then(h,l)}}),s[Symbol.asyncIterator]=function(){return this},s;function u(h,k){f[h]&&(s[h]=function(E){return new Promise(function(N,D){c.push([h,E,N,D])>1||y(h,E)})},k&&(s[h]=k(s[h])))}function y(h,k){try{(function(E){E.value instanceof sn?Promise.resolve(E.value.v).then(b,l):m(c[0][2],E)})(f[h](k))}catch(E){m(c[0][3],E)}}function b(h){y("next",h)}function l(h){y("throw",h)}function m(h,k){h(k),c.shift(),c.length&&y(c[0][0],c[0][1])}}function bu(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n[Symbol.asyncIterator];return o?o.call(n):(n=vu(n),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(f){r[f]=n[f]&&function(c){return new Promise(function(u,y){(function(b,l,m,h){Promise.resolve(h).then(function(k){b({value:k,done:m})},l)})(u,y,(c=n[f](c)).done,c.value)})}}}const gu={}.hasOwnProperty;function Wr(n,r,o){if(n&&r!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(n)))if(typeof r!="string"&&"length"in r){(function(l){if(!l)throw new Error("Assertion Failed")})(typeof o!="string"&&"length"in o);for(var s=0,f=r.length;s<f;++s)Wr(n,r[s],o[s])}else{var c=r.indexOf(".");if(c!==-1){var u=r.substr(0,c),y=r.substr(c+1);if(y==="")o===void 0?Array.isArray(n)?isNaN(parseInt(u))||n.splice(parseInt(u),1):delete n[u]:n[u]=o;else{var b=n[u];b&&function(l,m){return gu.call(l,m)}(n,u)||(b=n[u]={}),Wr(b,y,o)}}else o===void 0?Array.isArray(n)&&!isNaN(parseInt(r))?n.splice(r,1):delete n[r]:n[r]=o}}const wu=typeof self<"u"&&typeof crypto<"u"?(n,r=crypto.getRandomValues.bind(crypto))=>{const o=new Uint8Array(n);return r(o),self.btoa(String.fromCharCode.apply(null,o))}:typeof Buffer<"u"?(n,r=_u)=>{const o=Buffer.alloc(n);return r(o),o.toString("base64")}:()=>{throw new Error("No implementation of randomString was found")};function _u(n){for(let r=0;r<n.length;++r)n[r]=Math.floor(256*Math.random())}function oo(n){return typeof n=="string"||!!(Array.isArray(n)&&n.some(r=>oo(r))&&n.every(Ds))}function Ds(n){return typeof n=="string"||typeof n=="number"||Array.isArray(n)&&n.every(Ds)}function Su(n,r,o){const s=n[r]||(n[r]={}),f=o.keys.map(c=>typeof c=="string"?c:JSON.stringify(c));switch(o.type){case"insert":case"upsert":f.forEach((c,u)=>{s[c]={type:"ups",val:o.values[u]}});break;case"update":case"modify":f.forEach((c,u)=>{const y=o.type==="update"?o.changeSpecs[u]:o.changeSpec,b=s[c];if(b)switch(b.type){case"ups":for(const[l,m]of Object.entries(y))Wr(b.val,l,m);break;case"del":break;case"upd":Object.assign(b.mod,y)}else s[c]={type:"upd",mod:y}});break;case"delete":f.forEach(c=>{s[c]={type:"del"}})}return n}function es(n,r){for(const{table:o,muts:s}of r)for(const f of s)Su(n,o,f)}async function*ku(n){let r=0,o=new Uint8Array(4),s=0,f=[],c=0;for await(const u of n){const y=new DataView(u.buffer,u.byteOffset,u.byteLength);let b=0;for(;b<u.byteLength;)switch(r){case 0:if(b+4>u.byteLength){for(const l of u.slice(b)){if(s===4)break;o[s++]=l,++b}if(s<4)break}else if(s>0&&s<4)for(const l of u.slice(b,b+4-s))o[s++]=l,++b;case 1:c=s===4?new DataView(o.buffer,0,4).getUint32(0,!1):y.getUint32(b,!1),s?s=0:b+=4;case 2:if(b>=u.byteLength){r=2;break}if(b+c>u.byteLength)f.push(u.slice(b)),c-=u.byteLength-b,r=2,b=u.byteLength;else{if(f.length>0){const l=new Uint8Array(f.reduce((h,k)=>h+k.byteLength,c));let m=0;for(const h of f)l.set(h,m),m+=h.byteLength;l.set(u.slice(b,b+c),m),f=[],yield l}else yield u.slice(b,b+c);b+=c,r=0}}}}function Ks(n,r){return je(this,void 0,void 0,function*(){try{const o=yield navigator.serviceWorker.ready;if(r==="push"&&o.sync&&(yield o.sync.register(`dexie-cloud:${n.name}`)),!o.active)throw new Error("Failed to trigger sync - there's no active service worker");return void o.active.postMessage({type:"dexie-cloud-sync",dbName:n.name,purpose:r})}catch{}})}function pn(n,r){n.cloud.usingServiceWorker?Ks(n,r):n.localSyncEvent.next({purpose:r})}const Ou="fromBase64"in Uint8Array,xu="toBase64"in Uint8Array.prototype,so=typeof Buffer<"u"?n=>Buffer.from(n,"base64"):Ou?n=>Uint8Array.fromBase64(n):n=>{const r=atob(n),o=r.length,s=new Uint8Array(o);for(var f=0;f<o;f++)s[f]=r.charCodeAt(f);return s},Mn=typeof Buffer<"u"?n=>ArrayBuffer.isView(n)?Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"):Buffer.from(n).toString("base64"):xu?n=>(ArrayBuffer.isView(n)?n:new Uint8Array(n)).toBase64():n=>{const r=ArrayBuffer.isView(n)?n:new Uint8Array(n),o=[];for(let s=0,f=r.length;s<f;s+=4096){const c=r.subarray(s,s+4096);o.push(String.fromCharCode.apply(null,c))}return btoa(o.join(""))};class $i extends Error{constructor({title:r,message:o,messageCode:s,messageParams:f}){super(o),this.name="TokenErrorResponseError",this.title=r,this.messageCode=s,this.messageParams=f}}function hr(n,r){return new Promise((o,s)=>{const f=Object.assign(Object.assign({submitLabel:"Submit",cancelLabel:"Cancel"},r),{onSubmit:c=>{n.next(void 0),o(c)},onCancel:()=>{n.next(void 0),s(new nt.AbortError("User cancelled"))}});n.next(f)})}function Fi(n,r,...o){return hr(n,{type:"message-alert",title:r,alerts:o,fields:{},submitLabel:"OK",cancelLabel:null})}function ts(n,r,o){return je(this,void 0,void 0,function*(){let s=o||"";for(;!s||!/^[\w-+.]+@([\w-]+\.)+[\w-]{2,10}(\sas\s[\w-+.]+@([\w-]+\.)+[\w-]{2,10})?$/.test(s);)s=(yield hr(n,{type:"email",title:r,alerts:s?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})).email;return s})}function ns(n,r,o){return je(this,void 0,void 0,function*(){const s=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:r}}];o&&s.push(o);const{otp:f}=yield hr(n,{type:"otp",title:"Enter OTP",alerts:s,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}});return f})}function Xr(n){return je(this,void 0,void 0,function*(){var r,o,s;const f=yield n.getCurrentUser(),{accessToken:c,accessTokenExpiration:u,refreshToken:y,refreshTokenExpiration:b,claims:l}=f;if(!c)return null;if(((r=u==null?void 0:u.getTime())!==null&&r!==void 0?r:1/0)>Date.now()&&(((o=f.license)===null||o===void 0?void 0:o.status)||"ok")==="ok")return f;if(!y)throw new Error("Refresh token missing");if(((s=b==null?void 0:b.getTime())!==null&&s!==void 0?s:1/0)<=Date.now())throw new Error("Refresh token has expired");const m=yield Qr(n.cloud.options.databaseUrl,f);return yield n.table("$logins").update(l.sub,{accessToken:m.accessToken,accessTokenExpiration:m.accessTokenExpiration,claims:m.claims,license:m.license,data:m.data}),m})}function Eu(n,r,o,s,f){return je(this,void 0,void 0,function*(){return r.accessToken&&r.accessTokenExpiration.getTime()>Date.now()?r:r.refreshToken&&(!r.refreshTokenExpiration||r.refreshTokenExpiration.getTime()>Date.now())?yield Qr(n,r):yield function(c,u,y,b){return je(this,void 0,void 0,function*(){if(!crypto.subtle)throw typeof location<"u"&&location.protocol==="http:"?new Error("Dexie Cloud Addon needs to use WebCrypto, but your browser has disabled it due to being served from an insecure location. Please serve it from https or http://localhost:<port> (See https://stackoverflow.com/questions/46670556/how-to-enable-crypto-subtle-for-unsecure-origins-in-chrome/46671627#46671627)"):new Error("This browser does not support WebCrypto.");const{privateKey:l,publicKey:m}=yield crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"]);if(!l||!m)throw new Error("Could not generate RSA keypair");c.nonExportablePrivateKey=l;const h=function(k){const E=Mn(k);return function(N){let D=`-----BEGIN PUBLIC KEY-----
`;for(;N.length>0;)D+=N.substring(0,64)+`
`,N=N.substring(64);return D+="-----END PUBLIC KEY-----",D}(E)}(yield crypto.subtle.exportKey("spki",m));c.publicKey=m;try{const k=yield u({public_key:h,hints:b});if(k.type==="error")throw new $i(k);if(k.type!=="tokens")throw new Error(`Unexpected response type from token endpoint: ${k.type}`);return c.accessToken=k.accessToken,c.accessTokenExpiration=new Date(k.accessTokenExpiration),c.refreshToken=k.refreshToken,k.refreshTokenExpiration&&(c.refreshTokenExpiration=new Date(k.refreshTokenExpiration)),c.userId=k.claims.sub,c.email=k.claims.email,c.name=k.claims.name,c.claims=k.claims,c.license={type:k.userType,status:k.claims.license||"ok"},c.data=k.data,k.evalDaysLeft!=null&&(c.license.evalDaysLeft=k.evalDaysLeft),k.userValidUntil!=null&&(c.license.validUntil=new Date(k.userValidUntil)),k.alerts&&k.alerts.length>0&&(yield hr(y,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:k.alerts})),c}catch(k){if(k instanceof $i)throw yield Fi(y,k.title,{type:"error",messageCode:k.messageCode,message:k.message,messageParams:{}}),k;let E="We're having a problem authenticating right now.";throw k instanceof TypeError&&(E=typeof navigator!==void 0&&!navigator.onLine?"You seem to be offline. Please connect to the internet and try again.":nt.debug||typeof location<"u"&&(location.hostname==="localhost"||location.hostname==="127.0.0.1")?`Could not connect to server. Please verify that your origin '${location.origin}' is whitelisted using \`npx dexie-cloud whitelist\``:"Could not connect to server. Please verify the connection.",yield Fi(y,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:E,messageParams:{}}).catch(()=>{})),k}})}(r,o,s,f)})}function Qr(n,r){return je(this,void 0,void 0,function*(){if(!r.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!r.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");const o=Date.now(),s="RSASSA-PKCS1-v1_5",f=new TextEncoder().encode(r.refreshToken+o),c=yield crypto.subtle.sign(s,r.nonExportablePrivateKey,f),u=Mn(c),y={grant_type:"refresh_token",refresh_token:r.refreshToken,scopes:["ACCESS_DB"],signature:u,signing_algorithm:s,time_stamp:o},b=yield fetch(`${n}/token`,{body:JSON.stringify(y),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});if(b.status!==200)throw new Error(`RefreshToken: Status ${b.status} from ${n}/token`);const l=yield b.json();if(l.type==="error")throw new $i(l);return r.accessToken=l.accessToken,r.accessTokenExpiration=l.accessTokenExpiration?new Date(l.accessTokenExpiration):void 0,r.claims=l.claims,r.license={type:l.userType,status:l.claims.license||"ok"},l.evalDaysLeft!=null&&(r.license.evalDaysLeft=l.evalDaysLeft),l.userValidUntil!=null&&(r.license.validUntil=new Date(l.userValidUntil)),l.data&&(r.data=l.data),r})}const rs=new WeakMap;class ao{constructor(r,o){rs.set(this,r),Object.assign(this,o)}static load(r,o){return r.table("$logins").get(o).then(s=>new ao(r,s||{userId:o,claims:{sub:o},lastLogin:new Date(0)}))}save(){return je(this,void 0,void 0,function*(){rs.get(this).table("$logins").put(this)})}}const Wt={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(Wt),Object.freeze(Wt.claims)}catch{}function Ls(n,r){return In(_n(n).pipe(Zt(r)))}function $s(n){return je(this,void 0,void 0,function*(){const r=yield Mi(n);if(r){if(!(yield function(o,s,f){return je(this,void 0,void 0,function*(){const c=[{type:"warning",messageCode:"LOGOUT_CONFIRMATION",message:`{numUnsyncedChanges} unsynced changes will get lost!
                Logout anyway?`,messageParams:{currentUserId:s,numUnsyncedChanges:f.toString()}}];return yield hr(o,{type:"logout-confirmation",title:"Confirm Logout",alerts:c,fields:{},submitLabel:"Confirm logout",cancelLabel:"Cancel"}).then(()=>!0).catch(()=>!1)})}(n.cloud.userInteraction,n.cloud.currentUserId,r)))throw new Error("User cancelled logout due to unsynced changes");yield Mi(n,{deleteUnsyncedData:!0})}})}function Mi(n){return je(this,arguments,void 0,function*(r,{deleteUnsyncedData:o=!1}={}){const[s,f]=yield r.dx.transaction("rw",r.dx.tables,c=>je(this,void 0,void 0,function*(){const u=c.idbtrans;u.disableChangeTracking=!0,u.disableAccessControl=!0;const y=c.storeNames.filter(l=>l.endsWith("_mutations")),b=(yield Promise.all(y.map(l=>c.table(l).count()))).reduce((l,m)=>l+m,0);if(b>0&&!o)return[b,!1];r.$syncState.delete("syncState");for(const l of r.dx.tables)l.name!=="$jobs"&&l.name!=="$syncState"&&l.clear();return[b,!0]}));return f&&(yield Ls(r.cloud.currentUser,c=>c.userId===Wt.userId),yield r.cloud.sync({purpose:"pull",wait:!0})),s})}class qi extends Error{constructor(r,o){super(o||`${r.status} ${r.statusText}`),this.httpStatus=r.status}get name(){return"HttpError"}}function Br(n,...r){globalThis.console[n](...r)}function ji(n,r){return je(this,void 0,void 0,function*(){var o;const s=yield n.getCurrentUser(),f=s.userId;if(s.isLoggedIn&&(!r||!r.email&&!r.userId)){if((((o=s.license)===null||o===void 0?void 0:o.status)||"ok")==="ok"&&s.accessToken&&(!s.accessTokenExpiration||s.accessTokenExpiration.getTime()>Date.now()))return!1;if(s.refreshToken&&(!s.refreshTokenExpiration||s.refreshTokenExpiration.getTime()>Date.now()))return yield Xr(n),!1}const c=new ao(n,{claims:{},lastLogin:new Date(0)});return yield Eu(n.cloud.options.databaseUrl,c,n.cloud.options.fetchTokens||function(u){const{userInteraction:y}=u.cloud;return function(b){return je(this,arguments,void 0,function*({public_key:l,hints:m}){var h;let k;const E=(h=u.cloud.options)===null||h===void 0?void 0:h.databaseUrl;if(!E)throw new Error("No database URL given.");if((m==null?void 0:m.grant_type)==="demo")k={demo_user:yield ts(y,"Enter a demo user email",(m==null?void 0:m.email)||(m==null?void 0:m.userId)),grant_type:"demo",scopes:["ACCESS_DB"],public_key:l};else if(m!=null&&m.otpId&&m.otp)k={grant_type:"otp",otp_id:m.otpId,otp:m.otp,scopes:["ACCESS_DB"],public_key:l};else{const z=yield ts(y,"Enter email address",m==null?void 0:m.email);k=/@demo.local$/.test(z)?{demo_user:z,grant_type:"demo",scopes:["ACCESS_DB"],public_key:l}:{email:z,grant_type:"otp",scopes:["ACCESS_DB"]}}const N=yield fetch(`${E}/token`,{body:JSON.stringify(k),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}});if(N.status!==200){const z=yield N.text();throw yield Fi(y,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:z,messageParams:{}}).catch(()=>{}),new qi(N,z)}const D=yield N.json();if(D.type==="tokens"||D.type==="error")return D;if(k.grant_type==="otp"&&"email"in k){if(D.type!=="otp-sent")throw new Error(`Unexpected response from ${E}/token`);const z=yield ns(y,k.email),ee=Object.assign(Object.assign({},k),{otp:z||"",otp_id:D.otp_id,public_key:l});let X=yield fetch(`${E}/token`,{body:JSON.stringify(ee),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});for(;X.status===401;){const B=yield X.text();ee.otp=yield ns(y,k.email,{type:"error",messageCode:"INVALID_OTP",message:B,messageParams:{}}),X=yield fetch(`${E}/token`,{body:JSON.stringify(ee),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})}if(X.status!==200){const B=yield X.text();throw new qi(X,B)}return yield X.json()}throw new Error(`Unexpected response from ${E}/token`)})}}(n),n.cloud.userInteraction,r),f!==Wt.userId&&c.userId!==f&&(yield $s(n)),yield function(u,y){return je(this,void 0,void 0,function*(){const b=u.table("$logins");yield u.transaction("rw",b,l=>je(this,void 0,void 0,function*(){const m=yield b.toArray();yield Promise.all(m.filter(h=>h.userId!==y.userId&&h.isLoggedIn).map(h=>(h.isLoggedIn=!1,b.put(h)))),y.isLoggedIn=!0,y.lastLogin=new Date;try{yield y.save()}catch(h){try{h.name==="DataCloneError"&&(Br("debug","Login context property names:",Object.keys(y)),Br("debug","Login context property names:",Object.keys(y)),Br("debug","Login context:",y),Br("debug","Login context JSON:",JSON.stringify(y)))}catch{}throw h}})),yield Ls(u.cloud.currentUser,l=>l.userId===y.userId)})}(n,c),pn(n,"pull"),c.userId!==f})}const Vi={},or=typeof self<"u"&&self.document&&typeof navigator<"u"&&navigator.serviceWorker;or&&or.ready.then(n=>Vi.registration=n),typeof self<"u"&&"clients"in self&&!self.document&&addEventListener("message",n=>{var r,o;!((o=(r=n.data)===null||r===void 0?void 0:r.type)===null||o===void 0)&&o.startsWith("sw-broadcast-")&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(s=>{var f;return s.id!==((f=n.source)===null||f===void 0?void 0:f.id)&&s.postMessage(n.data)})});class Ci{constructor(r){this.name=r}subscribe(r){if(!or)return()=>{};const o=s=>{var f;((f=s.data)===null||f===void 0?void 0:f.type)===`sw-broadcast-${this.name}`&&r(s.data.message)};return or.addEventListener("message",o),()=>or.removeEventListener("message",o)}postMessage(r){var o;typeof self.clients=="object"?[...self.clients.matchAll({includeUncontrolled:!0})].forEach(s=>s.postMessage({type:`sw-broadcast-${this.name}`,message:r})):Vi.registration&&((o=Vi.registration.active)===null||o===void 0||o.postMessage({type:`sw-broadcast-${this.name}`,message:r}))}}const er=globalThis["lbc-events"]||(globalThis["lbc-events"]=new Map);class Rr extends ro{constructor(r){const o=typeof BroadcastChannel>"u"?new Ci(r):new BroadcastChannel(r);super(s=>{function f(y){s.next(y.detail)}function c(y){s.next(y.data)}let u;(function(y,b){er.has(y)?er.get(y).push(b):er.set(y,[b])})(`lbc-${r}`,f);try{o instanceof Ci?u=o.subscribe(y=>s.next(y)):o.addEventListener("message",c)}catch{}return()=>{(function(y,b){const l=er.get(y);if(l){const m=l.indexOf(b);m!==-1&&l.splice(m,1)}})(`lbc-${r}`,f),o instanceof Ci?u():o.removeEventListener("message",c)}}),this.name=r,this.bc=o}next(r){this.bc.postMessage(r),function(o){const s=er.get(o.type);s&&s.forEach(f=>{try{f(o)}catch{}})}(new CustomEvent(`lbc-${this.name}`,{detail:r}))}}function Wi(n){return je(this,arguments,void 0,function*({realms:r,inviteRealms:o}){const s=JSON.stringify([...r.map(u=>({realmId:u,accepted:!0})),...o.map(u=>({realmId:u,accepted:!1}))].sort((u,y)=>u.realmId<y.realmId?-1:u.realmId>y.realmId?1:0)),f=new TextEncoder().encode(s),c=yield crypto.subtle.digest("SHA-1",f);return Mn(c)})}function Fr(n){return Object.entries(n.cloud.schema||{}).filter(([,{markedForSync:r}])=>r).map(([r])=>n.tables.filter(({name:o})=>o===r)[0]).filter(r=>r)}function uo(n){return`$${n}_mutations`}function Fs(n){var r;const o=(r=/^\$(.*)_mutations$/.exec(n))===null||r===void 0?void 0:r[1];if(!o)throw new Error(`Given mutationTable ${n} is not correct`);return o}const Au=[].concat;function co(n){return Au.apply([],n)}function zi(n,r){return je(this,arguments,void 0,function*(o,s,{since:f={},limit:c=1/0}={}){const u=yield Promise.all(o.map(h=>je(this,void 0,void 0,function*(){const k=Fs(h.name),E=f[k];let N=E?h.where("rev").above(E):h;c<1/0&&(N=N.limit(c));let D=yield N.toArray();return D=function(z){return z=z.map(ee=>{if(ee.type==="modify"&&ee.criteria.index===null){const X=Object.assign(Object.assign({},ee),{criteria:void 0,changeSpec:void 0,type:"update",keys:ee.keys,changeSpecs:[ee.changeSpec]});return delete X.criteria,delete X.changeSpec,X}return ee}),z}(D),D=function(z){const ee=new Map;for(const X of z)if(X.type==="update"){if(X.keys.length!==1||X.changeSpecs.length!==1)continue;const B=""+X.keys[0],de=X.changeSpecs[0];if(Object.values(de).some(se=>typeof se=="object"&&se&&"@@propmod"in se))continue;let ne=ee.get(B);ne?ne.push({txid:X.txid,updateSpec:de}):ee.set(B,[{txid:X.txid,updateSpec:de}])}return z=z.filter(X=>{if(X.type!=="update"||X.keys.length!==1||X.changeSpecs.length!==1)return!0;const B=X.changeSpecs[0];if(Object.values(B).some(oe=>typeof oe=="object"&&oe&&"@@propmod"in oe))return!0;const de=new Set(Object.keys(X.changeSpecs[0])),ne=""+X.keys[0],se=ee.get(ne);if(!se)return!0;for(let oe=se.length-1;oe>=0;--oe){const{txid:Le,updateSpec:I}=se[oe];if(Le===X.txid)break;for(const g of Object.keys(I))de.delete(g)}return de.size!==0}),z}(D),D.map(z=>({table:k,mut:z}))}))),y=co(u).sort((h,k)=>h.mut.txid===k.mut.txid?h.mut.opNo-k.mut.opNo:h.mut.ts-k.mut.ts),b=[];let l=null,m=null;for(const{table:h,mut:k}of y)l&&l.table===h&&m===k.txid?l.muts.push(k):(l={table:h,muts:[k]},m=k.txid,b.push(l));return b})}function Ms(n){const r=new Uint8Array(n);if(typeof crypto<"u")crypto.getRandomValues(r);else for(let o=0;o<n;o++)r[o]=Math.floor(256*Math.random());if(typeof Buffer<"u"&&Buffer.from)return Buffer.from(r).toString("base64");if(typeof btoa<"u")return btoa(String.fromCharCode.apply(null,r));throw new Error("No btoa or Buffer available")}const{toString:Tu}={},is={replace:function(n){const r=Object.keys(n);let o=null;for(let f=0,c=r.length;f<c;++f)r[f][0]==="$"&&(o=o||[],o.push(r[f]));if(!o)return n;const s={...n};for(const f of o)delete s[f];for(const f of o)s["$"+f]=n[f];return s}};function qs(...n){const r=n.reduce((s,f)=>({...s,...f}),n.reduce((s,f)=>({...f,...s}),{})),o=new WeakMap;return{stringify(s,f,c){return JSON.stringify(s,function(y){const b=this[y],l=function(m){const h=typeof m;switch(typeof m){case"object":case"function":{if(m===null)return null;const E=Object.getPrototypeOf(m);if(!E)return is;let N=o.get(E);if(N!==void 0)return N;const D=(k=m,Tu.call(k).slice(8,-1)),z=Object.entries(r).find(([ee,X])=>{var B,de;return(de=(B=X==null?void 0:X.test)===null||B===void 0?void 0:B.call(X,m,D))!==null&&de!==void 0?de:ee===D});return N=z==null?void 0:z[1],N||(N=Array.isArray(m)?null:typeof m=="function"?r.function||null:is),o.set(E,N),N}default:return r[h]}var k}(b);return l?l.replace(b,f,r):b},c)},parse(s,f){const c=[];return JSON.parse(s,function(u,y){const b=y==null?void 0:y.$t;if(b){const m=r[b];y=m?m.revive(y,f,r):y}let l=c[c.length-1];if(l&&l[0]===y){y={...y};for(const m of l[1])delete y[m];for(const[m,h]of Object.entries(l[2]))y[m]=h;c.pop()}if(y===void 0||u[0]==="$"&&u!=="$t"){let m,h;l=c[c.length-1],l&&l[0]===this?(m=l[1],h=l[2]):c.push([this,m=[],h={}]),u[0]==="$"&&u!=="$t"?(m.push(u),h[u.substr(1)]=y):h[u]=void 0}return y})}}}const Pu={Blob:{test:(n,r)=>r==="Blob",replace:(n,r)=>{const o=r.length;return r.push(n),{$t:"Blob",mimeType:n.type,i:o}},revive:({i:n,mimeType:r},o)=>new Blob([o[n]],{type:r})}};var Iu={number:{replace:n=>{switch(!0){case isNaN(n):return{$t:"number",v:"NaN"};case n===1/0:return{$t:"number",v:"Infinity"};case n===-1/0:return{$t:"number",v:"-Infinity"};default:return n}},revive:({v:n})=>Number(n)}};const ju={bigint:{replace:n=>({$t:"bigint",v:""+n}),revive:n=>BigInt(n.v)}};var Cu={Date:{replace:n=>({$t:"Date",v:isNaN(n.getTime())?"NaN":n.toISOString()}),revive:({v:n})=>new Date(n==="NaN"?NaN:Date.parse(n))}},Nu={Set:{replace:n=>({$t:"Set",v:Array.from(n.entries())}),revive:({v:n})=>new Set(n)}},Bu={Map:{replace:n=>({$t:"Map",v:Array.from(n.entries())}),revive:({v:n})=>new Map(n)}};const Ru=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:void 0;var Uu=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((n,r)=>({...n,[r]:{replace:(o,s,f)=>({$t:r,v:f.ArrayBuffer.replace(o.byteOffset===0&&o.byteLength===o.buffer.byteLength?o.buffer:o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength),s,f).v}),revive:({v:o},s,f)=>{const c=Ru[r];return c&&new c(f.ArrayBuffer.revive({v:o},s,f))}}}),{});function Vs(n){return function(r){for(var o="",s=0,f=r.length;s<f;s++)o+=Ws[r[s]];return o}(Mn(n))}function Du(n){return so(function(r){if(typeof r!="string")throw new Error("invalid decoder input: "+r);for(var o="",s=0,f=r.length;s<f;s++)o+=Ji[r[s]];return o}(n))}const Ji={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},Ws={};for(const n of Object.keys(Ji))Ws[Ji[n]]=n;var Ku={ArrayBuffer:{replace:n=>({$t:"ArrayBuffer",v:Vs(n)}),revive:({v:n})=>{const r=Du(n);return r.buffer.byteLength===r.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}}};class Ni{constructor(r,o){this.buf=r,this.type=o}}function zs(n){const r=new XMLHttpRequest;if(r.overrideMimeType("text/plain; charset=x-user-defined"),r.open("GET",URL.createObjectURL(n),!1),r.send(),r.status!==200&&r.status!==0)throw new Error("Bad Blob access: "+r.status);return r.responseText}function Js(n){const r=new Uint8Array(n.length);for(let o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r.buffer}var Lu={Blob:{test:(n,r)=>r==="Blob"||n instanceof Ni,replace:n=>({$t:"Blob",v:Mn(n instanceof Ni?n.buf:Js(zs(n))),type:n.type}),revive:({type:n,v:r})=>{const o=so(r);return typeof Blob!==void 0?new Blob([o]):new Ni(o.buffer,n)}}};const Hs={...Iu,...ju,...Cu,...Nu,...Bu,...Uu,...Ku,...Lu};function os(n){return new Promise((r,o)=>{const s=new FileReader;s.onabort=f=>o(new Error("file read aborted")),s.onerror=f=>o(f.target.error),s.onload=f=>r(f.target.result),s.readAsArrayBuffer(n)})}var $u={undefined:{replace:()=>({$t:"undefined"}),revive:()=>{}}},Fu={File:{test:(n,r)=>r==="File",replace:n=>({$t:"File",v:Mn(Js(zs(n))),type:n.type,name:n.name,lastModified:new Date(n.lastModified).toISOString()}),revive:({type:n,v:r,name:o,lastModified:s})=>{const f=so(r);return new File([f],o,{type:n,lastModified:new Date(s).getTime()})}}};const Mu=typeof BigInt=="function"&&typeof BigInt(0)=="bigint";class ss{toString(){return this.v}constructor(r){this.v=r}}const qu=Mu?{}:{bigint:{test:n=>n instanceof ss,replace:n=>Object.assign({$t:"bigint"},n),revive:({v:n})=>new ss(n)}},Gs=Object.assign(Object.assign(Object.assign(Object.assign({},$u),qu),Fu),{PropModification:{test:n=>n instanceof Zo,replace:n=>Object.assign({$t:"PropModification"},n["@@propmod"]),revive:n=>{var{$t:r}=n,o=function(s,f){var c={};for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&f.indexOf(u)<0&&(c[u]=s[u]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var y=0;for(u=Object.getOwnPropertySymbols(s);y<u.length;y++)f.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(s,u[y])&&(c[u[y]]=s[u[y]])}return c}(n,["$t"]);return new Zo(o)}}}),lr=qs(Hs,Gs),Vu=function(...n){const r=qs(Hs,Pu,...n);return{toBinary(o){const[s,f]=this.stringify(o),c=new ArrayBuffer(4);return new DataView(c).setUint32(0,s.size),new Blob([c,s,f])},stringify(o){const s=[],f=r.stringify(o,s);return[new Blob(s.map(c=>{const u=new ArrayBuffer(4);return new DataView(u).setUint32(0,"byteLength"in c?c.byteLength:c.size),new Blob([u,c])})),f]},async parse(o,s){let f=0;const c=[],u=await os(s),y=new DataView(u);for(;f<u.byteLength;){const b=y.getUint32(f);f+=4;const l=u.slice(f,f+b);f+=b,c.push(l)}return r.parse(o,c)},async fromBinary(o){const s=new DataView(await os(o.slice(0,4))).getUint32(0),f=o.slice(4,s+4),c=await function(u){return new Promise((y,b)=>{const l=new FileReader;l.onabort=m=>b(new Error("file read aborted")),l.onerror=m=>b(m.target.error),l.onload=m=>y(m.target.result),l.readAsText(u)})}(o.slice(s+4));return await this.parse(c,f)}}}(Gs);function Wu(n,r,o){const s=[];for(let f of o){const{table:c,muts:u}=f,y=n.tables.find(m=>m.name===c);if(!y)throw new Error(`Internal error: table ${c} not found in DBCore schema`);const{primaryKey:b}=y;let l=f;u.forEach((m,h)=>{const k=!b.outbound&&(m.type==="upsert"||m.type==="insert");m.keys.forEach((E,N)=>{if(Array.isArray(E)){l===f&&(l=as(f,k));const D=l.muts[h],z=JSON.stringify(E);D.keys[N]=z}else if(E[0]==="#"){l===f&&(l=as(f,k));const D=l.muts[h];if(!r.isLoggedIn)throw new Error("Internal error: Cannot sync private IDs before authenticated");const z=`${E}:${r.userId}`;D.keys[N]=z,k&&nt.setByKeyPath(D.values[N],b.keyPath,z)}})}),s.push(l)}return s}function as(n,r){return Object.assign(Object.assign({},n),{muts:r?n.muts.map(o=>o.type!=="insert"&&o.type!=="upsert"||!o.values?Object.assign(Object.assign({},o),{keys:o.keys.slice()}):Object.assign(Object.assign({},o),{keys:o.keys.slice(),values:o.values.slice()})):n.muts.map(o=>Object.assign(Object.assign({},o),{keys:o.keys.slice()}))})}let Hi=new WeakMap;function Ys(n){return je(this,void 0,void 0,function*(){var r,o;const s=((o=(r=Hi.get(n))===null||r===void 0?void 0:r.getTime())!==null&&o!==void 0?o:0)-Date.now();s>0&&(yield new Promise(f=>setTimeout(f,s)))})}function zu(n,r,o,s,f,c,u,y,b){return je(this,void 0,void 0,function*(){const l={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},m=yield Xr(f),h=m==null?void 0:m.accessToken;h&&(l.Authorization=`Bearer ${h}`);const k={v:2,dbID:o==null?void 0:o.remoteDbId,clientIdentity:y,schema:u||{},lastPull:o?{serverRevision:o.serverRevision,yServerRevision:o.yServerRevision,realms:o.realms,inviteRealms:o.inviteRealms}:void 0,baseRevs:s,changes:Wu(f.dx.core.schema,b,n),y:r,dxcv:f.cloud.version};f.syncStateChangedEvent.next({phase:"pushing"});const E=lr.stringify(k),N=yield fetch(`${c}/sync`,{method:"post",headers:l,credentials:"include",body:E});if(f.syncStateChangedEvent.next({phase:"pulling"}),function(D,z){const ee=z.headers.get("Ratelimit-Limit"),X=z.headers.get("Ratelimit-Remaining"),B=z.headers.get("Ratelimit-Reset");if(ee&&X&&B){const de=Number(ee),ne=Math.max(0,Number(X)),se=Number(B);if(ne<de/2){const oe=Math.ceil(se/(ne+1));Hi.set(D,new Date(Date.now()+1e3*oe))}else Hi.delete(D)}}(f,N),!N.ok)throw new qi(N);if(N.headers.get("content-type")==="application/x-bison")return Vu.fromBinary(yield N.blob());{const D=yield N.text();return lr.parse(D)}})}function tr(n){if(n!=null&&n.cancelled)throw new nt.AbortError("Operation was cancelled")}let Kn=!1;function Xs(n,r,o,s){return je(this,void 0,void 0,function*(){yield n.$baseRevs.bulkPut(Object.keys(r).filter(f=>r[f].markedForSync).map(f=>({tableName:f,clientRev:(o[f]||0)+1,serverRev:s}))),yield n.$baseRevs.where("tableName").noneOf(Object.keys(r).filter(f=>r[f].markedForSync)).delete()})}function Gi(n,r={}){for(const{table:o,muts:s}of n){const f=s.length>0?s[s.length-1].rev:null;r[o]=f||r[o]||0}return r}function Ju(n,r,o){return je(this,void 0,void 0,function*(){const s=yield n.bulkGet(r),f=[],c=[];r.forEach((u,y)=>{const b=s[y];if(b){for(const[l,m]of Object.entries(o[y]))if(l===n.schema.primKey.keyPath){if(io(m,u)!==0)throw new Error("Cannot change primary key")}else nt.setByKeyPath(b,l,m);f.push(u),c.push(b)}}),yield n.schema.primKey.keyPath==null?n.bulkPut(c,f):n.bulkPut(c)})}function Qs(n,r){return je(this,void 0,void 0,function*(){for(const{table:o,muts:s}of n){if(!r.dx._allTables[o])continue;const f=r.table(o),{primaryKey:c}=f.core.schema,u=y=>{switch(y[0]){case"[":if(y.endsWith("]"))try{return JSON.parse(y)}catch{}return y;case"#":return y.endsWith(":"+r.cloud.currentUserId)?y.substr(0,y.length-r.cloud.currentUserId.length-1):y;default:return y}};for(const y of s){const b=y.keys.map(u);switch(y.type){case"insert":c.outbound?yield f.bulkAdd(y.values,b):(b.forEach((l,m)=>{nt.setByKeyPath(y.values[m],c.keyPath,l)}),yield f.bulkAdd(y.values));break;case"upsert":c.outbound?yield f.bulkPut(y.values,b):(b.forEach((l,m)=>{nt.setByKeyPath(y.values[m],c.keyPath,l)}),yield f.bulkPut(y.values));break;case"modify":b.length===1?yield f.update(b[0],y.changeSpec):yield f.where(":id").anyOf(b).modify(y.changeSpec);break;case"update":yield Ju(f,b,y.changeSpecs);break;case"delete":yield f.bulkDelete(b)}}}})}typeof self<"u"&&typeof navigator<"u"&&(Kn=navigator.onLine,self.addEventListener("online",()=>Kn=!0),self.addEventListener("offline",()=>Kn=!1));const Sn="dexie-cloud-syncer";function Zs(n,r){return n.where("i").between(r,1/0,!0).toArray()}function sr(n,r,o){var s,f,c;if(!n.dx._allTables[r])return;const u=(c=(f=(s=n.table(r))===null||s===void 0?void 0:s.schema.yProps)===null||f===void 0?void 0:f.find(y=>y.prop===o))===null||c===void 0?void 0:c.updatesTable;return u&&n.dx._allTables[u]?n.table(u):void 0}function ea(n,r){return je(this,void 0,void 0,function*(){var o;const s={};let f,c=!1;for(const u of n)try{switch(u.type){case"u-s":{const y=sr(r,u.table,u.prop);if(y){const b={k:u.k,u:u.u};u.r&&(b.r=u.r,f=u.r),s[y.name]=yield y.add(b)}break}case"u-ack":{const y=sr(r,u.table,u.prop);y&&(yield r.transaction("rw",y,b=>je(this,void 0,void 0,function*(){let l=yield b.table(y.name).get(Sn);yield b.table(y.name).put(Object.assign(Object.assign({},l||{i:Sn}),{unsentFrom:Math.max((l==null?void 0:l.unsentFrom)||1,u.i+1)}))})));break}case"u-reject":{const y=sr(r,u.table,u.prop);if(!y)break;const b=(o=yield y.get(u.i))===null||o===void 0?void 0:o.k;if(b!=null){yield r.transaction("rw",y,m=>(m.idbtrans._rejecting_y_ypdate=!0,y.where("i").aboveOrEqual(u.i).filter(h=>io(h.k,b)===0&&!(1&~(h.f||0))).delete()));const l=Ln.getDocCache(r.dx).find(u.table,b,u.prop);l&&l.destroy()}break}case"in-sync":{const y=Ln.getDocCache(r.dx).find(u.table,u.k,u.prop);y&&!y.isSynced&&y.emit("sync",[!0,y]);break}case"y-complete-sync-done":f=u.yServerRev;break;case"outdated-server-rev":c=!0}}catch{}return{receivedUntils:s,resyncNeeded:c,yServerRevision:f}})}function Hu(n,r,o){return je(this,arguments,void 0,function*(s,f,{yDownloadedRealms:c,realms:u}){if(c&&u&&u.every(m=>c[m]==="*"))return;const y=yield Xr(s),b={"Content-Type":"application/json",Accept:"application/octet-stream"};y&&(b.Authorization=`Bearer ${y.accessToken}`);const l=yield fetch(`${f}/y/download`,{body:lr.stringify({downloadedRealms:c||{}}),method:"POST",headers:b,credentials:"include"});if(!l.ok)throw new Error(`Failed to download Yjs documents from server. Status: ${l.status}`);yield async function(m,...h){let k=m();for(let E=0;E<h.length;E++)k=h[E](k);for await(const E of k);}(function(m){return async function*(){if(!m.body)throw new Error("Response body is not readable");const h=m.body.getReader();try{for(;;){const{done:k,value:E}=await h.read();if(k)return;yield E}}finally{h.releaseLock()}}}(l),ku,function(m){return mu(this,arguments,function*(){var h,k,E,N;let D=null,z=null,ee=null,X=[];function B(oe){return je(this,void 0,void 0,function*(){const Le=X[X.length-1];if(X.length>0){if(!D||!z||!ee)throw new Error(`Protocol error from ${f}/y/download`);const I=sr(s,z,ee);I&&(yield I.bulkAdd(X)),X=[]}D&&(z&&ee&&Le||oe)&&(yield s.$syncState.update("syncState",I=>{const g=I.yDownloadedRealms||{};g[D]=oe?"*":{tbl:z,prop:ee,key:Le.k},I.yDownloadedRealms=g}))})}try{try{for(var de,ne=!0,se=bu(m);!(h=(de=yield sn(se.next())).done);ne=!0){N=de.value,ne=!1;const oe=new Is(N);for(;ru(oe);)switch(iu(oe)){case 1:yield sn(B(!0)),D=gn(oe);break;case 2:yield sn(B(!1)),z=gn(oe),ee=gn(oe);break;case 3:{const Le=$r(oe),I=rr(oe);X.push({k:Le,u:I});break}}yield sn(B(!1))}}catch(oe){k={error:oe}}finally{try{ne||h||!(E=se.return)||(yield sn(E.call(se)))}finally{if(k)throw k.error}}yield sn(B(!0))}catch(oe){throw oe instanceof nt.DexieError||(yield sn(B(!1))),oe}})})})}const ta="currentSyncWorker";function Zr(n,r,o,s){return na(n,r,o,s).then(f=>(s!=null&&s.justCheckIfNeeded||n.syncStateChangedEvent.next({phase:"in-sync"}),f)).catch(f=>je(this,void 0,void 0,function*(){return s!=null&&s.justCheckIfNeeded?Promise.reject(f):Kn&&(s!=null&&s.retryImmediatelyOnFetchError)&&(f==null?void 0:f.name)==="TypeError"&&/fetch/.test(f==null?void 0:f.message)?(n.syncStateChangedEvent.next({phase:"error",error:f}),yield new Promise(c=>setTimeout(c,500)),yield Zr(n,r,o,Object.assign(Object.assign({},s),{retryImmediatelyOnFetchError:!1}))):(yield n.$syncState.update("syncState",{timestamp:new Date,error:""+f}),n.syncStateChangedEvent.next({phase:Kn?"error":"offline",error:new Error(""+(f==null?void 0:f.message)||f)}),Promise.reject(f))}))}function na(n,r,o){return je(this,arguments,void 0,function*(s,f,c,{isInitialSync:u,cancelToken:y,justCheckIfNeeded:b,purpose:l}={isInitialSync:!1}){var m;if(!(!((m=s.cloud.options)===null||m===void 0)&&m.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");const{databaseUrl:h}=f,k=yield s.getCurrentUser(),E=k.isLoggedIn?Fr(s):[],N=E.map(re=>s.table(uo(re.name))),D=yield s.getPersistedSyncState(),z=k.isLoggedIn,ee=z?function(re,me){const ce=(me==null?void 0:me.syncedTables)||[];return Fr(re).filter(Ue=>!ce.includes(Ue.name))}(s,D):[];tr(y);const X=ee.length>0;if(X){if(b)return!0;yield s.transaction("rw",ee,re=>je(this,void 0,void 0,function*(){re.idbtrans.disableChangeTracking=!0,re.idbtrans.disableAccessControl=!0,yield function(me,ce,Ue){return je(this,void 0,void 0,function*(){const De=new Set(Ue||[]);for(const xe of me)xe.name==="members"?yield xe.toCollection().modify(Ce=>{De.has(Ce.realmId)||Ce.userId&&Ce.userId!==Wt.userId||(Ce.userId=ce.userId)}):xe.name==="roles"||(xe.name==="realms"?yield xe.toCollection().modify(Ce=>{De.has(Ce.realmId)||Ce.owner!==void 0&&Ce.owner!==Wt.userId||(Ce.owner=ce.userId)}):yield xe.toCollection().modify(Ce=>{Ce.realmId&&De.has(Ce.realmId)||(Ce.owner&&Ce.owner!==Wt.userId||(Ce.owner=ce.userId),Ce.realmId&&Ce.realmId!==Wt.userId||(Ce.realmId=ce.userId))}))})}(ee,k,D==null?void 0:D.realms)})),tr(y)}const[B,de,ne,{yMessages:se,lastUpdateIds:oe}]=yield s.transaction("r",s.tables,()=>je(this,void 0,void 0,function*(){const re=yield s.getPersistedSyncState();let me=yield s.$baseRevs.toArray();me=me.filter(De=>E.some(xe=>xe.name===De.tableName));let ce=yield zi(N,s);const Ue=yield function(De,xe){return je(this,void 0,void 0,function*(){const Ce=[],Fe={};for(const Ne of xe)if(Ne.schema.yProps)for(const Me of Ne.schema.yProps){const Xe=De.table(Me.updatesTable),J=yield Xe.get(Sn),Y=(J==null?void 0:J.unsentFrom)||1,$=(J==null?void 0:J.receivedUntil)||0,H=Math.min(Y,$+1),ie=yield Zs(Xe,H);ie.length>0&&(Fe[Xe.name]=ie[ie.length-1].i);const fe={};for(const Ee of ie){const Ae=!(1&~(Ee.f||0));if(Ae&&Ee.i<Y)continue;const he=JSON.stringify(Ee.k)+"/"+Ae;let ut=fe[he];ut?(ut.u.push(Ee.u),ut.i=Math.max(Ee.i,ut.i)):(fe[he]=ut={i:Ee.i,k:Ee.k,isLocal:Ae,u:[]},ut.u.push(Ee.u))}for(const{k:Ee,isLocal:Ae,u:he,i:ut}of Object.values(fe)){const wt=he.length===1?he[0]:js(he);if(Ae)Ce.push({type:"u-c",table:Ne.name,prop:Me.prop,k:Ee,u:wt,i:ut});else{const mt=Cs(wt);Ce.push({type:"sv",table:Ne.name,prop:Me.prop,k:Ee,sv:mt})}}}return{yMessages:Ce,lastUpdateIds:Fe}})}(s,E);if(tr(y),X){const De=[...(D==null?void 0:D.realms)||[],...(D==null?void 0:D.inviteRealms)||[]],xe=yield function(Ce,Fe,Ne,Me){return je(this,void 0,void 0,function*(){const Xe=`upload-${Ms(8)}`;if(Fe.isLoggedIn&&Ce.length>0){const J=new Set(Me||[]);return(yield Promise.all(Ce.map(Y=>je(this,void 0,void 0,function*(){const{extractKey:$}=Y.core.schema.primaryKey;if(!$)return{table:Y.name,muts:[]};const H=Ne[Y.name],ie=H!=null&&H.generatedGlobalId?Y.filter(Ee=>{return $(Ee),!J.has(Ee.realmId||"")&&(Ae=$(Ee),!(he=H==null?void 0:H.idPrefix)||typeof Ae=="string"&&Ae.startsWith(he));var Ae,he}):Y.filter(Ee=>{const Ae=$(Ee);return!J.has(Ee.realmId||"")&&oo(Ae)}),fe=yield ie.toArray();if(fe.length>0){const Ee={type:"upsert",values:fe,keys:fe.map($),userId:Fe.userId,txid:Xe};return{table:Y.name,muts:[Ee]}}return{table:Y.name,muts:[]}})))).filter(Y=>Y.muts.length>0)}return[]})}(ee,k,c,De);return tr(y),ce=ce.concat(xe),[ce,re,me,Ue]}return[ce,re,me,Ue]})),Le=B.some(re=>re.muts.some(me=>me.keys.length>0))||se.some(re=>re.type==="u-c");if(b)return Le;if(l==="push"&&!Le)return!1;const I=Gi(B,de==null?void 0:de.latestRevisions),g=(de==null?void 0:de.clientIdentity)||wu(16);tr(y);const C=yield zu(B,se,de,ne,s,h,c,g,k),{done:K,newSyncState:ke}=yield s.transaction("rw",s.tables,re=>je(this,void 0,void 0,function*(){re.idbtrans.disableChangeTracking=!0,re.idbtrans.disableAccessControl=!0;for(const xe of Object.keys(c))C.schema[xe]&&(c[xe]=C.schema[xe]);yield s.$syncState.put(c,"schema");const me=yield zi(N,s,{since:I});for(const xe of N){const Ce=Fs(xe.name);if(me.some(Fe=>Fe.table===Ce&&Fe.muts.length>0)){if(I[Ce]){const Fe=I[Ce]||0;yield Promise.all([xe.where("rev").belowOrEqual(Fe).delete(),s.$baseRevs.where(":id").between([Ce,-1/0],[Ce,Fe+1],!0,!0).reverse().offset(1).delete()])}}else yield Promise.all([xe.clear(),s.$baseRevs.where({tableName:Ce}).delete()])}Gi(me,I),yield Xs(s,c,I,C.serverRevision);const ce=yield s.getPersistedSyncState();yield function(xe,Ce,Fe){return je(this,void 0,void 0,function*(){const Ne=new Set,Me=new Set,Xe=Fe?Fe.realms:[],J=Fe?Fe.inviteRealms:[],Y=new Set(Ce.realms),$=new Set(Ce.realms.concat(Ce.inviteRealms));for(const H of Xe)Y.has(H)||(Me.add(H),$.has(H)||Ne.add(H));for(const H of J.concat(Xe))$.has(H)||Ne.add(H);if(Ne.size>0||Me.size>0){const H=Fr(xe);for(const ie of H){let fe=["realms","members","roles"].includes(ie.name)?Ne:Me;fe.size!==0&&(ie.schema.indexes.some(Ee=>Ee.keyPath==="realmId"||Array.isArray(Ee.keyPath)&&Ee.keyPath[0]==="realmId")?yield ie.where("realmId").anyOf([...fe]).delete():yield ie.filter(Ee=>!!(Ee!=null&&Ee.realmId)&&fe.has(Ee.realmId)).delete())}}if(Me.size>0&&(Fe!=null&&Fe.yDownloadedRealms))for(const H of Me)delete Fe.yDownloadedRealms[H]})}(s,C,ce);const Ue=ce||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:g};z&&(Ue.syncedTables=E.map(xe=>xe.name).concat(ee.map(xe=>xe.name))),Ue.latestRevisions=I,Ue.remoteDbId=C.dbId,Ue.initiallySynced=!0,Ue.realms=C.realms,Ue.inviteRealms=C.inviteRealms,Ue.serverRevision=C.serverRevision,Ue.yServerRevision=C.serverRevision,Ue.timestamp=new Date,delete Ue.error;const De=ra(C.changes,me);if(yield Qs(De,s),C.yMessages){const{receivedUntils:xe,resyncNeeded:Ce,yServerRevision:Fe}=yield ea(C.yMessages,s);Fe&&(Ue.yServerRevision=Fe),yield function(Ne,Me,Xe){return je(this,void 0,void 0,function*(){var J,Y,$,H,ie;const fe={};for(const[Ae,he]of Object.entries(Ne))(J=fe[Ae])!==null&&J!==void 0||(fe[Ae]={}),fe[Ae].unsentFrom=he+1;for(const[Ae,he]of Object.entries(Me))(Y=fe[Ae])!==null&&Y!==void 0||(fe[Ae]={}),fe[Ae].receivedUntil=he;const Ee=Object.values(Xe.dx._dbSchema).filter(Ae=>Ae.yProps).map(Ae=>Ae.yProps.map(he=>he.updatesTable)).flat();for(const Ae of Ee){const he=fe[Ae],ut=($=he==null?void 0:he.unsentFrom)!==null&&$!==void 0?$:1,wt=(ie=(H=he==null?void 0:he.receivedUntil)!==null&&H!==void 0?H:(yield Xe.table(Ae).where("i").between(1,1/0).reverse().limit(1).primaryKeys())[0])!==null&&ie!==void 0?ie:0;yield Xe.transaction("rw",Ae,()=>je(this,void 0,void 0,function*(){const mt=yield Xe.table(Ae).get(Sn);mt?(mt.unsentFrom=Math.max(ut,mt.unsentFrom||1),mt.receivedUntil=Math.max(wt,mt.receivedUntil||0),yield Xe.table(Ae).put(mt)):yield Xe.table(Ae).add({i:Sn,unsentFrom:ut,receivedUntil:wt})}))}})}(oe,xe,s),Ce&&(Ue.yDownloadedRealms={})}return s.$syncState.put(Ue,"syncState"),{done:me.length===0,newSyncState:Ue}}));if(!K)return yield Ys(s),yield na(s,f,c,{isInitialSync:u,cancelToken:y});const be=Object.values(c).some(re=>{var me;return(me=re.yProps)===null||me===void 0?void 0:me.length}),Oe=!!C.yMessages;if(be&&Oe)try{yield Hu(s,h,ke)}catch{}return s.syncCompleteEvent.next(),!1})}function ra(n,r){const o={};es(o,n);const s={};return es(s,r),function(f,c){var u,y,b;for(const[l,m]of Object.entries(c))for(const[h,k]of Object.entries(m))switch(k.type){case"ups":{const E=(u=f[l])==null?void 0:u[h];if(E)switch(E.type){case"ups":case"upd":delete f[l][h]}}break;case"del":(y=f[l])==null||delete y[h];break;case"upd":{const E=(b=f[l])==null?void 0:b[h];if(E)switch(E.type){case"ups":for(const[N,D]of Object.entries(k.mod))Wr(E.val,N,D);break;case"del":break;case"upd":for(const N of Object.keys(k.mod))delete E.mod[N]}break}}}(o,s),function(f,c){const u={};for(const[b,l]of Object.entries(f))for(const[m,h]of Object.entries(l)){const k=u[b]||(u[b]={});(k[h.type]||(k[h.type]=[])).push({key:m,...h})}const y=[];for(const[b,l]of Object.entries(u)){const m={table:b,muts:[]};for(const[h,k]of Object.entries(l))switch(h){case"ups":{const E={type:"upsert",keys:k.map(N=>N.key),values:k.map(N=>N.val),txid:c};m.muts.push(E);break}case"upd":{const E={type:"update",keys:k.map(N=>N.key),changeSpecs:k.map(N=>N.mod),txid:c};m.muts.push(E);break}case"del":{const E={type:"delete",keys:k.map(N=>N.key),txid:c};m.muts.push(E);break}}y.push(m)}return y}(o)}function Gu(n){const r=[],o=new en(!0),s=new en(null);let f=!1,c=new Array(10).fill(0);return s.subscribe(()=>je(this,void 0,void 0,function*(){if(!f&&r.length>0){f=!0,c.shift(),c.push(Date.now()),o.next(!1);try{yield function(){return je(this,void 0,void 0,function*(){for(var u,y,b,l,m,h;r.length>0;){const k=r.shift();try{yield In(n.cloud.syncState.pipe(Zt(({phase:N})=>N==="in-sync"||N==="error")));const E=n.cloud.persistedSyncState.value;if(!k)continue;switch(k.type){case"token-expired":const N=n.cloud.currentUser.value,D=yield Qr(n.cloud.options.databaseUrl,N);yield n.table("$logins").update(N.userId,{accessToken:D.accessToken,accessTokenExpiration:D.accessTokenExpiration,claims:D.claims,license:D.license,data:D.data});break;case"realm-added":!((u=E==null?void 0:E.realms)===null||u===void 0)&&u.includes(k.realm)||!((y=E==null?void 0:E.inviteRealms)===null||y===void 0)&&y.includes(k.realm)||(yield n.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-accepted":!((b=E==null?void 0:E.realms)===null||b===void 0)&&b.includes(k.realm)||(yield n.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-removed":(!((l=E==null?void 0:E.realms)===null||l===void 0)&&l.includes(k.realm)||!((m=E==null?void 0:E.inviteRealms)===null||m===void 0)&&m.includes(k.realm))&&(yield n.cloud.sync({purpose:"pull",wait:!0}));break;case"realms-changed":yield n.cloud.sync({purpose:"pull",wait:!0});break;case"changes":if(((h=n.cloud.syncState.value)===null||h===void 0?void 0:h.phase)==="error"){pn(n,"pull");break}yield n.transaction("rw",n.dx.tables,z=>je(this,void 0,void 0,function*(){z.idbtrans.disableChangeTracking=!0,z.idbtrans.disableAccessControl=!0;const[ee,X,B]=yield Promise.all([n.getSchema(),n.getPersistedSyncState(),n.getCurrentUser()]);if(!X||!ee||!B)return;if(k.baseRev!==X.serverRevision)return void(typeof k.baseRev!="string"||typeof X.serverRevision!="bigint"&&typeof X.serverRevision!="object"||pn(n,"pull"));if((yield nt.waitFor(Wi(X)))!==k.realmSetHash)return void pn(n,"pull");let de=[];if(B.isLoggedIn){const ne=Fr(n).map(se=>n.table(uo(se.name)));de=yield zi(ne,n)}if(k.changes.length>0){const ne=ra(k.changes,de);yield Qs(ne,n)}X.latestRevisions=Gi(de,X.latestRevisions),X.serverRevision=k.newRev,yield Xs(n,ee,X.latestRevisions,k.newRev),yield n.$syncState.put(X,"syncState")}))}}catch{}}})}()}finally{c[c.length-1]-c[0]<1e4&&(yield new Promise(u=>setTimeout(u,1e3))),f=!1,o.next(!0)}}})),{enqueue:function(u){r.push(u),s.next(null)},readyToServe:o}}const us=new WeakMap,Ur={members:"@id, [userId+realmId], [email+realmId], realmId",roles:"[realmId+name]",realms:"@realmId",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"};let Yu=0;function fn(n){"vip"in n&&(n=n.vip);let r=us.get(n.cloud);if(!r){const o=new Vr;let s=new Rr(`syncstatechanged-${n.name}`),f=new Rr(`synccomplete-${n.name}`);o.id=++Yu;let c=!1;r={get name(){return n.name},close:()=>n.close(),transaction:n.transaction.bind(n),table:n.table.bind(n),get tables(){return n.tables},cloud:n.cloud,get $jobs(){return n.table("$jobs")},get $syncState(){return n.table("$syncState")},get $baseRevs(){return n.table("$baseRevs")},get $logins(){return n.table("$logins")},get realms(){return n.realms},get members(){return n.members},get roles(){return n.roles},get initiallySynced(){return c},localSyncEvent:o,get syncStateChangedEvent(){return s},get syncCompleteEvent(){return f},dx:n},Object.assign(r,{getCurrentUser:()=>r.$logins.toArray().then(y=>y.find(b=>b.isLoggedIn)||Wt),getPersistedSyncState:()=>r.$syncState.get("syncState"),getSchema:()=>r.$syncState.get("schema").then(y=>{if(y)for(const b of r.tables)b.schema.primKey&&b.schema.primKey.keyPath&&y[b.name]&&(y[b.name].primaryKey=Xu(b.schema.primKey.keyPath));return y}),getOptions:()=>r.$syncState.get("options"),setInitiallySynced(y){c=y},reconfigure(){s=new Rr(`syncstatechanged-${n.name}`),f=new Rr(`synccomplete-${n.name}`)}}),r.messageConsumer=Gu(r),r.messageProducer=new Vr,us.set(n.cloud,r)}return r}function Xu(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}const Qu=typeof InstallTrigger<"u",ia=typeof navigator<"u"&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),Zu=ia?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,ec=ia&&Zu<=605||Qu,tc=typeof self<"u"&&"clients"in self&&!self.document,{toString:nc}={};function cs(n){return nc.call(n).slice(8,-1)}function Bi(n,r){var o;return r.type==="delete"?r.keys:((o=r.keys)===null||o===void 0?void 0:o.slice())||r.values.map(n.extractKey)}function rc(n,r){return(1&r?n[0].toUpperCase():n[0].toLowerCase())+(2&r?n[1].toUpperCase():n[1].toLowerCase())+(4&r?n[2].toUpperCase():n[2].toLowerCase())}const ic=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;function oc(n){return n>="A"&&n<="Z"}let dn=0;function oa(n,r){const o=new Uint8Array(18),s=new Uint8Array(o.buffer,0,6),f=Date.now();dn>=f?++dn:dn=f,s[0]=dn/1099511627776,s[1]=dn/4294967296,s[2]=dn/16777216,s[3]=dn/65536,s[4]=dn/256,s[5]=dn;const c=new Uint8Array(o.buffer,6);return crypto.getRandomValues(c),n+Vs(new Uint8Array(o.buffer))+(r||"")}function sc(n){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:r=>Object.assign(Object.assign({},r),{table:o=>{const s=r.table(o);return Object.assign(Object.assign({},s),{mutate:f=>{var c,u;const y=f.trans;if(y.mode==="versionchange"&&(y.disableChangeTracking=!0,y.disableAccessControl=!0),y.disableChangeTracking)return s.mutate(f);if(f.type==="add"||f.type==="put"){const b=(c=n.cloud.schema)===null||c===void 0?void 0:c[o];if(b!=null&&b.generatedGlobalId){if(!((u=n.cloud.options)===null||u===void 0)&&u.databaseUrl&&!n.initiallySynced){const l=Bi(s.schema.primaryKey,f);return s.getMany({keys:l,trans:f.trans,cache:"immutable"}).then(m=>{if(m.length<l.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return s.mutate(f)})}return function(l,m){let h=null;const k=Bi(s.schema.primaryKey,l);return k.forEach((E,N)=>{if(E===void 0){const D=l.values[N].realmId||n.cloud.currentUserId,z=D.substr(D.length-3);k[N]=oa(m,z),s.schema.primaryKey.outbound||(h||(h=l.values.slice()),h[N]=nt.deepClone(h[N]),nt.setByKeyPath(h[N],s.schema.primaryKey.keyPath,k[N]))}else if(typeof E!="string"||!E.startsWith(m)&&!E.startsWith("#"+m))throw new nt.ConstraintError(`The ID "${E}" is not valid for table "${o}". Primary '@' keys requires the key to be prefixed with "${m}" (or "#${m}).
If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.`)}),s.mutate(Object.assign(Object.assign({},l),{keys:k,values:h||l.values}))}(f,b.idPrefix)}b!=null&&b.markedForSync&&Bi(s.schema.primaryKey,f).forEach((l,m)=>{if(!oo(l)){const h=Array.isArray(l)?l.map(cs).join(","):cs(l);throw new nt.ConstraintError(`Invalid primary key type ${h} for table ${o}. Tables marked for sync has primary keys of type string or Array of string (and optional numbers)`)}})}return s.mutate(f)}})}})}}let ac=0;function nr(n,r){return function(o){const{readers:s,writers:f}=o.trans[r]||(o.trans[r]={writers:[],readers:[]}),c=f.length,u=(c>0?f[c-1].then(()=>n(o),()=>n(o)):n(o)).finally(()=>{s.splice(s.indexOf(u))});return s.push(u),u}}function uc(n,r){return function(o){const{readers:s,writers:f}=o.trans[r]||(o.trans[r]={writers:[],readers:[]});let c=(f.length>0?f[f.length-1].then(()=>n(o),()=>n(o)):s.length>0?(u=s,new Promise(y=>{u.length===0&&y([]);let b=u.length;const l=new Array(b);u.forEach((m,h)=>Promise.resolve(m).then(k=>l[h]={status:"fulfilled",value:k},k=>l[h]={status:"rejected",reason:k}).then(()=>--b||y(l)))})).then(()=>n(o)):n(o)).finally(()=>{f.shift()});var u;return f.push(c),c}}const Un=new en(new Set);function fr(n){var r,o,s,f;return((r=n.cloud.options)===null||r===void 0?void 0:r.disableEagerSync)||((s=(o=n.cloud.currentUser.value)===null||o===void 0?void 0:o.license)===null||s===void 0?void 0:s.status)!=="ok"||!(!((f=n.cloud.options)===null||f===void 0)&&f.databaseUrl)}function cc({currentUserObservable:n,db:r}){return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:o=>{const s=new Set(o.schema.tables.map(u=>u.name)),f=o.schema.tables.filter(u=>!/^\$/.test(u.name)),c=new Map;for(const u of f){const y=`$${u.name}_mutations`;s.has(y)&&c.set(u.name,o.table(y))}return Object.assign(Object.assign({},o),{transaction:(u,y)=>{let b;if(y==="readwrite"){const l=u.filter(m=>{var h,k;return(k=(h=r.cloud.schema)===null||h===void 0?void 0:h[m])===null||k===void 0?void 0:k.markedForSync}).map(m=>uo(m));b=o.transaction([...u,...l],y)}else b=o.transaction(u,y);if(y==="readwrite"){b.txid=Ms(16),b.opCount=0,b.currentUser=n.value,Un.value.add(b),Un.next(Un.value);const l=()=>{b.removeEventListener("complete",m),b.removeEventListener("error",l),b.removeEventListener("abort",l),Un.value.delete(b),Un.next(Un.value)},m=()=>{b.mutationsAdded&&!fr(r)&&pn(r,"push"),l()};b.addEventListener("complete",m),b.addEventListener("error",l),b.addEventListener("abort",l)}return b},table:u=>{const y=o.table(u);if(/^\$/.test(u))return u.endsWith("_mutations")?Object.assign(Object.assign({},y),{mutate:h=>(h.type!=="add"&&h.type!=="put"||(h.trans.mutationsAdded=!0),y.mutate(h))}):u==="$logins"?Object.assign(Object.assign({},y),{mutate:h=>y.mutate(h).then(k=>(h.trans.mutationsAdded=!0,k)).catch(k=>Promise.reject(k))}):y;const{schema:b}=y,l=c.get(u);return l?function(h){const k="$lock"+ ++ac;return Object.assign(Object.assign({},h),{count:nr(h.count,k),get:nr(h.get,k),getMany:nr(h.getMany,k),openCursor:nr(h.openCursor,k),query:nr(h.query,k),mutate:uc(h.mutate,k)})}(Object.assign(Object.assign({},y),{mutate:h=>{var k,E,N;const D=h.trans;return D.txid?D.disableChangeTracking?y.mutate(h):!((E=(k=r.cloud.schema)===null||k===void 0?void 0:k[u])===null||E===void 0)&&E.markedForSync&&(!((N=D.currentUser)===null||N===void 0)&&N.isLoggedIn)?h.type==="deleteRange"?y.query({query:{range:h.range,index:b.primaryKey},trans:h.trans,values:!1}).then(z=>m({type:"delete",keys:z.result,trans:h.trans,criteria:{index:null,range:h.range}})):m(h):y.mutate(h):y.mutate(h)}})):y;function m(h){var k,E;const N=h.trans,D=(E=(k=r.cloud.options)===null||k===void 0?void 0:k.unsyncedProperties)===null||E===void 0?void 0:E[u],{txid:z,currentUser:{userId:ee}}=N,{type:X}=h,B=++N.opCount;function de(ne){if(!D)return ne;let se=ne;for(const oe of Object.keys(ne))D.some(Le=>oe===Le||oe.startsWith(Le+"."))&&(se===ne&&(se=Object.assign({},ne)),delete se[oe]);return se}return y.mutate(h).then(ne=>{var se;const{numFailures:oe,failures:Le}=ne;let I=X==="delete"?h.keys:ne.results,g="values"in h?h.values:[],C="changeSpec"in h?h.changeSpec:void 0,K="updates"in h?h.updates:void 0,ke=!(!K||!("upsert"in h))&&h.upsert;if(oe&&(I=I.filter((me,ce)=>!Le[ce]),g=g.filter((me,ce)=>!Le[ce])),D){if(g=g.map(me=>{const ce=Object.assign({},me);for(const Ue of D)delete ce[Ue];return ce}),C&&(C=de(C),Object.keys(C).length===0))return ne;if(K){let me=K.changeSpecs.map(de),ce={keys:[],changeSpecs:[]};const Ue=new yu;let De=!1;if(!ke){for(let xe=0,Ce=me.length;xe<Ce;++xe)Object.keys(me[xe]).length>0?(ce.keys.push(K.keys[xe]),ce.changeSpecs.push(me[xe]),Ue.addKey(K.keys[xe])):De=!0;if(K=ce,De){let xe=[],Ce=[];for(let Fe=0,Ne=I.length;Fe<Ne;++Fe)Ue.hasKey(I[Fe])&&(xe.push(I[Fe]),Ce.push(g[Fe]));I=xe,g=Ce}}}}const be=Date.now();let Oe="criteria"in h&&h.criteria?Object.assign(Object.assign({},h.criteria),{index:h.criteria.index===b.primaryKey.keyPath?null:h.criteria.index}):void 0;if(D&&(Oe!=null&&Oe.index)){const me=(se=b.indexes.find(ce=>ce.name===Oe.index))===null||se===void 0?void 0:se.keyPath;(me?typeof me=="string"?[me]:me:[]).some(ce=>D==null?void 0:D.includes(ce))&&(Oe=void 0)}const re=h.type==="delete"?{type:"delete",ts:be,opNo:B,keys:I,criteria:Oe,txid:z,userId:ee}:h.type==="add"?{type:"insert",ts:be,opNo:B,keys:I,txid:z,userId:ee,values:g}:ke&&K?{type:"upsert",ts:be,opNo:B,keys:I,values:g,changeSpecs:K.changeSpecs.filter((me,ce)=>!Le[ce]),txid:z,userId:ee}:Oe&&C?{type:"modify",ts:be,opNo:B,keys:I,criteria:Oe,changeSpec:C,txid:z,userId:ee}:C?{type:"update",ts:be,opNo:B,keys:I,changeSpecs:I.map(()=>C),txid:z,userId:ee}:K?{type:"update",ts:be,opNo:B,keys:K.keys,changeSpecs:K.changeSpecs,txid:z,userId:ee}:{type:"upsert",ts:be,opNo:B,keys:I,values:g,txid:z,userId:ee};return"isAdditionalChunk"in h&&h.isAdditionalChunk&&(re.isAdditionalChunk=!0),I.length>0||Oe?l.mutate({type:"add",trans:N,values:[re]}).then(()=>(N.mutationsAdded=!0,ne)):ne})}}})}}}function lc(n,r){return function(o,s){var f;const c=Object.assign(Object.assign({},Ur),o);Object.keys(Ur).forEach(l=>{const m=c[l];if(m==null)throw new Error(`Cannot delete table ${l} as it is needed for access control of Dexie Cloud`);if(!o[l])return;const h=m.split(",").map(N=>N.trim()),k=Ur[l].split(",").map(N=>N.trim()),E=new Set(h.map(N=>N.replace(/([&*]|\+\+)/g,"")));if(h[0]!==k[0])throw new Error(`Cannot override primary key of table ${l}. Please declare it as {${l}: ${JSON.stringify(Ur[l])}`);for(let N=1;N<k.length;++N){const D=k[N];E.has(D.replace(/([&*]|\+\+)/g,""))||(c[l]+=`,${D}`)}});const u=r.cloud.schema||(r.cloud.schema={}),y=new Set;Object.keys(c).forEach(l=>{var m;const h=(m=c[l])===null||m===void 0?void 0:m.trim(),k=u[l]||(u[l]={});h!=null?(/^\@/.test(h)&&(c[l]=c[l].substr(1),k.generatedGlobalId=!0,k.idPrefix=function(E,N){let D=E[0].toLocaleLowerCase();for(let z=1,ee=E.length;z<ee&&D.length<3;++z)(ic.test(E[z])||oc(E[z]))&&(D+=E[z].toLowerCase());for(;N.has(D);){if(/\d/g.test(D)){if(D=D.substr(0,D.length-1)+(D[D.length-1]+1),!(D.length>3))continue;D=D.substr(0,3)}else if(D.length<3){D+="2";continue}let z=1,ee=D;for(;N.has(ee)&&z<8;)ee=rc(D,z),++z;if(z<8)D=ee;else{let X=D.charCodeAt(2)+1&127;D=D.substr(0,2)+String.fromCharCode(X)}}return D}(l,y),y.add(k.idPrefix)),/^\$/.test(l)||(c[`$${l}_mutations`]="++rev",k.markedForSync=!0),k.deleted&&(k.deleted=!1)):(k.deleted=!0,k.markedForSync=!1,c[`$${l}_mutations`]=null)});const b=n.call(this,c,s);for(const[l,m]of Object.entries(s))if(!((f=m.yProps)===null||f===void 0)&&f.length){const h=u[l];h&&(h.yProps=m.yProps.map(k=>k.prop))}return b}}function sa(n,r,o){return typeof navigator<"u"&&navigator.locks?navigator.locks.request(n.name+"|"+r,o):o()}const ar=new en(!0),Yi=new en(!0);ar.pipe(Lt(n=>n?yn(!0):yn(!1).pipe(Bs(2e4))),Ns()).subscribe(Yi);const aa=typeof document<"u"?wn(document,"visibilitychange"):yn({}),fc=aa.pipe(Zt(()=>document.visibilityState==="hidden")),dc=aa.pipe(Zt(()=>document.visibilityState==="visible")),ua=typeof window<"u"?Yr(dc,wn(window,"mousedown"),wn(window,"mousemove"),wn(window,"keydown"),wn(window,"wheel"),wn(window,"touchmove")):yn({});typeof document<"u"&&Yr(yn(!0),fc,ua).pipe(un(()=>document.visibilityState==="visible"),Ki(n=>{ar.value!==n&&ar.next(n)}),Lt(n=>n?yn(0).pipe(Bs(16e4),Ki(()=>ar.next(!1))):yn(0))).subscribe(()=>{});class pc extends Error{constructor(){super(...arguments),this.name="TokenExpiredError"}}const ca=new WeakMap,ls=new WeakMap;function la(n){let r=ls.get(n);return r||(r=new Vr,ls.set(n,r)),r}class hc extends ro{constructor(r,o,s,f,c,u,y,b){super(l=>new vc(r,o,s,f,c,b,l,u,y))}}let yc=0;class vc extends fu{constructor(r,o,s,f,c,u,y,b,l){super(()=>this.teardown()),this.id=++yc,this.subscriptions=new Set,this.reconnecting=!1,this.db=r,this.databaseUrl=r.cloud.options.databaseUrl,this.rev=o,this.yrev=s,this.realmSetHash=f,this.clientIdentity=c,this.user=u,this.subscriber=y,this.lastUserActivity=new Date,this.messageProducer=b,this.webSocketStatus=l,this.connect()}teardown(){this.disconnect()}disconnect(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch{}this.ws=null;for(const r of this.subscriptions)r.unsubscribe();this.subscriptions.clear()}reconnect(){if(!this.reconnecting){this.reconnecting=!0;try{this.disconnect()}catch{}this.connect().catch(()=>{}).then(()=>this.reconnecting=!1)}}connect(){return je(this,void 0,void 0,function*(){if(this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return;if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return;const r=this.user.accessTokenExpiration;if(r&&r<new Date)return void this.subscriber.error(new pc);this.webSocketStatus.next("connecting"),this.pinger=setInterval(()=>je(this,void 0,void 0,function*(){if(this.closed)this.teardown();else if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout(()=>{this.pinger&&(this.closed?this.teardown():this.lastServerActivity<new Date(Date.now()-2e4)&&this.reconnect())},2e4)}catch{this.reconnect()}else this.reconnect()}),3e4);const o=new URL(this.databaseUrl);o.protocol=o.protocol==="http:"?"ws":"wss";const s=new URLSearchParams;if(this.subscriber.closed)return;s.set("v","2"),this.rev&&s.set("rev",this.rev),this.yrev&&s.set("yrev",this.yrev),s.set("realmsHash",this.realmSetHash),s.set("clientId",this.clientIdentity),s.set("dxcv",this.db.cloud.version),this.user.accessToken&&s.set("token",this.user.accessToken);const f=this.ws=new WebSocket(`${o}/changes?${s}`);f.binaryType="arraybuffer",f.onclose=c=>{this.pinger&&this.reconnect()},f.onmessage=c=>{if(this.pinger){this.lastServerActivity=new Date;try{const u=typeof c.data=="string"?lr.parse(c.data):function(y){const b=new Is(y),l=gn(b);if(l==="outdated-server-rev")return{type:l};if(l==="y-complete-sync-done")return{type:l,yServerRev:gn(b)};const m=gn(b),h=gn(b);switch(l){case"u-ack":case"u-reject":return{type:l,table:m,prop:h,i:Number(Wo(b))};default:{const k=$r(b);switch(l){case"in-sync":case"doc-close":return{type:l,table:m,prop:h,k};case"aware":return{type:l,table:m,prop:h,k,u:rr(b)};case"doc-open":return{type:l,table:m,prop:h,k,serverRev:$r(b),sv:$r(b)};case"sv":return{type:l,table:m,prop:h,k,sv:rr(b)};case"u-c":return{type:l,table:m,prop:h,k,u:rr(b),i:Number(Wo(b))};case"u-s":return{type:l,table:m,prop:h,k,u:rr(b),r:b.pos<b.arr.length&&gn(b)||void 0};default:throw new TypeError(`Unknown message type: ${l}`)}}}}(new Uint8Array(c.data));if(u.type==="error")throw new Error(`Error message from dexie-cloud: ${u.error}`);if(u.type==="aware"){const y=Ln.getDocCache(this.db.dx).find(u.table,u.k,u.prop);if(y){const b=(l=>ca.get(l))(y);b&&uu(b,u.u,"server")}}else if(u.type!=="pong")if(u.type==="doc-open"){const y=Ln.getDocCache(this.db.dx).find(u.table,u.k,u.prop);y&&la(y).next()}else u.type==="u-ack"||u.type==="u-reject"||u.type==="u-s"||u.type==="in-sync"||u.type==="outdated-server-rev"||u.type==="y-complete-sync-done"?ea([u],this.db).then(y=>je(this,[y],void 0,function*({resyncNeeded:b,yServerRevision:l,receivedUntils:m}){if(l&&(yield this.db.$syncState.update("syncState",{yServerRevision:l})),u.type==="u-s"&&m){const h=sr(this.db,u.table,u.prop);if(h){const k=m[h.name];k&&(yield h.update(Sn,{receivedUntil:k}))}}b&&(yield this.db.cloud.sync({purpose:"pull",wait:!0}))})):this.subscriber.next(u)}catch(u){this.subscriber.error(u)}}};try{let c=!1;yield new Promise((u,y)=>{f.onopen=b=>{c=!0,u(null)},f.onerror=b=>{if(c)this.reconnect();else{const l=b.error||new Error("WebSocket Error");this.subscriber.error(l),this.webSocketStatus.next("error"),y(l)}}}),this.subscriptions.add(this.messageProducer.subscribe(u=>{var y,b;this.closed||(u.type==="ready"&&this.webSocketStatus.value!=="connected"&&this.webSocketStatus.next("connected"),u.type==="ready"?(this.rev=u.rev,(y=this.ws)===null||y===void 0||y.send(lr.stringify(u))):(b=this.ws)===null||b===void 0||b.send(function(l){const m=new tu;switch(Qn(m,l.type),"table"in l&&Qn(m,l.table),"prop"in l&&Qn(m,l.prop),l.type){case"u-ack":case"u-reject":zo(m,BigInt(l.i));break;case"outdated-server-rev":break;case"y-complete-sync-done":Qn(m,l.yServerRev);break;default:switch(Ii(m,l.k),l.type){case"aware":Nr(m,l.u);break;case"doc-open":Ii(m,l.serverRev),Ii(m,l.sv);break;case"doc-close":break;case"sv":Nr(m,l.sv);break;case"u-c":Nr(m,l.u),zo(m,BigInt(l.i));break;case"u-s":Nr(m,l.u),Qn(m,l.r||"")}}return nu(m)}(u)))})),this.user.isLoggedIn&&!fr(this.db)&&this.subscriptions.add(function(u){const y=co(u.tables.filter(b=>{var l,m;return((m=(l=u.cloud.schema)===null||l===void 0?void 0:l[b.name])===null||m===void 0?void 0:m.markedForSync)&&b.schema.yProps}).map(b=>b.schema.yProps.map(l=>({table:b.name,ydocProp:l.prop,updatesTable:l.updatesTable}))));return Yr(...y.map(({table:b,ydocProp:l,updatesTable:m})=>{const h=u.table(m);return _n(h.get(Sn)).pipe(Lt(k=>{let E=(k==null?void 0:k.unsentFrom)||1;return _n(jn(()=>je(this,void 0,void 0,function*(){return(yield Zs(h,E)).filter(N=>N.f&&1&N.f).map(N=>({type:"u-c",table:b,prop:l,k:N.k,u:N.u,i:N.i}))}))).pipe(Ki(N=>{N.length>0&&(E=N.at(-1).i+1)}))}))})).pipe(du(b=>b))}(this.db).subscribe(this.db.messageProducer))}catch{this.pauseUntil=new Date(Date.now()+6e4)}})}}class mc extends Error{constructor(r){super(r==="expired"?"License expired":r==="deactivated"?"User deactivated":"Invalid license"),this.name="InvalidLicenseError",r&&(this.license=r)}}function bc(n){return je(this,void 0,void 0,function*(){var r;yield(r=3e3,new Promise(o=>setTimeout(o,r))),yield In(ua)})}function fs(n){return je(this,void 0,void 0,function*(){var r;return!(!(!((r=n.cloud.options)===null||r===void 0)&&r.databaseUrl)||!n.cloud.schema)&&(yield Zr(n,n.cloud.options,n.cloud.schema,{justCheckIfNeeded:!0}))})}const Dr=new WeakMap;function fa(n,r,o,s){const f=Dr.get(n);if(f){if(f.pull||(s==null?void 0:s.purpose)==="push")return f.promise;{let u=!1;const y=n.cloud.syncState.subscribe(b=>{b.phase==="pulling"&&(u=!0)});return f.promise.then(()=>{y.unsubscribe()}).catch(b=>(y.unsubscribe(),Promise.reject(b))).then(()=>{if(!u)return fa(n,r,o,s)})}}const c=function(){return je(this,void 0,void 0,function*(){try{yield Ys(n),yield sa(n,ta,()=>Zr(n,r,o,s)),Dr.delete(n)}catch(u){throw Dr.delete(n),u}})}();return Dr.set(n,{promise:c,pull:(s==null?void 0:s.purpose)!=="push"}),c}function gc(n,r,o){let s=null,f={cancelled:!1},c=0,u=0;function y(k=1){setTimeout(()=>{const E=b?"pull":"push";u=Date.now(),fa(n,r,o,{cancelToken:f,retryImmediatelyOnFetchError:!0,purpose:E}).then(()=>{if(f.cancelled)h();else if(b||l)return b=!1,l=!1,y();m=!1,c=0,u=0}).catch(N=>{if(f.cancelled)h(),m=!1,c=0,u=0;else if(k<5){const D=1e3*[0,20,40,300,900][k];c=Date.now()+D,u=0,setTimeout(()=>y(k+1),D)}else m=!1,c=0,u=0})},0)}let b=!1,l=!1,m=!1;const h=()=>{f.cancelled=!0,s&&s.unsubscribe()};return{start:()=>{s=n.localSyncEvent.subscribe(({purpose:k})=>{(E=>{f.cancelled||(E==="pull"&&(b=!0),E==="push"&&(l=!0),m?c||u>0&&Date.now():(m=!0,y()))})(k||"pull")})},stop:h}}function Ri(n,r){if(n&&r&&r.unsyncedTables)for(const o of r.unsyncedTables)n[o]&&(n[o].markedForSync=!1)}var ei,vt,da,Pn,ds,pa,ha,ya,lo,Xi,Qi,dr={},va=[],wc=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ti=Array.isArray;function hn(n,r){for(var o in r)n[o]=r[o];return n}function fo(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function Tt(n,r,o){var s,f,c,u={};for(c in r)c=="key"?s=r[c]:c=="ref"?f=r[c]:u[c]=r[c];if(arguments.length>2&&(u.children=arguments.length>3?ei.call(arguments,2):o),typeof n=="function"&&n.defaultProps!=null)for(c in n.defaultProps)u[c]===void 0&&(u[c]=n.defaultProps[c]);return Mr(n,u,s,f,null)}function Mr(n,r,o,s,f){var c={type:n,props:r,key:o,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:f==null?++da:f,__i:-1,__u:0};return f==null&&vt.vnode!=null&&vt.vnode(c),c}function $n(n){return n.children}function ur(n,r){this.props=n,this.context=r}function Fn(n,r){if(r==null)return n.__?Fn(n.__,n.__i+1):null;for(var o;r<n.__k.length;r++)if((o=n.__k[r])!=null&&o.__e!=null)return o.__e;return typeof n.type=="function"?Fn(n):null}function ma(n){var r,o;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,r=0;r<n.__k.length;r++)if((o=n.__k[r])!=null&&o.__e!=null){n.__e=n.__c.base=o.__e;break}return ma(n)}}function ps(n){(!n.__d&&(n.__d=!0)&&Pn.push(n)&&!zr.__r++||ds!=vt.debounceRendering)&&((ds=vt.debounceRendering)||pa)(zr)}function zr(){for(var n,r,o,s,f,c,u,y=1;Pn.length;)Pn.length>y&&Pn.sort(ha),n=Pn.shift(),y=Pn.length,n.__d&&(o=void 0,s=void 0,f=(s=(r=n).__v).__e,c=[],u=[],r.__P&&((o=hn({},s)).__v=s.__v+1,vt.vnode&&vt.vnode(o),po(r.__P,o,s,r.__n,r.__P.namespaceURI,32&s.__u?[f]:null,c,f==null?Fn(s):f,!!(32&s.__u),u),o.__v=s.__v,o.__.__k[o.__i]=o,wa(c,o,u),s.__e=s.__=null,o.__e!=f&&ma(o)));zr.__r=0}function ba(n,r,o,s,f,c,u,y,b,l,m){var h,k,E,N,D,z,ee,X=s&&s.__k||va,B=r.length;for(b=function(de,ne,se,oe,Le){var I,g,C,K,ke,be=se.length,Oe=be,re=0;for(de.__k=new Array(Le),I=0;I<Le;I++)(g=ne[I])!=null&&typeof g!="boolean"&&typeof g!="function"?(typeof g=="string"||typeof g=="number"||typeof g=="bigint"||g.constructor==String?g=de.__k[I]=Mr(null,g,null,null,null):ti(g)?g=de.__k[I]=Mr($n,{children:g},null,null,null):g.constructor==null&&g.__b>0?g=de.__k[I]=Mr(g.type,g.props,g.key,g.ref?g.ref:null,g.__v):de.__k[I]=g,K=I+re,g.__=de,g.__b=de.__b+1,(ke=g.__i=_c(g,se,K,Oe))!=-1&&(Oe--,(C=se[ke])&&(C.__u|=2)),C==null||C.__v==null?(ke==-1&&(Le>be?re--:Le<be&&re++),typeof g.type!="function"&&(g.__u|=4)):ke!=K&&(ke==K-1?re--:ke==K+1?re++:(ke>K?re--:re++,g.__u|=4))):de.__k[I]=null;if(Oe)for(I=0;I<be;I++)(C=se[I])!=null&&!(2&C.__u)&&(C.__e==oe&&(oe=Fn(C)),Sa(C,C));return oe}(o,r,X,b,B),h=0;h<B;h++)(E=o.__k[h])!=null&&(k=E.__i==-1?dr:X[E.__i]||dr,E.__i=h,z=po(n,E,k,f,c,u,y,b,l,m),N=E.__e,E.ref&&k.ref!=E.ref&&(k.ref&&ho(k.ref,null,E),m.push(E.ref,E.__c||N,E)),D==null&&N!=null&&(D=N),(ee=!!(4&E.__u))||k.__k===E.__k?b=ga(E,b,n,ee):typeof E.type=="function"&&z!==void 0?b=z:N&&(b=N.nextSibling),E.__u&=-7);return o.__e=D,b}function ga(n,r,o,s){var f,c;if(typeof n.type=="function"){for(f=n.__k,c=0;f&&c<f.length;c++)f[c]&&(f[c].__=n,r=ga(f[c],r,o,s));return r}n.__e!=r&&(s&&(r&&n.type&&!r.parentNode&&(r=Fn(n)),o.insertBefore(n.__e,r||null)),r=n.__e);do r=r&&r.nextSibling;while(r!=null&&r.nodeType==8);return r}function _c(n,r,o,s){var f,c,u,y=n.key,b=n.type,l=r[o],m=l!=null&&!(2&l.__u);if(l===null&&y==null||m&&y==l.key&&b==l.type)return o;if(s>(m?1:0)){for(f=o-1,c=o+1;f>=0||c<r.length;)if((l=r[u=f>=0?f--:c++])!=null&&!(2&l.__u)&&y==l.key&&b==l.type)return u}return-1}function hs(n,r,o){r[0]=="-"?n.setProperty(r,o==null?"":o):n[r]=o==null?"":typeof o!="number"||wc.test(r)?o:o+"px"}function Kr(n,r,o,s,f){var c,u;e:if(r=="style")if(typeof o=="string")n.style.cssText=o;else{if(typeof s=="string"&&(n.style.cssText=s=""),s)for(r in s)o&&r in o||hs(n.style,r,"");if(o)for(r in o)s&&o[r]==s[r]||hs(n.style,r,o[r])}else if(r[0]=="o"&&r[1]=="n")c=r!=(r=r.replace(ya,"$1")),u=r.toLowerCase(),r=u in n||r=="onFocusOut"||r=="onFocusIn"?u.slice(2):r.slice(2),n.l||(n.l={}),n.l[r+c]=o,o?s?o.u=s.u:(o.u=lo,n.addEventListener(r,c?Qi:Xi,c)):n.removeEventListener(r,c?Qi:Xi,c);else{if(f=="http://www.w3.org/2000/svg")r=r.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(r!="width"&&r!="height"&&r!="href"&&r!="list"&&r!="form"&&r!="tabIndex"&&r!="download"&&r!="rowSpan"&&r!="colSpan"&&r!="role"&&r!="popover"&&r in n)try{n[r]=o==null?"":o;break e}catch{}typeof o=="function"||(o==null||o===!1&&r[4]!="-"?n.removeAttribute(r):n.setAttribute(r,r=="popover"&&o==1?"":o))}}function ys(n){return function(r){if(this.l){var o=this.l[r.type+n];if(r.t==null)r.t=lo++;else if(r.t<o.u)return;return o(vt.event?vt.event(r):r)}}}function po(n,r,o,s,f,c,u,y,b,l){var m,h,k,E,N,D,z,ee,X,B,de,ne,se,oe,Le,I,g,C=r.type;if(r.constructor!=null)return null;128&o.__u&&(b=!!(32&o.__u),c=[y=r.__e=o.__e]),(m=vt.__b)&&m(r);e:if(typeof C=="function")try{if(ee=r.props,X="prototype"in C&&C.prototype.render,B=(m=C.contextType)&&s[m.__c],de=m?B?B.props.value:m.__:s,o.__c?z=(h=r.__c=o.__c).__=h.__E:(X?r.__c=h=new C(ee,de):(r.__c=h=new ur(ee,de),h.constructor=C,h.render=kc),B&&B.sub(h),h.state||(h.state={}),h.__n=s,k=h.__d=!0,h.__h=[],h._sb=[]),X&&h.__s==null&&(h.__s=h.state),X&&C.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=hn({},h.__s)),hn(h.__s,C.getDerivedStateFromProps(ee,h.__s))),E=h.props,N=h.state,h.__v=r,k)X&&C.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),X&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(X&&C.getDerivedStateFromProps==null&&ee!==E&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(ee,de),r.__v==o.__v||!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(ee,h.__s,de)===!1){for(r.__v!=o.__v&&(h.props=ee,h.state=h.__s,h.__d=!1),r.__e=o.__e,r.__k=o.__k,r.__k.some(function(K){K&&(K.__=r)}),ne=0;ne<h._sb.length;ne++)h.__h.push(h._sb[ne]);h._sb=[],h.__h.length&&u.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(ee,h.__s,de),X&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(E,N,D)})}if(h.context=de,h.props=ee,h.__P=n,h.__e=!1,se=vt.__r,oe=0,X){for(h.state=h.__s,h.__d=!1,se&&se(r),m=h.render(h.props,h.state,h.context),Le=0;Le<h._sb.length;Le++)h.__h.push(h._sb[Le]);h._sb=[]}else do h.__d=!1,se&&se(r),m=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++oe<25);h.state=h.__s,h.getChildContext!=null&&(s=hn(hn({},s),h.getChildContext())),X&&!k&&h.getSnapshotBeforeUpdate!=null&&(D=h.getSnapshotBeforeUpdate(E,N)),I=m,m!=null&&m.type===$n&&m.key==null&&(I=_a(m.props.children)),y=ba(n,ti(I)?I:[I],r,o,s,f,c,u,y,b,l),h.base=r.__e,r.__u&=-161,h.__h.length&&u.push(h),z&&(h.__E=h.__=null)}catch(K){if(r.__v=null,b||c!=null)if(K.then){for(r.__u|=b?160:128;y&&y.nodeType==8&&y.nextSibling;)y=y.nextSibling;c[c.indexOf(y)]=null,r.__e=y}else{for(g=c.length;g--;)fo(c[g]);Zi(r)}else r.__e=o.__e,r.__k=o.__k,K.then||Zi(r);vt.__e(K,r,o)}else c==null&&r.__v==o.__v?(r.__k=o.__k,r.__e=o.__e):y=r.__e=Sc(o.__e,r,o,s,f,c,u,b,l);return(m=vt.diffed)&&m(r),128&r.__u?void 0:y}function Zi(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Zi)}function wa(n,r,o){for(var s=0;s<o.length;s++)ho(o[s],o[++s],o[++s]);vt.__c&&vt.__c(r,n),n.some(function(f){try{n=f.__h,f.__h=[],n.some(function(c){c.call(f)})}catch(c){vt.__e(c,f.__v)}})}function _a(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:ti(n)?n.map(_a):hn({},n)}function Sc(n,r,o,s,f,c,u,y,b){var l,m,h,k,E,N,D,z=o.props||dr,ee=r.props,X=r.type;if(X=="svg"?f="http://www.w3.org/2000/svg":X=="math"?f="http://www.w3.org/1998/Math/MathML":f||(f="http://www.w3.org/1999/xhtml"),c!=null){for(l=0;l<c.length;l++)if((E=c[l])&&"setAttribute"in E==!!X&&(X?E.localName==X:E.nodeType==3)){n=E,c[l]=null;break}}if(n==null){if(X==null)return document.createTextNode(ee);n=document.createElementNS(f,X,ee.is&&ee),y&&(vt.__m&&vt.__m(r,c),y=!1),c=null}if(X==null)z===ee||y&&n.data==ee||(n.data=ee);else{if(c=c&&ei.call(n.childNodes),!y&&c!=null)for(z={},l=0;l<n.attributes.length;l++)z[(E=n.attributes[l]).name]=E.value;for(l in z)if(E=z[l],l!="children"){if(l=="dangerouslySetInnerHTML")h=E;else if(!(l in ee)){if(l=="value"&&"defaultValue"in ee||l=="checked"&&"defaultChecked"in ee)continue;Kr(n,l,null,E,f)}}for(l in ee)E=ee[l],l=="children"?k=E:l=="dangerouslySetInnerHTML"?m=E:l=="value"?N=E:l=="checked"?D=E:y&&typeof E!="function"||z[l]===E||Kr(n,l,E,z[l],f);if(m)y||h&&(m.__html==h.__html||m.__html==n.innerHTML)||(n.innerHTML=m.__html),r.__k=[];else if(h&&(n.innerHTML=""),ba(r.type=="template"?n.content:n,ti(k)?k:[k],r,o,s,X=="foreignObject"?"http://www.w3.org/1999/xhtml":f,c,u,c?c[0]:o.__k&&Fn(o,0),y,b),c!=null)for(l=c.length;l--;)fo(c[l]);y||(l="value",X=="progress"&&N==null?n.removeAttribute("value"):N!=null&&(N!==n[l]||X=="progress"&&!N||X=="option"&&N!=z[l])&&Kr(n,l,N,z[l],f),l="checked",D!=null&&D!=n[l]&&Kr(n,l,D,z[l],f))}return n}function ho(n,r,o){try{if(typeof n=="function"){var s=typeof n.__u=="function";s&&n.__u(),s&&r==null||(n.__u=n(r))}else n.current=r}catch(f){vt.__e(f,o)}}function Sa(n,r,o){var s,f;if(vt.unmount&&vt.unmount(n),(s=n.ref)&&(s.current&&s.current!=n.__e||ho(s,null,r)),(s=n.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(c){vt.__e(c,r)}s.base=s.__P=null}if(s=n.__k)for(f=0;f<s.length;f++)s[f]&&Sa(s[f],r,o||typeof n.type!="function");o||fo(n.__e),n.__c=n.__=n.__e=void 0}function kc(n,r,o){return this.constructor(n,o)}function vs(n,r,o){var s,f,c;r==document&&(r=document.documentElement),vt.__&&vt.__(n,r),s=r.__k,f=[],c=[],po(r,n=r.__k=Tt($n,null,[n]),s||dr,dr,r.namespaceURI,s?null:r.firstChild?ei.call(r.childNodes):null,f,s?s.__e:r.firstChild,!1,c),wa(f,n,c)}ei=va.slice,vt={__e:function(n,r,o,s){for(var f,c,u;r=r.__;)if((f=r.__c)&&!f.__)try{if((c=f.constructor)&&c.getDerivedStateFromError!=null&&(f.setState(c.getDerivedStateFromError(n)),u=f.__d),f.componentDidCatch!=null&&(f.componentDidCatch(n,s||{}),u=f.__d),u)return f.__E=f}catch(y){n=y}throw n}},da=0,ur.prototype.setState=function(n,r){var o;o=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=hn({},this.state),typeof n=="function"&&(n=n(hn({},o),this.props)),n&&hn(o,n),n!=null&&this.__v&&(r&&this._sb.push(r),ps(this))},ur.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),ps(this))},ur.prototype.render=$n,Pn=[],pa=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ha=function(n,r){return n.__v.__b-r.__v.__b},zr.__r=0,ya=/(PointerCapture)$|Capture$/i,lo=0,Xi=ys(!1),Qi=ys(!0);const an={Alert:{error:{color:"red",fontWeight:"bold"},warning:{color:"#f80",fontWeight:"bold"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center",padding:"16px",boxSizing:"border-box"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"24px",marginBottom:"2em",maxWidth:"400px",width:"100%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",fontFamily:"sans-serif",boxSizing:"border-box"},Input:{height:"35px",width:"100%",maxWidth:"100%",borderColor:"#ccf4",outline:"none",fontSize:"16px",padding:"8px",boxSizing:"border-box",backgroundColor:"#f9f9f9",borderRadius:"4px",border:"1px solid #ccc",marginTop:"6px",fontFamily:"inherit"},Button:{padding:"10px 20px",margin:"0 4px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#374151",transition:"all 0.2s ease"},PrimaryButton:{padding:"10px 20px",margin:"0 4px",border:"1px solid #3b82f6",borderRadius:"6px",backgroundColor:"#3b82f6",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s ease"},ButtonsDiv:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px",paddingTop:"20px"},Label:{display:"block",marginBottom:"12px",fontSize:"14px",fontWeight:"500",color:"#333"},WindowHeader:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#333",borderBottom:"1px solid #eee",paddingBottom:"10px"}};function Oc({children:n,className:r}){return Tt("div",{className:`dexie-dialog ${r||""}`},Tt("div",{style:an.Darken}),Tt("div",{style:an.DialogOuter},Tt("div",{style:an.DialogInner},n)))}var pr,St,Ui,ms,Jr=0,ka=[],xt=vt,bs=xt.__b,gs=xt.__r,ws=xt.diffed,_s=xt.__c,Ss=xt.unmount,ks=xt.__;function yo(n,r){xt.__h&&xt.__h(St,n,Jr||r),Jr=0;var o=St.__H||(St.__H={__:[],__h:[]});return n>=o.__.length&&o.__.push({}),o.__[n]}function xc(n){return Jr=1,function(r,o){var s=yo(pr++,2);if(s.t=r,!s.__c&&(s.__=[xs(void 0,o),function(y){var b=s.__N?s.__N[0]:s.__[0],l=s.t(b,y);b!==l&&(s.__N=[l,s.__[1]],s.__c.setState({}))}],s.__c=St,!St.__f)){var f=function(y,b,l){if(!s.__c.__H)return!0;var m=s.__c.__H.__.filter(function(k){return!!k.__c});if(m.every(function(k){return!k.__N}))return!c||c.call(this,y,b,l);var h=s.__c.props!==y;return m.forEach(function(k){if(k.__N){var E=k.__[0];k.__=k.__N,k.__N=void 0,E!==k.__[0]&&(h=!0)}}),c&&c.call(this,y,b,l)||h};St.__f=!0;var c=St.shouldComponentUpdate,u=St.componentWillUpdate;St.componentWillUpdate=function(y,b,l){if(this.__e){var m=c;c=void 0,f(y,b,l),c=m}u&&u.call(this,y,b,l)},St.shouldComponentUpdate=f}return s.__N||s.__}(xs,n)}function Ec(n){return Jr=5,function(r,o){var s=yo(pr++,7);return Oa(s.__H,o)&&(s.__=r(),s.__H=o,s.__h=r),s.__}(function(){return{current:n}},[])}function Ac(){for(var n;n=ka.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(qr),n.__H.__h.forEach(eo),n.__H.__h=[]}catch(r){n.__H.__h=[],xt.__e(r,n.__v)}}xt.__b=function(n){St=null,bs&&bs(n)},xt.__=function(n,r){n&&r.__k&&r.__k.__m&&(n.__m=r.__k.__m),ks&&ks(n,r)},xt.__r=function(n){gs&&gs(n),pr=0;var r=(St=n.__c).__H;r&&(Ui===St?(r.__h=[],St.__h=[],r.__.forEach(function(o){o.__N&&(o.__=o.__N),o.u=o.__N=void 0})):(r.__h.forEach(qr),r.__h.forEach(eo),r.__h=[],pr=0)),Ui=St},xt.diffed=function(n){ws&&ws(n);var r=n.__c;r&&r.__H&&(r.__H.__h.length&&(ka.push(r)!==1&&ms===xt.requestAnimationFrame||((ms=xt.requestAnimationFrame)||Tc)(Ac)),r.__H.__.forEach(function(o){o.u&&(o.__H=o.u),o.u=void 0})),Ui=St=null},xt.__c=function(n,r){r.some(function(o){try{o.__h.forEach(qr),o.__h=o.__h.filter(function(s){return!s.__||eo(s)})}catch(s){r.some(function(f){f.__h&&(f.__h=[])}),r=[],xt.__e(s,o.__v)}}),_s&&_s(n,r)},xt.unmount=function(n){Ss&&Ss(n);var r,o=n.__c;o&&o.__H&&(o.__H.__.forEach(function(s){try{qr(s)}catch(f){r=f}}),o.__H=void 0,r&&xt.__e(r,o.__v))};var Os=typeof requestAnimationFrame=="function";function Tc(n){var r,o=function(){clearTimeout(s),Os&&cancelAnimationFrame(r),setTimeout(n)},s=setTimeout(o,35);Os&&(r=requestAnimationFrame(o))}function qr(n){var r=St,o=n.__c;typeof o=="function"&&(n.__c=void 0,o()),St=r}function eo(n){var r=St;n.__c=n.__(),St=r}function Oa(n,r){return!n||n.length!==r.length||r.some(function(o,s){return o!==n[s]})}function xs(n,r){return typeof r=="function"?r(n):r}function Pc({message:n,messageCode:r,messageParams:o}){return n.replace(/\{\w+\}/gi,s=>o[s.substring(1,s.length-1)])}function Ic({title:n,type:r,alerts:o,fields:s,submitLabel:f,cancelLabel:c,onCancel:u,onSubmit:y}){const[b,l]=xc({}),m=Ec(null);return function(h,k){var E=yo(pr++,4);!xt.__s&&Oa(E.__H,k)&&(E.__=h,E.u=k,St.__h.push(E))}(()=>{var h;return(h=m.current)===null||h===void 0?void 0:h.focus()},[]),Tt(Oc,{className:"dxc-login-dlg"},Tt($n,null,Tt("h3",{style:an.WindowHeader},n),o.map(h=>Tt("p",{style:an.Alert[h.type]},Pc(h))),Tt("form",{onSubmit:h=>{h.preventDefault(),y(b)}},Object.entries(s).map(([h,{type:k,label:E,placeholder:N}],D)=>Tt("label",{style:an.Label,key:D},E?`${E}: `:"",Tt("input",{ref:D===0?m:void 0,type:k,name:h,autoComplete:"on",style:an.Input,autoFocus:!0,placeholder:N,value:b[h]||"",onInput:z=>{var ee;const X=function(de,ne){switch(de){case"email":return ne.toLowerCase();case"otp":return ne.toUpperCase();default:return ne}}(k,(ee=z.target)===null||ee===void 0?void 0:ee.value);let B=Object.assign(Object.assign({},b),{[h]:X});l(B),k==="otp"&&(X==null?void 0:X.trim().length)===8&&y(B)}}))))),Tt("div",{style:an.ButtonsDiv},Tt($n,null,Tt("button",{type:"submit",style:an.PrimaryButton,onClick:()=>y(b)},f),c&&Tt("button",{style:an.Button,onClick:u},c))))}class Es extends ur{constructor(r){super(r),this.observer=o=>this.setState({userInteraction:o}),this.state={userInteraction:void 0}}componentDidMount(){this.subscription=_n(this.props.db.cloud.userInteraction).subscribe(this.observer)}componentWillUnmount(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)}render(r,{userInteraction:o}){return o?Tt(Ic,Object.assign({},o)):null}}function yr(n){const r=new WeakMap;return o=>{let s=r.get(o);return s||(s=n(o),r.set(o,s)),s}}const Hr=yr(n=>new en(Wt));function ni(n,r){let o=r,s=_n(n).pipe(un(c=>o=c),cu({resetOnRefCountZero:()=>lu(1e3)}));const f=new ro(c=>{let u=!1;const y=s.subscribe({next(b){u=!0,c.next(b)},error(b){c.error(b)},complete(){c.complete()}});return u||y.closed||c.next(o),y});return f.getValue=()=>o,f}const xa=yr(n=>ni(jn(()=>n.roles.where({realmId:"rlm-public"}).toArray().then(r=>{const o={};for(const s of r.slice().sort((f,c)=>(f.sortOrder||0)-(c.sortOrder||0)))o[s.name]=s;return o})),{})),Ea=yr(n=>ni(Hr(n._novip).pipe(Lt(r=>jn(()=>n.transaction("r","realms","members",()=>Promise.all([n.members.where({userId:r.userId}).toArray(),n.realms.toArray(),r.userId]).then(([o,s,f])=>({selfMembers:o,realms:s,userId:f})))))),{selfMembers:[],realms:[],get userId(){return n.cloud.currentUserId}}));function jc(...n){return n.length===0?{}:n.reduce((o,s)=>{const f=Object.assign({},o);for(const[c,u]of Object.entries(s))if(c in f&&f[c]){if(f[c]==="*")continue;if(u==="*")f[c]="*";else if(Array.isArray(u)&&Array.isArray(f[c])){const y=f,b=y[c];y[c]=[...new Set([...b,...u])]}else if(typeof u=="object"&&u&&typeof f[c]=="object"){const y=f[c];for(const[b,l]of Object.entries(u))y[b]!=="*"&&(l==="*"?y[b]="*":Array.isArray(y[b])&&Array.isArray(l)&&(y[b]=[...new Set([...y[b],...l])]))}}else f[c]=s[c];return f})}const Aa=yr(n=>function(r,o){let s;const f=r.pipe(un(c=>s=o(c)));return f.getValue=()=>s!==void 0?s:s=o(r.getValue()),f}(ni(cr([Ea(n._novip),xa(n._novip)]).pipe(un(([{selfMembers:r,realms:o,userId:s},f])=>({selfMembers:r,realms:o,userId:s,globalRoles:f}))),{selfMembers:[],realms:[],userId:Wt.userId,globalRoles:{}}),({selfMembers:r,realms:o,userId:s,globalRoles:f})=>o.map(u=>{const y=r.filter(m=>m.realmId===u.realmId),b=y.map(m=>m.permissions).filter(m=>m),l=co(y.map(m=>m.roles).filter(m=>m)).map(m=>f[m]).filter(m=>m).map(m=>m.permissions);return Object.assign(Object.assign({},u),{permissions:u.owner===s?{manage:"*"}:jc(...b,...l)})}).reduce((u,y)=>Object.assign(Object.assign({},u),{[y.realmId]:y}),{[s]:{realmId:s,owner:s,name:s,permissions:{manage:"*"}}})));class As{constructor(r,o,s){this.permissions=r||{},this.tableName=o,this.isOwner=s}add(...r){var o;return this.permissions.manage==="*"||!!(!((o=this.permissions.manage)===null||o===void 0)&&o.includes(this.tableName))||this.permissions.add==="*"||!!r.every(s=>{var f;return(f=this.permissions.add)===null||f===void 0?void 0:f.includes(s)})}update(...r){var o,s;if(this.isOwner||this.permissions.manage==="*"||!((o=this.permissions.manage)===null||o===void 0)&&o.includes(this.tableName))return!0;if(this.permissions.update==="*")return r.every(c=>c!=="owner");const f=(s=this.permissions.update)===null||s===void 0?void 0:s[this.tableName];return f==="*"?r.every(c=>c!=="owner"):r.every(c=>f==null?void 0:f.some(u=>u===c||u==="*"&&c!=="owner"))}delete(){var r;return!(!this.isOwner&&this.permissions.manage!=="*")||!!(!((r=this.permissions.manage)===null||r===void 0)&&r.includes(this.tableName))}}const Cc=yr(n=>{const r=Hr(n._novip).pipe(Lt(f=>jn(()=>n.members.where({email:f.email||""}).toArray()))),o=Aa(n._novip),s=Ea(n._novip);return ni(cr([r,s,o]).pipe(un(([f,c,u])=>{const y=(m,h)=>Object.assign(Object.assign({},m),{[h.id]:Object.assign(Object.assign({},h),{realm:u[h.realmId]})}),b=f.reduce(y,{}),l=c.selfMembers.reduce(y,b);return Object.values(l).filter(m=>!m.accepted).map(m=>Object.assign(Object.assign({},m),{accept(){return je(this,void 0,void 0,function*(){yield n.members.update(m.id,{accepted:new Date})})},reject(){return je(this,void 0,void 0,function*(){yield n.members.update(m.id,{rejected:new Date})})}}))})),[])});function Nc(n){return r=>{var o;const s=r.doc;if(!s)throw new Error("Internal error: DexieYProvider.createYHandler called without a doc. This is unexpected.");const{parentTable:f}=s.meta||{};if(!(!((o=n.cloud.schema)===null||o===void 0)&&o[f].markedForSync))return;let c;Object.defineProperty(r,"awareness",{get:()=>c||(c=function(u,y,b){const{parentTable:l,parentId:m,parentProp:h,updatesTable:k}=y.meta,E=new ou(y),N=la(y);return E.on("update",({added:D,updated:z,removed:ee},X)=>{const B=D.concat(z).concat(ee),de=u.cloud.currentUser.value;if(X!=="server"&&de.isLoggedIn&&!fr(u)){const ne=su(E,B);u.messageProducer.next({type:"aware",table:l,prop:h,k:y.meta.parentId,u:ne}),b.destroyed&&u.messageProducer.next({type:"doc-close",table:l,prop:h,k:y.meta.parentId})}}),E.on("destroy",()=>{au(E,[y.clientID],"provider destroyed")}),je(this,void 0,void 0,function*(){if(b.destroyed)return;let D=!1,z=1;const ee=cr([u.cloud.webSocketStatus,N.pipe(Rs(null))]).subscribe(([B])=>{if(b.destroyed)return;D=B==="connected";const de=u.cloud.currentUser.value;B==="connected"&&de.isLoggedIn&&!fr(u)&&(++z,X().catch(ne=>{}))});function X(){return je(this,void 0,void 0,function*(){const B=z,de=u.table(k),ne=u.$syncState,[se,oe]=yield u.transaction("r",ne,de,()=>je(this,void 0,void 0,function*(){const g=yield de.get(Sn),C=yield ne.get("syncState");return[(g==null?void 0:g.receivedUntil)||0,(C==null?void 0:C.yServerRevision)||(C==null?void 0:C.serverRevision)]}));if(b.destroyed||z!==B||!D)return;const Le={type:"doc-open",table:l,prop:h,k:m,serverRev:oe},I=yield de.where("i").between(se,1/0,!1).filter(g=>io(g.k,m)===0&&!(1&(g.f||0))).toArray();if(!b.destroyed&&z===B&&D){if(I.length>0){const g=js(I.map(K=>K.u)),C=Cs(g);Le.sv=C}u.messageProducer.next(Le)}})}b.addCleanupHandler(ee)}),E}(n,s,r),ca.set(s,c),c)})}}const Bc={nameSuffix:!0};function Ts(n){const r=n.name,o=Hr(n),s=[];let f=!1,c=null;n.on("ready",m=>je(this,void 0,void 0,function*(){try{yield function(h){return je(this,void 0,void 0,function*(){var k,E,N,D,z,ee,X;u=!1;const B=fn(h);typeof window<"u"&&typeof document<"u"&&(!((k=B.cloud.options)===null||k===void 0)&&k.customLoginGui||s.push(function(C){let K=!1;const ke=document.createElement("div");return document.body?(document.body.appendChild(ke),vs(Tt(Es,{db:C.vip}),ke)):addEventListener("DOMContentLoaded",()=>{K||(document.body.appendChild(ke),vs(Tt(Es,{db:C.vip}),ke))}),{unsubscribe(){try{ke.remove()}catch{}K=!0},get closed(){return K}}}(h))),B.cloud.isServiceWorkerDB||s.push(function(C){let K=C.cloud.webSocketStatus.value;const ke=C.cloud.webSocketStatus.pipe(Lt(be=>{const Oe=K;K=be;const re=yn(be);switch(be){case"disconnected":return ar.value?re.pipe(Jo(500)):re;case"connecting":return Oe==="not-started"||Oe==="error"?re:re.pipe(Jo(4e3));default:return re}}));return cr([ke,C.syncStateChangedEvent.pipe(Rs({phase:"initial"})),Hr(C.dx._novip),Yi]).pipe(un(([be,Oe,re,me])=>{var ce;if(!((ce=re.license)===null||ce===void 0)&&ce.status&&re.license.status!=="ok")return{phase:"offline",status:"offline",license:re.license.status};let{phase:Ue,error:De,progress:xe}=Oe,Ce=be;return Ue==="error"&&(Ce="error"),be==="not-started"&&(Ue!=="pushing"&&Ue!=="pulling"||(Ce="connecting")),C.cloud.syncState.value.phase!=="error"||Oe.phase!=="pushing"&&Oe.phase!=="pulling"||(Ce="connecting"),me||(Ce="disconnected"),{phase:Ue,error:De,progress:xe,status:Kn?Ce:"offline",license:"ok"}}))}(B).subscribe(h.cloud.syncState)),s.push(B.syncCompleteEvent.subscribe(b)),B.tables.every(C=>C.core)||function(){throw new nt.SchemaError("Version increment needed to allow dexie-cloud change tracking")}();const de="serviceWorker"in navigator?yield navigator.serviceWorker.getRegistrations():[],[ne,se]=yield B.transaction("rw",B.$syncState,()=>je(this,void 0,void 0,function*(){var C,K;const{options:ke,schema:be}=B.cloud,[Oe,re,me]=yield Promise.all([B.getOptions(),B.getSchema(),B.getPersistedSyncState()]);if(f){if(!Oe||JSON.stringify(Oe)!==JSON.stringify(ke)){if(!ke)throw new Error("Internal error");const ce=Object.assign({},ke);delete ce.fetchTokens,delete ce.awarenessProtocol,yield B.$syncState.put(ce,"options")}}else B.cloud.options=Oe||null;if(!((C=B.cloud.options)===null||C===void 0)&&C.tryUseServiceWorker&&"serviceWorker"in navigator&&de.length>0&&!ec?B.cloud.usingServiceWorker=!0:(!((K=B.cloud.options)===null||K===void 0)&&K.tryUseServiceWorker&&B.cloud.isServiceWorkerDB,B.cloud.usingServiceWorker=!1),Ri(be,B.cloud.options),Ri(re,B.cloud.options),be){if(!re||JSON.stringify(re)!==JSON.stringify(be)){const ce=re||{};for(const[Ue,De]of Object.entries(be)){const xe=ce[Ue];xe?(xe.markedForSync=De.markedForSync,De.deleted=xe.deleted,xe.generatedGlobalId=De.generatedGlobalId):ce[Ue]=Object.assign({},De)}yield B.$syncState.put(ce,"schema"),Object.assign(be,ce)}}else B.cloud.schema=re||null;return[me==null?void 0:me.initiallySynced,me==null?void 0:me.realms]}));if(ne&&B.setInitiallySynced(!0),function(C){var K,ke;for(const be of C.tables)if(!((ke=(K=C.cloud.schema)===null||K===void 0?void 0:K[be.name])===null||ke===void 0)&&ke.markedForSync){if(be.schema.primKey.auto)throw new nt.SchemaError(`Table ${be.name} is both autoIncremented and synced. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(be.name)}]}) to blacklist it from sync`);if(!be.schema.primKey.keyPath)throw new nt.SchemaError(`Table ${be.name} cannot be both synced and outbound. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(be.name)}]}) to blacklist it from sync`)}}(B),y(),!B.cloud.isServiceWorkerDB){s.push(jn(()=>B.getCurrentUser()).subscribe(o)),s.push(jn(()=>B.getPersistedSyncState()).subscribe(B.cloud.persistedSyncState)),yield In(cr([o.pipe(Ho(1),Zn(1)),B.cloud.persistedSyncState.pipe(Ho(1),Zn(1))]));const C=Nc(B);Ln.on.new.subscribe(C),B.dx.once("close",()=>{Ln.on.new.unsubscribe(C)})}let oe=!1;const Le=yield B.getCurrentUser(),I=(E=B.cloud.options)===null||E===void 0?void 0:E.requireAuth;I&&(B.cloud.isServiceWorkerDB?yield In(o.pipe(Zt(C=>!!C.isLoggedIn),Zn(1))):typeof I=="object"?(!Le.isLoggedIn||I.userId&&Le.userId!==I.userId||I.email&&Le.email!==I.email)&&(oe=yield ji(B,I)):Le.isLoggedIn||(oe=yield ji(B))),!Le.isLoggedIn||se&&se.includes(Le.userId)||(oe=!0),c&&c.stop(),c=null,y();const g=((N=B.cloud.options)===null||N===void 0?void 0:N.databaseUrl)&&(!ne||oe);g&&(yield function(C,K,ke){return je(this,void 0,void 0,function*(){yield sa(C,ta,()=>Zr(C,K,ke,{isInitialSync:!0}))})}(B,B.cloud.options,B.cloud.schema),B.setInitiallySynced(!0)),y(),B.cloud.usingServiceWorker&&(!((D=B.cloud.options)===null||D===void 0)&&D.databaseUrl)?(g||Ks(B,"push").catch(()=>{}),function(C){return je(this,void 0,void 0,function*(){var K;try{const{periodicSync:ke}=yield navigator.serviceWorker.ready;if(ke)try{yield ke.register(`dexie-cloud:${C.name}`,(K=C.cloud.options)===null||K===void 0?void 0:K.periodicSync)}catch{}}catch{}})}(B).catch(()=>{})):!((z=B.cloud.options)===null||z===void 0)&&z.databaseUrl&&B.cloud.schema&&!B.cloud.isServiceWorkerDB&&(c=gc(B,B.cloud.options,B.cloud.schema),c.start(),g||pn(B,"push")),y(),B.cloud.isServiceWorkerDB||s.push(wn(self,"online").subscribe(()=>{B.syncStateChangedEvent.next({phase:"not-in-sync"}),fr(B)||pn(B,"push")}),wn(self,"offline").subscribe(()=>{B.syncStateChangedEvent.next({phase:"offline"})})),!(!((ee=B.cloud.options)===null||ee===void 0)&&ee.databaseUrl)||!((X=B.cloud.options)===null||X===void 0)&&X.disableWebSocket||tc||s.push(function(C){var K;if(!(!((K=C.cloud.options)===null||K===void 0)&&K.databaseUrl))throw new Error("No database URL to connect WebSocket to");const ke=C.messageConsumer.readyToServe.pipe(Zt(Oe=>Oe),Lt(()=>C.getPersistedSyncState()),Zt(Oe=>Oe&&Oe.serverRevision),Lt(Oe=>je(this,void 0,void 0,function*(){return{type:"ready",rev:Oe.serverRevision,realmSetHash:yield Wi(Oe)}}))),be=Yr(ke,C.messageProducer);return function Oe(){return C.cloud.persistedSyncState.pipe(Zt(re=>re==null?void 0:re.serverRevision),Zn(1),Lt(re=>C.cloud.currentUser.pipe(un(me=>[me,re]))),Lt(([re,me])=>Yi.pipe(un(ce=>[ce?re:null,me]))),Lt(([re,me])=>re!=null&&re.isLoggedIn&&!(me!=null&&me.realms.includes(re.userId))?C.cloud.persistedSyncState.pipe(Zt(ce=>(ce==null?void 0:ce.realms.includes(re.userId))||!1),Zn(1),un(ce=>[re,ce])):new en([re,me])),Lt(re=>je(this,[re],void 0,function*([me,ce]){return[me,yield Wi(ce)]})),Ns(([re,me],[ce,Ue])=>re===ce&&me===Ue),Lt(([re,me])=>{var ce;return!((ce=C.cloud.persistedSyncState)===null||ce===void 0)&&ce.value?re?new hc(C,C.cloud.persistedSyncState.value.serverRevision,C.cloud.persistedSyncState.value.yServerRevision,me,C.cloud.persistedSyncState.value.clientIdentity,be,C.cloud.webSocketStatus,re):_n([]):Oe()}),Go(re=>(re==null?void 0:re.name)==="TokenExpiredError"?yn(!0).pipe(Lt(()=>je(this,void 0,void 0,function*(){const me=yield C.getCurrentUser(),ce=yield Qr(C.cloud.options.databaseUrl,me);yield C.table("$logins").update(me.userId,{accessToken:ce.accessToken,accessTokenExpiration:ce.accessTokenExpiration,claims:ce.claims,license:ce.license,data:ce.data})})),Lt(()=>Oe())):Yo(()=>re)),Go(re=>(C.cloud.webSocketStatus.next("error"),re instanceof mc?Yo(()=>re):_n(bc()).pipe(Lt(()=>Oe())))))}().subscribe({next:Oe=>{Oe&&C.messageConsumer.enqueue(Oe)},error:Oe=>{},complete:()=>{}})}(B))})}(m)}catch{}}),!0);let u=!1;function y(){if(u)throw new nt.DatabaseClosedError}n.once("close",()=>{s.forEach(m=>m.unsubscribe()),s.splice(0,s.length),u=!0,c&&c.stop(),c=null,o.next(Wt)});const b=new Vr;var l;n.cloud={version:"4.2.5",options:Object.assign({},Bc),schema:null,get currentUserId(){return o.value.userId||Wt.userId},currentUser:o,syncState:new en({phase:"initial",status:"not-started"}),events:{syncComplete:b},persistedSyncState:new en(void 0),userInteraction:new en(void 0),webSocketStatus:new en("not-started"),login(m){return je(this,void 0,void 0,function*(){const h=fn(n);yield h.cloud.sync(),yield ji(h,m)})},invites:Cc(n),roles:xa(n),configure(m){m=n.cloud.options=Object.assign(Object.assign({},n.cloud.options),m),f=!0,m.databaseUrl&&m.nameSuffix&&(n.name=`${r}-${function(h){const k=new URL(h);return k.pathname==="/"?k.hostname.split(".")[0]:k.pathname.split("/")[1]}(m.databaseUrl)}`,fn(n).reconfigure()),Ri(n.cloud.schema,n.cloud.options)},logout(){return je(this,arguments,void 0,function*({force:m}={}){m?yield Mi(fn(n),{deleteUnsyncedData:!0}):yield $s(fn(n))})},sync(){return je(this,arguments,void 0,function*({wait:m,purpose:h}={wait:!0,purpose:"push"}){var k;m===void 0&&(m=!0);const E=fn(n);if((((k=E.cloud.currentUser.value.license)===null||k===void 0?void 0:k.status)||"ok")!=="ok"&&(yield Xr(E)),h==="pull"){const N=E.cloud.persistedSyncState.value;if(pn(E,h),m){const D=yield In(E.cloud.persistedSyncState.pipe(Zt(z=>(z==null?void 0:z.timestamp)!=null&&(!N||z.timestamp>N.timestamp))));if(D!=null&&D.error)throw new Error("Sync error: "+D.error)}}else if(yield fs(E)){const N=E.cloud.persistedSyncState.value;pn(E,h),m&&(yield In(_n(jn(()=>je(this,void 0,void 0,function*(){const D=yield fs(E),z=yield E.getPersistedSyncState();if((z==null?void 0:z.timestamp)!==(N==null?void 0:N.timestamp)&&(z!=null&&z.error))throw new Error("Sync error: "+z.error);return D}))).pipe(Zt(D=>!D))))}})},permissions:(m,h)=>function(k,E,N){if(!E)throw new TypeError("Cannot check permissions of undefined or null. A Dexie Cloud object with realmId and owner expected.");const{owner:D,realmId:z}=E;if(!N){if(typeof E.table!="function")throw new TypeError("Missing 'table' argument to permissions and table could not be extracted from entity");N=E.table()}const ee=Aa(k),X=de=>{const ne=de[z||k.cloud.currentUserId];return ne?new As(ne.permissions,N,z===void 0||z===k.cloud.currentUserId||D===k.cloud.currentUserId):new As({},N,!D||D===k.cloud.currentUserId)},B=ee.pipe(un(X));return B.getValue=()=>X(ee.getValue()),B}(n._novip,m,h)},n.Version.prototype._parseStoresSpec=nt.override(n.Version.prototype._parseStoresSpec,m=>lc(m,n)),n.Table.prototype.newId=function({colocateWith:m}={}){const h=m&&m.substr(m.length-3);return oa(n.cloud.schema[this.name].idPrefix||"",h)},n.Table.prototype.idPrefix=function(){var m,h;return((h=(m=this.db.cloud.schema)===null||m===void 0?void 0:m[this.name])===null||h===void 0?void 0:h.idPrefix)||""},n.use(cc({currentUserObservable:n.cloud.currentUser,db:fn(n)})),n.use((l=fn(n),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:m=>Object.assign(Object.assign({},m),{table:h=>{const k=m.table(h);return Object.assign(Object.assign({},k),{mutate:E=>{var N,D,z,ee,X,B;const de=E.trans;if(de.disableChangeTracking)return k.mutate(E);const ne=(D=(N=de.currentUser)===null||N===void 0?void 0:N.userId)!==null&&D!==void 0?D:Wt.userId;if(!((ee=(z=l.cloud.schema)===null||z===void 0?void 0:z[h])===null||ee===void 0)&&ee.markedForSync&&(E.type==="add"||E.type==="put")){if(h==="members")for(const se of E.values)typeof se.email=="string"&&(se.email=se.email.trim().toLowerCase());for(const se of E.values){se.owner||(se.owner=ne),se.realmId||(se.realmId=ne);const oe=(B=(X=k.schema.primaryKey).extractKey)===null||B===void 0?void 0:B.call(X,se);typeof oe=="string"&&oe[0]==="#"&&E.type==="put"&&(delete E.criteria,delete E.changeSpec,E.upsert||delete E.updates,se.$ts=Date.now())}}return k.mutate(E)}})}})})),n.use(sc(fn(n)))}Ts.version="4.2.5",nt.Cloud=Ts;var Ps={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function kn(n,r,o,s){function f(c){return c instanceof o?c:new o(function(u){u(c)})}return new(o||(o=Promise))(function(c,u){function y(m){try{l(s.next(m))}catch(h){u(h)}}function b(m){try{l(s.throw(m))}catch(h){u(h)}}function l(m){m.done?c(m.value):f(m.value).then(y,b)}l((s=s.apply(n,[])).next())})}function tn(n,r){var o={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,f,c,u;return u={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function y(l){return function(m){return b([l,m])}}function b(l){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,f&&(c=l[0]&2?f.return:l[0]?f.throw||((c=f.return)&&c.call(f),0):f.next)&&!(c=c.call(f,l[1])).done)return c;switch(f=0,c&&(l=[l[0]&2,c.value]),l[0]){case 0:case 1:c=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,f=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(c=o.trys,!(c=c.length>0&&c[c.length-1])&&(l[0]===6||l[0]===2)){o=0;continue}if(l[0]===3&&(!c||l[1]>c[0]&&l[1]<c[3])){o.label=l[1];break}if(l[0]===6&&o.label<c[1]){o.label=c[1],c=l;break}if(c&&o.label<c[2]){o.label=c[2],o.ops.push(l);break}c[2]&&o.ops.pop(),o.trys.pop();continue}l=r.call(n,o)}catch(m){l=[6,m],f=0}finally{s=c=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Rc(n){var r=[n.schema.primKey].concat(n.schema.indexes);return r.map(function(o){return o.src}).join(",")}function Uc(n){for(var r={},o=0,s=n.tables;o<s.length;o++){var f=s[o];r[f.name]=f.schema}return r}function Ta(n,r){return new Promise(function(o,s){var f=new FileReader;f.onabort=function(c){return s(new Error("file read aborted"))},f.onerror=function(c){return s(c.target.error)},f.onload=function(c){return o(c.target.result)},r==="binary"?f.readAsArrayBuffer(n):f.readAsText(n)})}function Pa(n,r){if(typeof FileReaderSync>"u")throw new Error("FileReaderSync missing. Reading blobs synchronously requires code to run from within a web worker. Use TSON.encapsulateAsync() to do it from the main thread.");var o=new FileReaderSync,s=r==="binary"?o.readAsArrayBuffer(n):o.readAsText(n);return s}var to=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vo(n,r){return r={exports:{}},n(r,r.exports),r.exports}var ri=vo(function(n,r){(function(o,s){n.exports=s()})(to,function(){function o(J){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(Y){return typeof Y}:o=function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},o(J)}function s(J,Y,$,H,ie,fe,Ee){try{var Ae=J[fe](Ee),he=Ae.value}catch(ut){$(ut);return}Ae.done?Y(he):Promise.resolve(he).then(H,ie)}function f(J){return function(){var Y=this,$=arguments;return new Promise(function(H,ie){var fe=J.apply(Y,$);function Ee(he){s(fe,H,ie,Ee,Ae,"next",he)}function Ae(he){s(fe,H,ie,Ee,Ae,"throw",he)}Ee(void 0)})}}function c(J,Y){if(!(J instanceof Y))throw new TypeError("Cannot call a class as a function")}function u(J,Y){for(var $=0;$<Y.length;$++){var H=Y[$];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(J,H.key,H)}}function y(J,Y,$){return Y&&u(J.prototype,Y),J}function b(J,Y,$){return Y in J?Object.defineProperty(J,Y,{value:$,enumerable:!0,configurable:!0,writable:!0}):J[Y]=$,J}function l(J,Y){var $=Object.keys(J);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(J);Y&&(H=H.filter(function(ie){return Object.getOwnPropertyDescriptor(J,ie).enumerable})),$.push.apply($,H)}return $}function m(J){for(var Y=1;Y<arguments.length;Y++){var $=arguments[Y]!=null?arguments[Y]:{};Y%2?l(Object($),!0).forEach(function(H){b(J,H,$[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors($)):l(Object($)).forEach(function(H){Object.defineProperty(J,H,Object.getOwnPropertyDescriptor($,H))})}return J}function h(J,Y){return N(J)||z(J,Y)||X()}function k(J){return E(J)||D(J)||ee()}function E(J){if(Array.isArray(J)){for(var Y=0,$=new Array(J.length);Y<J.length;Y++)$[Y]=J[Y];return $}}function N(J){if(Array.isArray(J))return J}function D(J){if(Symbol.iterator in Object(J)||Object.prototype.toString.call(J)==="[object Arguments]")return Array.from(J)}function z(J,Y){if(Symbol.iterator in Object(J)||Object.prototype.toString.call(J)==="[object Arguments]"){var $=[],H=!0,ie=!1,fe=void 0;try{for(var Ee=J[Symbol.iterator](),Ae;!(H=(Ae=Ee.next()).done)&&($.push(Ae.value),!(Y&&$.length===Y));H=!0);}catch(he){ie=!0,fe=he}finally{try{!H&&Ee.return!=null&&Ee.return()}finally{if(ie)throw fe}}return $}}function ee(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function X(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var B=function J(Y){c(this,J),this.p=new Promise(Y)};B.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(B.prototype[Symbol.toStringTag]="TypesonPromise"),B.prototype.then=function(J,Y){var $=this;return new B(function(H,ie){$.p.then(function(fe){H(J?J(fe):fe)}).catch(function(fe){return Y?Y(fe):Promise.reject(fe)}).then(H,ie)})},B.prototype.catch=function(J){return this.then(null,J)},B.resolve=function(J){return new B(function(Y){Y(J)})},B.reject=function(J){return new B(function(Y,$){$(J)})},["all","race"].forEach(function(J){B[J]=function(Y){return new B(function($,H){Promise[J](Y.map(function(ie){return ie&&ie.constructor&&ie.constructor.__typeson__type__==="TypesonPromise"?ie.p:ie})).then($,H)})}});var de={},ne=de.toString,se={}.hasOwnProperty,oe=Object.getPrototypeOf,Le=se.toString;function I(J,Y){return be(J)&&typeof J.then=="function"&&(!Y||typeof J.catch=="function")}function g(J){return ne.call(J).slice(8,-1)}function C(J,Y){if(!J||o(J)!=="object")return!1;var $=oe(J);if(!$)return Y===null;var H=se.call($,"constructor")&&$.constructor;return typeof H!="function"?Y===null:Y===H||Y!==null&&Le.call(H)===Le.call(Y)||typeof Y=="function"&&typeof H.__typeson__type__=="string"&&H.__typeson__type__===Y.__typeson__type__}function K(J){if(!J||g(J)!=="Object")return!1;var Y=oe(J);return Y?C(J,Object):!0}function ke(J){if(!J||g(J)!=="Object")return!1;var Y=oe(J);return Y?C(J,Object)||ke(Y):!0}function be(J){return J&&o(J)==="object"}function Oe(J){return J.replace(/~/g,"~0").replace(/\./g,"~1")}function re(J){return J.replace(/~1/g,".").replace(/~0/g,"~")}function me(J,Y){if(Y==="")return J;var $=Y.indexOf(".");if($>-1){var H=J[re(Y.slice(0,$))];return H===void 0?void 0:me(H,Y.slice($+1))}return J[re(Y)]}function ce(J,Y,$){if(Y==="")return $;var H=Y.indexOf(".");if(H>-1){var ie=J[re(Y.slice(0,H))];return ce(ie,Y.slice(H+1),$)}return J[re(Y)]=$,J}function Ue(J){return J===null?"null":Array.isArray(J)?"array":o(J)}var De=Object.keys,xe=Array.isArray,Ce={}.hasOwnProperty,Fe=["type","replaced","iterateIn","iterateUnsetNumeric"];function Ne(J,Y){if(J.keypath==="")return-1;var $=J.keypath.match(/\./g)||0,H=Y.keypath.match(/\./g)||0;return $&&($=$.length),H&&(H=H.length),$>H?-1:$<H?1:J.keypath<Y.keypath?-1:J.keypath>Y.keypath}var Me=function(){function J(Y){c(this,J),this.options=Y,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return y(J,[{key:"stringify",value:function($,H,ie,fe){fe=m({},this.options,{},fe,{stringification:!0});var Ee=this.encapsulate($,null,fe);return xe(Ee)?JSON.stringify(Ee[0],H,ie):Ee.then(function(Ae){return JSON.stringify(Ae,H,ie)})}},{key:"stringifySync",value:function($,H,ie,fe){return this.stringify($,H,ie,m({throwOnBadSyncType:!0},fe,{sync:!0}))}},{key:"stringifyAsync",value:function($,H,ie,fe){return this.stringify($,H,ie,m({throwOnBadSyncType:!0},fe,{sync:!1}))}},{key:"parse",value:function($,H,ie){return ie=m({},this.options,{},ie,{parse:!0}),this.revive(JSON.parse($,H),ie)}},{key:"parseSync",value:function($,H,ie){return this.parse($,H,m({throwOnBadSyncType:!0},ie,{sync:!0}))}},{key:"parseAsync",value:function($,H,ie){return this.parse($,H,m({throwOnBadSyncType:!0},ie,{sync:!1}))}},{key:"specialTypeNames",value:function($,H){var ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ie.returnTypeNames=!0,this.encapsulate($,H,ie)}},{key:"rootTypeName",value:function($,H){var ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ie.iterateNone=!0,this.encapsulate($,H,ie)}},{key:"encapsulate",value:function($,H,ie){ie=m({sync:!0},this.options,{},ie);var fe=ie,Ee=fe.sync,Ae=this,he={},ut=[],wt=[],mt=[],zt="cyclic"in ie?ie.cyclic:!0,$t=ie,kt=$t.encapsulateObserver,Bt=Ze("",$,zt,H||{},mt);function Ct(Be){var _=Object.values(he);if(ie.iterateNone)return _.length?_[0]:J.getJSONType(Be);if(_.length){if(ie.returnTypeNames)return k(new Set(_));!Be||!K(Be)||Ce.call(Be,"$types")?Be={$:Be,$types:{$:he}}:Be.$types=he}else be(Be)&&Ce.call(Be,"$types")&&(Be={$:Be,$types:!0});return ie.returnTypeNames?!1:Be}function bt(Be,_){return it.apply(this,arguments)}function it(){return it=f(regeneratorRuntime.mark(function Be(_,p){var w;return regeneratorRuntime.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,Promise.all(p.map(function(ue){return ue[1].p}));case 2:return w=q.sent,q.next=5,Promise.all(w.map(function(){var ue=f(regeneratorRuntime.mark(function G(Re){var Se,$e,te,ze,st,et,tt,ct,lt,qe,gt,Te,ye,Ke;return regeneratorRuntime.wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:if(Se=[],$e=p.splice(0,1),te=h($e,1),ze=te[0],st=h(ze,7),et=st[0],tt=st[2],ct=st[3],lt=st[4],qe=st[5],gt=st[6],Te=Ze(et,Re,tt,ct,Se,!0,gt),ye=C(Te,B),!(et&&ye)){Pe.next=11;break}return Pe.next=8,Te.p;case 8:return Ke=Pe.sent,lt[qe]=Ke,Pe.abrupt("return",bt(_,Se));case 11:return et?lt[qe]=Te:ye?_=Te.p:_=Te,Pe.abrupt("return",bt(_,Se));case 13:case"end":return Pe.stop()}},G)}));return function(G){return ue.apply(this,arguments)}}()));case 5:return q.abrupt("return",_);case 6:case"end":return q.stop()}},Be)})),it.apply(this,arguments)}function He(Be,_,p){Object.assign(Be,_);var w=Fe.map(function(A){var q=Be[A];return delete Be[A],q});p(),Fe.forEach(function(A,q){Be[A]=w[q]})}function Ze(Be,_,p,w,A,q,ue){var G,Re={},Se=o(_),$e=kt?function(ye){var Ke=ue||w.type||J.getJSONType(_);kt(Object.assign(ye||Re,{keypath:Be,value:_,cyclic:p,stateObj:w,promisesData:A,resolvingTypesonPromise:q,awaitingTypesonPromise:C(_,B)},{type:Ke}))}:null;if(["string","boolean","number","undefined"].includes(Se))return _===void 0||Se==="number"&&(isNaN(_)||_===-1/0||_===1/0)?(w.replaced?G=_:G=pt(Be,_,w,A,!1,q,$e),G!==_&&(Re={replaced:G})):G=_,$e&&$e(),G;if(_===null)return $e&&$e(),_;if(p&&!w.iterateIn&&!w.iterateUnsetNumeric&&_&&o(_)==="object"){var te=ut.indexOf(_);if(te<0)p===!0&&(ut.push(_),wt.push(Be));else return he[Be]="#",$e&&$e({cyclicKeypath:wt[te]}),"#"+wt[te]}var ze=K(_),st=xe(_),et=(ze||st)&&(!Ae.plainObjectReplacers.length||w.replaced)||w.iterateIn?_:pt(Be,_,w,A,ze||st,null,$e),tt;if(et!==_?(G=et,Re={replaced:et}):Be===""&&C(_,B)?(A.push([Be,_,p,w,void 0,void 0,w.type]),G=_):st&&w.iterateIn!=="object"||w.iterateIn==="array"?(tt=new Array(_.length),Re={clone:tt}):!["function","symbol"].includes(o(_))&&!("toJSON"in _)&&!C(_,B)&&!C(_,Promise)&&!C(_,ArrayBuffer)||ze||w.iterateIn==="object"?(tt={},w.addLength&&(tt.length=_.length),Re={clone:tt}):G=_,$e&&$e(),ie.iterateNone)return tt||G;if(!tt)return G;if(w.iterateIn){var ct=function(Ke){var we={ownKeys:Ce.call(_,Ke)};He(w,we,function(){var Pe=Be+(Be?".":"")+Oe(Ke),Ge=Ze(Pe,_[Ke],!!p,w,A,q);C(Ge,B)?A.push([Pe,Ge,!!p,w,tt,Ke,w.type]):Ge!==void 0&&(tt[Ke]=Ge)})};for(var lt in _)ct(lt);$e&&$e({endIterateIn:!0,end:!0})}else De(_).forEach(function(ye){var Ke=Be+(Be?".":"")+Oe(ye),we={ownKeys:!0};He(w,we,function(){var Pe=Ze(Ke,_[ye],!!p,w,A,q);C(Pe,B)?A.push([Ke,Pe,!!p,w,tt,ye,w.type]):Pe!==void 0&&(tt[ye]=Pe)})}),$e&&$e({endIterateOwn:!0,end:!0});if(w.iterateUnsetNumeric){for(var qe=_.length,gt=function(Ke){if(!(Ke in _)){var we=Be+(Be?".":"")+Ke,Pe={ownKeys:!1};He(w,Pe,function(){var Ge=Ze(we,void 0,!!p,w,A,q);C(Ge,B)?A.push([we,Ge,!!p,w,tt,Ke,w.type]):Ge!==void 0&&(tt[Ke]=Ge)})}},Te=0;Te<qe;Te++)gt(Te);$e&&$e({endIterateUnsetNumeric:!0,end:!0})}return tt}function pt(Be,_,p,w,A,q,ue){for(var G=A?Ae.plainObjectReplacers:Ae.nonplainObjectReplacers,Re=G.length;Re--;){var Se=G[Re];if(Se.test(_,p)){var $e=Se.type;if(Ae.revivers[$e]){var te=he[Be];he[Be]=te?[$e].concat(te):$e}if(Object.assign(p,{type:$e,replaced:!0}),(Ee||!Se.replaceAsync)&&!Se.replace)return ue&&ue({typeDetected:!0}),Ze(Be,_,zt&&"readonly",p,w,q,$e);ue&&ue({replacing:!0});var ze=Ee||!Se.replaceAsync?"replace":"replaceAsync";return Ze(Be,Se[ze](_,p),zt&&"readonly",p,w,q,$e)}}return _}return mt.length?Ee&&ie.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(bt(Bt,mt)).then(Ct):!Ee&&ie.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():ie.stringification&&Ee?[Ct(Bt)]:Ee?Ct(Bt):Promise.resolve(Ct(Bt))}},{key:"encapsulateSync",value:function($,H,ie){return this.encapsulate($,H,m({throwOnBadSyncType:!0},ie,{sync:!0}))}},{key:"encapsulateAsync",value:function($,H,ie){return this.encapsulate($,H,m({throwOnBadSyncType:!0},ie,{sync:!1}))}},{key:"revive",value:function($,H){var ie=$&&$.$types;if(!ie)return $;if(ie===!0)return $.$;H=m({sync:!0},this.options,{},H);var fe=H,Ee=fe.sync,Ae=[],he={},ut=!0;ie.$&&K(ie.$)&&($=$.$,ie=ie.$,ut=!1);var wt=this;function mt(it,He){var Ze=wt.revivers[it]||[],pt=h(Ze,1),Be=pt[0];if(!Be)throw new Error("Unregistered type: "+it);return Ee&&!("revive"in Be)?He:Be[Ee&&Be.revive?"revive":!Ee&&Be.reviveAsync?"reviveAsync":"revive"](He,he)}function zt(){var it=[];if(Object.entries(ie).forEach(function(He){var Ze=h(He,2),pt=Ze[0],Be=Ze[1];Be!=="#"&&[].concat(Be).forEach(function(_){var p=wt.revivers[_]||[null,{}],w=h(p,2),A=w[1].plain;A&&(it.push({keypath:pt,type:_}),delete ie[pt])})}),!!it.length)return it.sort(Ne).reduce(function He(Ze,pt){var Be=pt.keypath,_=pt.type;if(I(Ze))return Ze.then(function(A){return He(A,{keypath:Be,type:_})});var p=me($,Be);if(p=mt(_,p),C(p,B))return p.then(function(A){var q=ce($,Be,A);q===A&&($=q)});var w=ce($,Be,p);w===p&&($=w)},void 0)}var $t=[];function kt(it,He,Ze,pt,Be){if(!(ut&&it==="$types")){var _=ie[it],p=xe(He);if(p||K(He)){var w=p?new Array(He.length):{};for(De(He).forEach(function(te){var ze=kt(it+(it?".":"")+Oe(te),He[te],Ze||w,w,te),st=function(tt){return C(tt,Xe)?w[te]=void 0:tt!==void 0&&(w[te]=tt),tt};C(ze,B)?$t.push(ze.then(function(et){return st(et)})):st(ze)}),He=w;Ae.length;){var A=h(Ae[0],4),q=A[0],ue=A[1],G=A[2],Re=A[3],Se=me(q,ue);if(Se!==void 0)G[Re]=Se;else break;Ae.splice(0,1)}}if(!_)return He;if(_==="#"){var $e=me(Ze,He.slice(1));return $e===void 0&&Ae.push([Ze,He.slice(1),pt,Be]),$e}return[].concat(_).reduce(function te(ze,st){return C(ze,B)?ze.then(function(et){return te(et,st)}):mt(st,ze)},He)}}function Bt(it){return C(it,Xe)?void 0:it}var Ct=zt(),bt;return C(Ct,B)?bt=Ct.then(function(){return $}):(bt=kt("",$,null),$t.length&&(bt=B.resolve(bt).then(function(it){return B.all([it].concat($t))}).then(function(it){var He=h(it,1),Ze=He[0];return Ze}))),I(bt)?Ee&&H.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():C(bt,B)?bt.p.then(Bt):bt:!Ee&&H.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():Ee?Bt(bt):Promise.resolve(Bt(bt))}},{key:"reviveSync",value:function($,H){return this.revive($,m({throwOnBadSyncType:!0},H,{sync:!0}))}},{key:"reviveAsync",value:function($,H){return this.revive($,m({throwOnBadSyncType:!0},H,{sync:!1}))}},{key:"register",value:function($,H){return H=H||{},[].concat($).forEach(function ie(fe){var Ee=this;if(xe(fe))return fe.map(function(Ae){return ie.call(Ee,Ae)});fe&&De(fe).forEach(function(Ae){if(Ae==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(J.JSON_TYPES.includes(Ae))throw new TypeError("Plain JSON object types are reserved as type names");var he=fe[Ae],ut=he&&he.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,wt=ut.filter(function(Ze){return Ze.type===Ae});if(wt.length&&(ut.splice(ut.indexOf(wt[0]),1),delete this.revivers[Ae],delete this.types[Ae]),typeof he=="function"){var mt=he;he={test:function(pt){return pt&&pt.constructor===mt},replace:function(pt){return m({},pt)},revive:function(pt){return Object.assign(Object.create(mt.prototype),pt)}}}else if(xe(he)){var zt=he,$t=h(zt,3),kt=$t[0],Bt=$t[1],Ct=$t[2];he={test:kt,replace:Bt,revive:Ct}}if(!(!he||!he.test)){var bt={type:Ae,test:he.test.bind(he)};he.replace&&(bt.replace=he.replace.bind(he)),he.replaceAsync&&(bt.replaceAsync=he.replaceAsync.bind(he));var it=typeof H.fallback=="number"?H.fallback:H.fallback?0:1/0;if(he.testPlainObjects?this.plainObjectReplacers.splice(it,0,bt):this.nonplainObjectReplacers.splice(it,0,bt),he.revive||he.reviveAsync){var He={};he.revive&&(He.revive=he.revive.bind(he)),he.reviveAsync&&(He.reviveAsync=he.reviveAsync.bind(he)),this.revivers[Ae]=[He,{plain:he.testPlainObjects}]}this.types[Ae]=he}},this)},this),this}}]),J}(),Xe=function J(){c(this,J)};return Xe.__typeson__type__="TypesonUndefined",Me.Undefined=Xe,Me.Promise=B,Me.isThenable=I,Me.toStringTag=g,Me.hasConstructorOf=C,Me.isObject=be,Me.isPlainObject=K,Me.isUserObject=ke,Me.escapeKeyPathComponent=Oe,Me.unescapeKeyPathComponent=re,Me.getByKeyPath=me,Me.getJSONType=Ue,Me.JSON_TYPES=["null","boolean","number","string","array","object"],Me})}),Dc=vo(function(n,r){(function(o,s){n.exports=s()})(to,function(){function o(_){return(o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(_)}function s(_,p){if(!(_ instanceof p))throw new TypeError("Cannot call a class as a function")}function f(_,p){for(var w=0;w<p.length;w++){var A=p[w];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(_,A.key,A)}}function c(_,p,w){return p in _?Object.defineProperty(_,p,{value:w,enumerable:!0,configurable:!0,writable:!0}):_[p]=w,_}function u(_,p){var w=Object.keys(_);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(_);p&&(A=A.filter(function(q){return Object.getOwnPropertyDescriptor(_,q).enumerable})),w.push.apply(w,A)}return w}function y(_){return function(w){if(Array.isArray(w))return b(w)}(_)||function(w){if(typeof Symbol<"u"&&Symbol.iterator in Object(w))return Array.from(w)}(_)||function(w,A){if(w){if(typeof w=="string")return b(w,A);var q=Object.prototype.toString.call(w).slice(8,-1);if(q==="Object"&&w.constructor&&(q=w.constructor.name),q==="Map"||q==="Set")return Array.from(w);if(q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(q))return b(w,A)}}(_)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function b(_,p){(p==null||p>_.length)&&(p=_.length);for(var w=0,A=new Array(p);w<p;w++)A[w]=_[w];return A}function l(_){return(l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w})(_)}function m(_,p){if(!(_ instanceof p))throw new TypeError("Cannot call a class as a function")}function h(_,p){for(var w=0;w<p.length;w++){var A=p[w];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(_,A.key,A)}}function k(_,p,w){return p in _?Object.defineProperty(_,p,{value:w,enumerable:!0,configurable:!0,writable:!0}):_[p]=w,_}function E(_,p){var w=Object.keys(_);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(_);p&&(A=A.filter(function(q){return Object.getOwnPropertyDescriptor(_,q).enumerable})),w.push.apply(w,A)}return w}function N(_){for(var p=1;p<arguments.length;p++){var w=arguments[p]!=null?arguments[p]:{};p%2?E(Object(w),!0).forEach(function(A){k(_,A,w[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(w)):E(Object(w)).forEach(function(A){Object.defineProperty(_,A,Object.getOwnPropertyDescriptor(w,A))})}return _}function D(_,p){return function(A){if(Array.isArray(A))return A}(_)||function(A,q){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(A)))){var ue=[],G=!0,Re=!1,Se=void 0;try{for(var $e,te=A[Symbol.iterator]();!(G=($e=te.next()).done)&&(ue.push($e.value),!q||ue.length!==q);G=!0);}catch(ze){Re=!0,Se=ze}finally{try{G||te.return==null||te.return()}finally{if(Re)throw Se}}return ue}}(_,p)||ee(_,p)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function z(_){return function(w){if(Array.isArray(w))return X(w)}(_)||function(w){if(typeof Symbol<"u"&&Symbol.iterator in Object(w))return Array.from(w)}(_)||ee(_)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ee(_,p){if(_){if(typeof _=="string")return X(_,p);var w=Object.prototype.toString.call(_).slice(8,-1);return w==="Object"&&_.constructor&&(w=_.constructor.name),w==="Map"||w==="Set"?Array.from(_):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?X(_,p):void 0}}function X(_,p){(p==null||p>_.length)&&(p=_.length);for(var w=0,A=new Array(p);w<p;w++)A[w]=_[w];return A}var B=function _(p){m(this,_),this.p=new Promise(p)};B.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(B.prototype[Symbol.toStringTag]="TypesonPromise"),B.prototype.then=function(_,p){var w=this;return new B(function(A,q){w.p.then(function(ue){A(_?_(ue):ue)}).catch(function(ue){return p?p(ue):Promise.reject(ue)}).then(A,q)})},B.prototype.catch=function(_){return this.then(null,_)},B.resolve=function(_){return new B(function(p){p(_)})},B.reject=function(_){return new B(function(p,w){w(_)})},["all","race"].forEach(function(_){B[_]=function(p){return new B(function(w,A){Promise[_](p.map(function(q){return q&&q.constructor&&q.constructor.__typeson__type__==="TypesonPromise"?q.p:q})).then(w,A)})}});var de={}.toString,ne={}.hasOwnProperty,se=Object.getPrototypeOf,oe=ne.toString;function Le(_,p){return K(_)&&typeof _.then=="function"&&(!p||typeof _.catch=="function")}function I(_){return de.call(_).slice(8,-1)}function g(_,p){if(!_||l(_)!=="object")return!1;var w=se(_);if(!w)return p===null;var A=ne.call(w,"constructor")&&w.constructor;return typeof A!="function"?p===null:p===A||p!==null&&oe.call(A)===oe.call(p)||typeof p=="function"&&typeof A.__typeson__type__=="string"&&A.__typeson__type__===p.__typeson__type__}function C(_){return!(!_||I(_)!=="Object")&&(!se(_)||g(_,Object))}function K(_){return _&&l(_)==="object"}function ke(_){return _.replace(/~/g,"~0").replace(/\./g,"~1")}function be(_){return _.replace(/~1/g,".").replace(/~0/g,"~")}function Oe(_,p){if(p==="")return _;var w=p.indexOf(".");if(w>-1){var A=_[be(p.slice(0,w))];return A===void 0?void 0:Oe(A,p.slice(w+1))}return _[be(p)]}function re(_,p,w){if(p==="")return w;var A=p.indexOf(".");return A>-1?re(_[be(p.slice(0,A))],p.slice(A+1),w):(_[be(p)]=w,_)}function me(_,p,w){return w?p?p(_):_:(_&&_.then||(_=Promise.resolve(_)),p?_.then(p):_)}var ce=Object.keys,Ue=Array.isArray,De={}.hasOwnProperty,xe=["type","replaced","iterateIn","iterateUnsetNumeric"];function Ce(_){return function(){for(var p=[],w=0;w<arguments.length;w++)p[w]=arguments[w];try{return Promise.resolve(_.apply(this,p))}catch(A){return Promise.reject(A)}}}function Fe(_,p){if(_.keypath==="")return-1;var w=_.keypath.match(/\./g)||0,A=p.keypath.match(/\./g)||0;return w&&(w=w.length),A&&(A=A.length),w>A?-1:w<A?1:_.keypath<p.keypath?-1:_.keypath>p.keypath}var Ne=function(){function _(p){m(this,_),this.options=p,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(w,A,q){return A&&h(w.prototype,A),w}(_,[{key:"stringify",value:function(w,A,q,ue){ue=N(N(N({},this.options),ue),{},{stringification:!0});var G=this.encapsulate(w,null,ue);return Ue(G)?JSON.stringify(G[0],A,q):G.then(function(Re){return JSON.stringify(Re,A,q)})}},{key:"stringifySync",value:function(w,A,q,ue){return this.stringify(w,A,q,N(N({throwOnBadSyncType:!0},ue),{},{sync:!0}))}},{key:"stringifyAsync",value:function(w,A,q,ue){return this.stringify(w,A,q,N(N({throwOnBadSyncType:!0},ue),{},{sync:!1}))}},{key:"parse",value:function(w,A,q){return q=N(N(N({},this.options),q),{},{parse:!0}),this.revive(JSON.parse(w,A),q)}},{key:"parseSync",value:function(w,A,q){return this.parse(w,A,N(N({throwOnBadSyncType:!0},q),{},{sync:!0}))}},{key:"parseAsync",value:function(w,A,q){return this.parse(w,A,N(N({throwOnBadSyncType:!0},q),{},{sync:!1}))}},{key:"specialTypeNames",value:function(w,A){var q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return q.returnTypeNames=!0,this.encapsulate(w,A,q)}},{key:"rootTypeName",value:function(w,A){var q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return q.iterateNone=!0,this.encapsulate(w,A,q)}},{key:"encapsulate",value:function(w,A,q){var ue=Ce(function(Te,ye){return me(Promise.all(ye.map(function(Ke){return Ke[1].p})),function(Ke){return me(Promise.all(Ke.map(Ce(function(we){var Pe=!1,Ge=[],Pt=D(ye.splice(0,1),1),ft=D(Pt[0],7),Et=ft[0],Mt=ft[2],Qe=ft[3],At=ft[4],ot=ft[5],It=ft[6],Nt=qe(Et,we,Mt,Qe,Ge,!0,It),Ot=g(Nt,B);return function(Qt,On){var nn=Qt();return nn&&nn.then?nn.then(On):On(nn)}(function(){if(Et&&Ot)return me(Nt.p,function(qt){return At[ot]=qt,Pe=!0,ue(Te,Ge)})},function(qt){return Pe?qt:(Et?At[ot]=Nt:Te=Ot?Nt.p:Nt,ue(Te,Ge))})}))),function(){return Te})})}),G=(q=N(N({sync:!0},this.options),q)).sync,Re=this,Se={},$e=[],te=[],ze=[],st=!("cyclic"in q)||q.cyclic,et=q.encapsulateObserver,tt=qe("",w,st,A||{},ze);function ct(Te){var ye=Object.values(Se);if(q.iterateNone)return ye.length?ye[0]:_.getJSONType(Te);if(ye.length){if(q.returnTypeNames)return z(new Set(ye));Te&&C(Te)&&!De.call(Te,"$types")?Te.$types=Se:Te={$:Te,$types:{$:Se}}}else K(Te)&&De.call(Te,"$types")&&(Te={$:Te,$types:!0});return!q.returnTypeNames&&Te}function lt(Te,ye,Ke){Object.assign(Te,ye);var we=xe.map(function(Pe){var Ge=Te[Pe];return delete Te[Pe],Ge});Ke(),xe.forEach(function(Pe,Ge){Te[Pe]=we[Ge]})}function qe(Te,ye,Ke,we,Pe,Ge,Pt){var ft,Et={},Mt=l(ye),Qe=et?function(Rt){var yt=Pt||we.type||_.getJSONType(ye);et(Object.assign(Rt||Et,{keypath:Te,value:ye,cyclic:Ke,stateObj:we,promisesData:Pe,resolvingTypesonPromise:Ge,awaitingTypesonPromise:g(ye,B)},{type:yt}))}:null;if(["string","boolean","number","undefined"].includes(Mt))return ye===void 0||Number.isNaN(ye)||ye===Number.NEGATIVE_INFINITY||ye===Number.POSITIVE_INFINITY?(ft=we.replaced?ye:gt(Te,ye,we,Pe,!1,Ge,Qe))!==ye&&(Et={replaced:ft}):ft=ye,Qe&&Qe(),ft;if(ye===null)return Qe&&Qe(),ye;if(Ke&&!we.iterateIn&&!we.iterateUnsetNumeric&&ye&&l(ye)==="object"){var At=$e.indexOf(ye);if(!(At<0))return Se[Te]="#",Qe&&Qe({cyclicKeypath:te[At]}),"#"+te[At];Ke===!0&&($e.push(ye),te.push(Te))}var ot,It=C(ye),Nt=Ue(ye),Ot=(It||Nt)&&(!Re.plainObjectReplacers.length||we.replaced)||we.iterateIn?ye:gt(Te,ye,we,Pe,It||Nt,null,Qe);if(Ot!==ye?(ft=Ot,Et={replaced:Ot}):Te===""&&g(ye,B)?(Pe.push([Te,ye,Ke,we,void 0,void 0,we.type]),ft=ye):Nt&&we.iterateIn!=="object"||we.iterateIn==="array"?(ot=new Array(ye.length),Et={clone:ot}):(["function","symbol"].includes(l(ye))||"toJSON"in ye||g(ye,B)||g(ye,Promise)||g(ye,ArrayBuffer))&&!It&&we.iterateIn!=="object"?ft=ye:(ot={},we.addLength&&(ot.length=ye.length),Et={clone:ot}),Qe&&Qe(),q.iterateNone)return ot||ft;if(!ot)return ft;if(we.iterateIn){var qt=function(yt){var Gt={ownKeys:De.call(ye,yt)};lt(we,Gt,function(){var Vt=Te+(Te?".":"")+ke(yt),cn=qe(Vt,ye[yt],!!Ke,we,Pe,Ge);g(cn,B)?Pe.push([Vt,cn,!!Ke,we,ot,yt,we.type]):cn!==void 0&&(ot[yt]=cn)})};for(var Qt in ye)qt(Qt);Qe&&Qe({endIterateIn:!0,end:!0})}else ce(ye).forEach(function(Rt){var yt=Te+(Te?".":"")+ke(Rt);lt(we,{ownKeys:!0},function(){var Gt=qe(yt,ye[Rt],!!Ke,we,Pe,Ge);g(Gt,B)?Pe.push([yt,Gt,!!Ke,we,ot,Rt,we.type]):Gt!==void 0&&(ot[Rt]=Gt)})}),Qe&&Qe({endIterateOwn:!0,end:!0});if(we.iterateUnsetNumeric){for(var On=ye.length,nn=function(yt){if(!(yt in ye)){var Gt=Te+(Te?".":"")+yt;lt(we,{ownKeys:!1},function(){var Vt=qe(Gt,void 0,!!Ke,we,Pe,Ge);g(Vt,B)?Pe.push([Gt,Vt,!!Ke,we,ot,yt,we.type]):Vt!==void 0&&(ot[yt]=Vt)})}},ht=0;ht<On;ht++)nn(ht);Qe&&Qe({endIterateUnsetNumeric:!0,end:!0})}return ot}function gt(Te,ye,Ke,we,Pe,Ge,Pt){for(var ft=Pe?Re.plainObjectReplacers:Re.nonplainObjectReplacers,Et=ft.length;Et--;){var Mt=ft[Et];if(Mt.test(ye,Ke)){var Qe=Mt.type;if(Re.revivers[Qe]){var At=Se[Te];Se[Te]=At?[Qe].concat(At):Qe}return Object.assign(Ke,{type:Qe,replaced:!0}),!G&&Mt.replaceAsync||Mt.replace?(Pt&&Pt({replacing:!0}),qe(Te,Mt[G||!Mt.replaceAsync?"replace":"replaceAsync"](ye,Ke),st&&"readonly",Ke,we,Ge,Qe)):(Pt&&Pt({typeDetected:!0}),qe(Te,ye,st&&"readonly",Ke,we,Ge,Qe))}}return ye}return ze.length?G&&q.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(ue(tt,ze)).then(ct):!G&&q.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():q.stringification&&G?[ct(tt)]:G?ct(tt):Promise.resolve(ct(tt))}},{key:"encapsulateSync",value:function(w,A,q){return this.encapsulate(w,A,N(N({throwOnBadSyncType:!0},q),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(w,A,q){return this.encapsulate(w,A,N(N({throwOnBadSyncType:!0},q),{},{sync:!1}))}},{key:"revive",value:function(w,A){var q=w&&w.$types;if(!q)return w;if(q===!0)return w.$;var ue=(A=N(N({sync:!0},this.options),A)).sync,G=[],Re={},Se=!0;q.$&&C(q.$)&&(w=w.$,q=q.$,Se=!1);var $e=this;function te(ct,lt){var qe=D($e.revivers[ct]||[],1)[0];if(!qe)throw new Error("Unregistered type: "+ct);return ue&&!("revive"in qe)?lt:qe[ue&&qe.revive?"revive":!ue&&qe.reviveAsync?"reviveAsync":"revive"](lt,Re)}var ze=[];function st(ct){return g(ct,Me)?void 0:ct}var et,tt=function(){var lt=[];if(Object.entries(q).forEach(function(qe){var gt=D(qe,2),Te=gt[0],ye=gt[1];ye!=="#"&&[].concat(ye).forEach(function(Ke){D($e.revivers[Ke]||[null,{}],2)[1].plain&&(lt.push({keypath:Te,type:Ke}),delete q[Te])})}),lt.length)return lt.sort(Fe).reduce(function qe(gt,Te){var ye=Te.keypath,Ke=Te.type;if(Le(gt))return gt.then(function(Ge){return qe(Ge,{keypath:ye,type:Ke})});var we=Oe(w,ye);if(g(we=te(Ke,we),B))return we.then(function(Ge){var Pt=re(w,ye,Ge);Pt===Ge&&(w=Pt)});var Pe=re(w,ye,we);Pe===we&&(w=Pe)},void 0)}();return g(tt,B)?et=tt.then(function(){return w}):(et=function ct(lt,qe,gt,Te,ye){if(!Se||lt!=="$types"){var Ke=q[lt],we=Ue(qe);if(we||C(qe)){var Pe=we?new Array(qe.length):{};for(ce(qe).forEach(function(ot){var It=ct(lt+(lt?".":"")+ke(ot),qe[ot],gt||Pe,Pe,ot),Nt=function(qt){return g(qt,Me)?Pe[ot]=void 0:qt!==void 0&&(Pe[ot]=qt),qt};g(It,B)?ze.push(It.then(function(Ot){return Nt(Ot)})):Nt(It)}),qe=Pe;G.length;){var Ge=D(G[0],4),Pt=Ge[0],ft=Ge[1],Et=Ge[2],Mt=Ge[3],Qe=Oe(Pt,ft);if(Qe===void 0)break;Et[Mt]=Qe,G.splice(0,1)}}if(!Ke)return qe;if(Ke==="#"){var At=Oe(gt,qe.slice(1));return At===void 0&&G.push([gt,qe.slice(1),Te,ye]),At}return[].concat(Ke).reduce(function ot(It,Nt){return g(It,B)?It.then(function(Ot){return ot(Ot,Nt)}):te(Nt,It)},qe)}}("",w,null),ze.length&&(et=B.resolve(et).then(function(ct){return B.all([ct].concat(ze))}).then(function(ct){return D(ct,1)[0]}))),Le(et)?ue&&A.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():g(et,B)?et.p.then(st):et:!ue&&A.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():ue?st(et):Promise.resolve(st(et))}},{key:"reviveSync",value:function(w,A){return this.revive(w,N(N({throwOnBadSyncType:!0},A),{},{sync:!0}))}},{key:"reviveAsync",value:function(w,A){return this.revive(w,N(N({throwOnBadSyncType:!0},A),{},{sync:!1}))}},{key:"register",value:function(w,A){return A=A||{},[].concat(w).forEach(function q(ue){var G=this;if(Ue(ue))return ue.map(function(Re){return q.call(G,Re)});ue&&ce(ue).forEach(function(Re){if(Re==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(_.JSON_TYPES.includes(Re))throw new TypeError("Plain JSON object types are reserved as type names");var Se=ue[Re],$e=Se&&Se.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,te=$e.filter(function(lt){return lt.type===Re});if(te.length&&($e.splice($e.indexOf(te[0]),1),delete this.revivers[Re],delete this.types[Re]),typeof Se=="function"){var ze=Se;Se={test:function(qe){return qe&&qe.constructor===ze},replace:function(qe){return N({},qe)},revive:function(qe){return Object.assign(Object.create(ze.prototype),qe)}}}else if(Ue(Se)){var st=D(Se,3);Se={test:st[0],replace:st[1],revive:st[2]}}if(Se&&Se.test){var et={type:Re,test:Se.test.bind(Se)};Se.replace&&(et.replace=Se.replace.bind(Se)),Se.replaceAsync&&(et.replaceAsync=Se.replaceAsync.bind(Se));var tt=typeof A.fallback=="number"?A.fallback:A.fallback?0:Number.POSITIVE_INFINITY;if(Se.testPlainObjects?this.plainObjectReplacers.splice(tt,0,et):this.nonplainObjectReplacers.splice(tt,0,et),Se.revive||Se.reviveAsync){var ct={};Se.revive&&(ct.revive=Se.revive.bind(Se)),Se.reviveAsync&&(ct.reviveAsync=Se.reviveAsync.bind(Se)),this.revivers[Re]=[ct,{plain:Se.testPlainObjects}]}this.types[Re]=Se}},this)},this),this}}]),_}(),Me=function _(){m(this,_)};Me.__typeson__type__="TypesonUndefined",Ne.Undefined=Me,Ne.Promise=B,Ne.isThenable=Le,Ne.toStringTag=I,Ne.hasConstructorOf=g,Ne.isObject=K,Ne.isPlainObject=C,Ne.isUserObject=function _(p){if(!p||I(p)!=="Object")return!1;var w=se(p);return!w||g(p,Object)||_(w)},Ne.escapeKeyPathComponent=ke,Ne.unescapeKeyPathComponent=be,Ne.getByKeyPath=Oe,Ne.getJSONType=function(p){return p===null?"null":Array.isArray(p)?"array":l(p)},Ne.JSON_TYPES=["null","boolean","number","string","array","object"];for(var Xe={userObject:{test:function(p,w){return Ne.isUserObject(p)},replace:function(p){return function(A){for(var q=1;q<arguments.length;q++){var ue=arguments[q]!=null?arguments[q]:{};q%2?u(Object(ue),!0).forEach(function(G){c(A,G,ue[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(ue)):u(Object(ue)).forEach(function(G){Object.defineProperty(A,G,Object.getOwnPropertyDescriptor(ue,G))})}return A}({},p)},revive:function(p){return p}}},J=[{arrayNonindexKeys:{testPlainObjects:!0,test:function(p,w){return!!Array.isArray(p)&&(Object.keys(p).some(function(A){return String(Number.parseInt(A))!==A})&&(w.iterateIn="object",w.addLength=!0),!0)},replace:function(p,w){return w.iterateUnsetNumeric=!0,p},revive:function(p){if(Array.isArray(p))return p;var w=[];return Object.keys(p).forEach(function(A){var q=p[A];w[A]=q}),w}}},{sparseUndefined:{test:function(p,w){return p===void 0&&w.ownKeys===!1},replace:function(p){return 0},revive:function(p){}}}],Y={undef:{test:function(p,w){return p===void 0&&(w.ownKeys||!("ownKeys"in w))},replace:function(p){return 0},revive:function(p){return new Ne.Undefined}}},$={StringObject:{test:function(p){return Ne.toStringTag(p)==="String"&&o(p)==="object"},replace:function(p){return String(p)},revive:function(p){return new String(p)}},BooleanObject:{test:function(p){return Ne.toStringTag(p)==="Boolean"&&o(p)==="object"},replace:function(p){return!!p},revive:function(p){return new Boolean(p)}},NumberObject:{test:function(p){return Ne.toStringTag(p)==="Number"&&o(p)==="object"},replace:function(p){return Number(p)},revive:function(p){return new Number(p)}}},H=[{nan:{test:function(p){return Number.isNaN(p)},replace:function(p){return"NaN"},revive:function(p){return Number.NaN}}},{infinity:{test:function(p){return p===Number.POSITIVE_INFINITY},replace:function(p){return"Infinity"},revive:function(p){return Number.POSITIVE_INFINITY}}},{negativeInfinity:{test:function(p){return p===Number.NEGATIVE_INFINITY},replace:function(p){return"-Infinity"},revive:function(p){return Number.NEGATIVE_INFINITY}}}],ie={date:{test:function(p){return Ne.toStringTag(p)==="Date"},replace:function(p){var w=p.getTime();return Number.isNaN(w)?"NaN":w},revive:function(p){return p==="NaN"?new Date(Number.NaN):new Date(p)}}},fe={regexp:{test:function(p){return Ne.toStringTag(p)==="RegExp"},replace:function(p){return{source:p.source,flags:(p.global?"g":"")+(p.ignoreCase?"i":"")+(p.multiline?"m":"")+(p.sticky?"y":"")+(p.unicode?"u":"")}},revive:function(p){var w=p.source,A=p.flags;return new RegExp(w,A)}}},Ee={map:{test:function(p){return Ne.toStringTag(p)==="Map"},replace:function(p){return y(p.entries())},revive:function(p){return new Map(p)}}},Ae={set:{test:function(p){return Ne.toStringTag(p)==="Set"},replace:function(p){return y(p.values())},revive:function(p){return new Set(p)}}},he="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ut=new Uint8Array(256),wt=0;wt<he.length;wt++)ut[he.charCodeAt(wt)]=wt;var mt=function(p,w,A){A==null&&(A=p.byteLength);for(var q=new Uint8Array(p,0,A),ue=q.length,G="",Re=0;Re<ue;Re+=3)G+=he[q[Re]>>2],G+=he[(3&q[Re])<<4|q[Re+1]>>4],G+=he[(15&q[Re+1])<<2|q[Re+2]>>6],G+=he[63&q[Re+2]];return ue%3==2?G=G.slice(0,-1)+"=":ue%3==1&&(G=G.slice(0,-2)+"=="),G},zt=function(p){var w,A,q,ue,G=p.length,Re=.75*p.length,Se=0;p[p.length-1]==="="&&(Re--,p[p.length-2]==="="&&Re--);for(var $e=new ArrayBuffer(Re),te=new Uint8Array($e),ze=0;ze<G;ze+=4)w=ut[p.charCodeAt(ze)],A=ut[p.charCodeAt(ze+1)],q=ut[p.charCodeAt(ze+2)],ue=ut[p.charCodeAt(ze+3)],te[Se++]=w<<2|A>>4,te[Se++]=(15&A)<<4|q>>2,te[Se++]=(3&q)<<6|63&ue;return $e},$t={arraybuffer:{test:function(p){return Ne.toStringTag(p)==="ArrayBuffer"},replace:function(p,w){w.buffers||(w.buffers=[]);var A=w.buffers.indexOf(p);return A>-1?{index:A}:(w.buffers.push(p),mt(p))},revive:function(p,w){if(w.buffers||(w.buffers=[]),o(p)==="object")return w.buffers[p.index];var A=zt(p);return w.buffers.push(A),A}}},kt=typeof self>"u"?to:self,Bt={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(_){var p=_,w=kt[p];w&&(Bt[_.toLowerCase()]={test:function(q){return Ne.toStringTag(q)===p},replace:function(q,ue){var G=q.buffer,Re=q.byteOffset,Se=q.length;ue.buffers||(ue.buffers=[]);var $e=ue.buffers.indexOf(G);return $e>-1?{index:$e,byteOffset:Re,length:Se}:(ue.buffers.push(G),{encoded:mt(G),byteOffset:Re,length:Se})},revive:function(q,ue){ue.buffers||(ue.buffers=[]);var G,Re=q.byteOffset,Se=q.length,$e=q.encoded,te=q.index;return"index"in q?G=ue.buffers[te]:(G=zt($e),ue.buffers.push(G)),new w(G,Re,Se)}})});var Ct={dataview:{test:function(p){return Ne.toStringTag(p)==="DataView"},replace:function(p,w){var A=p.buffer,q=p.byteOffset,ue=p.byteLength;w.buffers||(w.buffers=[]);var G=w.buffers.indexOf(A);return G>-1?{index:G,byteOffset:q,byteLength:ue}:(w.buffers.push(A),{encoded:mt(A),byteOffset:q,byteLength:ue})},revive:function(p,w){w.buffers||(w.buffers=[]);var A,q=p.byteOffset,ue=p.byteLength,G=p.encoded,Re=p.index;return"index"in p?A=w.buffers[Re]:(A=zt(G),w.buffers.push(A)),new DataView(A,q,ue)}}},bt={IntlCollator:{test:function(p){return Ne.hasConstructorOf(p,Intl.Collator)},replace:function(p){return p.resolvedOptions()},revive:function(p){return new Intl.Collator(p.locale,p)}},IntlDateTimeFormat:{test:function(p){return Ne.hasConstructorOf(p,Intl.DateTimeFormat)},replace:function(p){return p.resolvedOptions()},revive:function(p){return new Intl.DateTimeFormat(p.locale,p)}},IntlNumberFormat:{test:function(p){return Ne.hasConstructorOf(p,Intl.NumberFormat)},replace:function(p){return p.resolvedOptions()},revive:function(p){return new Intl.NumberFormat(p.locale,p)}}};function it(_){for(var p=new Uint8Array(_.length),w=0;w<_.length;w++)p[w]=_.charCodeAt(w);return p.buffer}var He={file:{test:function(p){return Ne.toStringTag(p)==="File"},replace:function(p){var w=new XMLHttpRequest;if(w.overrideMimeType("text/plain; charset=x-user-defined"),w.open("GET",URL.createObjectURL(p),!1),w.send(),w.status!==200&&w.status!==0)throw new Error("Bad File access: "+w.status);return{type:p.type,stringContents:w.responseText,name:p.name,lastModified:p.lastModified}},revive:function(p){var w=p.name,A=p.type,q=p.stringContents,ue=p.lastModified;return new File([it(q)],w,{type:A,lastModified:ue})},replaceAsync:function(p){return new Ne.Promise(function(w,A){var q=new FileReader;q.addEventListener("load",function(){w({type:p.type,stringContents:q.result,name:p.name,lastModified:p.lastModified})}),q.addEventListener("error",function(){A(q.error)}),q.readAsBinaryString(p)})}}},Ze={bigint:{test:function(p){return typeof p=="bigint"},replace:function(p){return String(p)},revive:function(p){return BigInt(p)}}},pt={bigintObject:{test:function(p){return o(p)==="object"&&Ne.hasConstructorOf(p,BigInt)},replace:function(p){return String(p)},revive:function(p){return new Object(BigInt(p))}}},Be={cryptokey:{test:function(p){return Ne.toStringTag(p)==="CryptoKey"&&p.extractable},replaceAsync:function(p){return new Ne.Promise(function(w,A){crypto.subtle.exportKey("jwk",p).catch(function(q){A(q)}).then(function(q){w({jwk:q,algorithm:p.algorithm,usages:p.usages})})})},revive:function(p){var w=p.jwk,A=p.algorithm,q=p.usages;return crypto.subtle.importKey("jwk",w,A,!0,q)}}};return[Xe,Y,J,$,H,ie,fe,{imagedata:{test:function(p){return Ne.toStringTag(p)==="ImageData"},replace:function(p){return{array:y(p.data),width:p.width,height:p.height}},revive:function(p){return new ImageData(new Uint8ClampedArray(p.array),p.width,p.height)}}},{imagebitmap:{test:function(p){return Ne.toStringTag(p)==="ImageBitmap"||p&&p.dataset&&p.dataset.toStringTag==="ImageBitmap"},replace:function(p){var w=document.createElement("canvas");return w.getContext("2d").drawImage(p,0,0),w.toDataURL()},revive:function(p){var w=document.createElement("canvas"),A=w.getContext("2d"),q=document.createElement("img");return q.addEventListener("load",function(){A.drawImage(q,0,0)}),q.src=p,w},reviveAsync:function(p){var w=document.createElement("canvas"),A=w.getContext("2d"),q=document.createElement("img");return q.addEventListener("load",function(){A.drawImage(q,0,0)}),q.src=p,createImageBitmap(w)}}},He,{file:He.file,filelist:{test:function(p){return Ne.toStringTag(p)==="FileList"},replace:function(p){for(var w=[],A=0;A<p.length;A++)w[A]=p.item(A);return w},revive:function(p){return new(function(){function w(){s(this,w),this._files=arguments[0],this.length=this._files.length}return function(q,ue,G){return ue&&f(q.prototype,ue),q}(w,[{key:"item",value:function(q){return this._files[q]}},{key:Symbol.toStringTag,get:function(){return"FileList"}}]),w}())(p)}}},{blob:{test:function(p){return Ne.toStringTag(p)==="Blob"},replace:function(p){var w=new XMLHttpRequest;if(w.overrideMimeType("text/plain; charset=x-user-defined"),w.open("GET",URL.createObjectURL(p),!1),w.send(),w.status!==200&&w.status!==0)throw new Error("Bad Blob access: "+w.status);return{type:p.type,stringContents:w.responseText}},revive:function(p){var w=p.type,A=p.stringContents;return new Blob([it(A)],{type:w})},replaceAsync:function(p){return new Ne.Promise(function(w,A){var q=new FileReader;q.addEventListener("load",function(){w({type:p.type,stringContents:q.result})}),q.addEventListener("error",function(){A(q.error)}),q.readAsBinaryString(p)})}}}].concat(typeof Map=="function"?Ee:[],typeof Set=="function"?Ae:[],typeof ArrayBuffer=="function"?$t:[],typeof Uint8Array=="function"?Bt:[],typeof DataView=="function"?Ct:[],typeof Intl<"u"?bt:[],typeof crypto<"u"?Be:[],typeof BigInt<"u"?[Ze,pt]:[])})}),Dn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ir=new Uint8Array(256);for(var Lr=0;Lr<Dn.length;Lr++)ir[Dn.codePointAt(Lr)]=Lr;var no=function(r,o,s){s==null&&(s=r.byteLength);for(var f=new Uint8Array(r,0,s),c=f.length,u="",y=0;y<c;y+=3)u+=Dn[f[y]>>2],u+=Dn[(f[y]&3)<<4|f[y+1]>>4],u+=Dn[(f[y+1]&15)<<2|f[y+2]>>6],u+=Dn[f[y+2]&63];return c%3===2?u=u.slice(0,-1)+"=":c%3===1&&(u=u.slice(0,-2)+"=="),u},Ia=function(r){var o=r.length,s=r.length*.75,f=0,c,u,y,b;r[r.length-1]==="="&&(s--,r[r.length-2]==="="&&s--);for(var l=new ArrayBuffer(s),m=new Uint8Array(l),h=0;h<o;h+=4)c=ir[r.codePointAt(h)],u=ir[r.codePointAt(h+1)],y=ir[r.codePointAt(h+2)],b=ir[r.codePointAt(h+3)],m[f++]=c<<2|u>>4,m[f++]=(u&15)<<4|y>>2,m[f++]=(y&3)<<6|b&63;return l},Kc=typeof self>"u"?global:self,ja={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(n){var r=n,o=Kc[r];o&&(ja[n.toLowerCase()+"2"]={test:function(s){return ri.toStringTag(s)===r},replace:function(s){var f=s.buffer,c=s.byteOffset,u=s.length;return{buffer:f,byteOffset:c,length:u}},revive:function(s){var f=s.buffer,c=s.byteOffset,u=s.length;return new o(f,c,u)}})});var Lc={arraybuffer:{test:function(n){return ri.toStringTag(n)==="ArrayBuffer"},replace:function(n){return no(n,0,n.byteLength)},revive:function(n){var r=Ia(n);return r}}},Xt=new ri().register(Dc),$c="FileReaderSync"in self,Gr=[],Di=0;Xt.register([Lc,ja,{blob2:{test:function(n){return ri.toStringTag(n)==="Blob"},replace:function(n){if(n.isClosed)throw new Error("The Blob is closed");if($c){var r=Pa(n,"binary"),o=no(r,0,r.byteLength);return{type:n.type,data:o}}else{Gr.push(n);var s={type:n.type,data:{start:Di,end:Di+n.size}};return Di+=n.size,s}},finalize:function(n,r){n.data=no(r,0,r.byteLength)},revive:function(n){var r=n.type,o=n.data;return new Blob([Ia(o)],{type:r})}}}]);Xt.mustFinalize=function(){return Gr.length>0};Xt.finalize=function(n){return kn(void 0,void 0,void 0,function(){var r,o,s,f,c,u,y,b,l,m;return tn(this,function(h){switch(h.label){case 0:return[4,Ta(new Blob(Gr),"binary")];case 1:if(r=h.sent(),n){for(o=0,s=n;o<s.length;o++)if(f=s[o],f.$types){c=f.$types,u=c.$,u&&(c=c.$);for(y in c)b=c[y],l=Xt.types[b],l&&l.finalize&&(m=nt.getByKeyPath(f,u?"$."+y:y),l.finalize(m,r.slice(m.start,m.end)))}}return Gr=[],[2]}})})};var Fc=2e3;function Mc(n,r){return kn(this,void 0,void 0,function(){function o(){return kn(this,void 0,void 0,function(){var h,k,E,N,D,z,ee,X,B,de;return tn(this,function(ne){switch(ne.label){case 0:return[4,Promise.all(f.map(function(se){return se.count()}))];case 1:h=ne.sent(),h.forEach(function(se,oe){return u[oe].rowCount=se}),m.totalRows=h.reduce(function(se,oe){return se+oe}),k=JSON.stringify(b,void 0,y?2:void 0),E=k.lastIndexOf("]"),N=k.substring(0,E),c.push(N),D=r.filter,z=r.transform,ee=function(se){var oe,Le,I,g,C,K,ke,be,Oe,re,me,ce;return tn(this,function(Ue){switch(Ue.label){case 0:oe=n.table(se),Le=oe.schema.primKey,I=!!Le.keyPath,g=r.numRowsPerChunk||Fc,C=I?{tableName:oe.name,inbound:!0,rows:[]}:{tableName:oe.name,inbound:!1,rows:[]},K=JSON.stringify(C,void 0,y?2:void 0),y&&(K=K.split(`
`).join(`
    `)),ke=K.lastIndexOf("]"),c.push(K.substring(0,ke)),be=null,Oe=0,re=!0,me=function(){var De,xe,Ce,Fe,Ne,Y,Me,Xe,J,Y;return tn(this,function($){switch($.label){case 0:return l&&nt.ignoreTransaction(function(){return l(m)}),De=be==null?oe.limit(g):oe.where(":id").above(be).limit(g),[4,De.toArray()];case 1:return xe=$.sent(),xe.length===0?[2,"break"]:(be!=null&&Oe>0&&(c.push(","),y&&c.push(`
      `)),re=xe.length===g,I?(Ce=D?xe.filter(function(H){return D(se,H)}):xe,Fe=z?Ce.map(function(H){return z(se,H).value}):Ce,Ne=Fe.map(function(H){return Xt.encapsulate(H)}),Xt.mustFinalize()?[4,nt.waitFor(Xt.finalize(Ne))]:[3,3]):[3,4]);case 2:$.sent(),$.label=3;case 3:return Y=JSON.stringify(Ne,void 0,y?2:void 0),y&&(Y=Y.split(`
`).join(`
      `)),c.push(new Blob([Y.substring(1,Y.length-1)])),Oe=Fe.length,be=xe.length>0?nt.getByKeyPath(xe[xe.length-1],Le.keyPath):null,[3,8];case 4:return[4,De.primaryKeys()];case 5:return Me=$.sent(),Xe=Me.map(function(H,ie){return[H,xe[ie]]}),D&&(Xe=Xe.filter(function(H){var ie=H[0],fe=H[1];return D(se,fe,ie)})),z&&(Xe=Xe.map(function(H){var ie=H[0],fe=H[1],Ee=z(se,fe,ie);return[Ee.key,Ee.value]})),J=Xe.map(function(H){return Xt.encapsulate(H)}),Xt.mustFinalize()?[4,nt.waitFor(Xt.finalize(J))]:[3,7];case 6:$.sent(),$.label=7;case 7:Y=JSON.stringify(J,void 0,y?2:void 0),y&&(Y=Y.split(`
`).join(`
      `)),c.push(new Blob([Y.substring(1,Y.length-1)])),Oe=Xe.length,be=Me.length>0?Me[Me.length-1]:null,$.label=8;case 8:return m.completedRows+=xe.length,[2]}})},Ue.label=1;case 1:return re?[5,me()]:[3,3];case 2:return ce=Ue.sent(),ce==="break"?[3,3]:[3,1];case 3:return c.push(K.substr(ke)),m.completedTables+=1,m.completedTables<m.totalTables&&c.push(","),[2]}})},X=0,B=u,ne.label=2;case 2:return X<B.length?(de=B[X].name,[5,ee(de)]):[3,5];case 3:ne.sent(),ne.label=4;case 4:return X++,[3,2];case 5:return c.push(k.substr(E)),m.done=!0,l&&nt.ignoreTransaction(function(){return l(m)}),[2]}})})}var s,f,c,u,y,b,l,m;return tn(this,function(h){switch(h.label){case 0:r=r||{},s=r.skipTables?r.skipTables:[],f=n.tables.filter(function(k){return!s.includes(k.name)}),c=[],u=f.map(function(k){return{name:k.name,schema:Rc(k),rowCount:0}}),y=r.prettyJson,b={formatName:"dexie",formatVersion:1,data:{databaseName:n.name,databaseVersion:n.verno,tables:u,data:[]}},l=r.progressCallback,m={done:!1,completedRows:0,completedTables:0,totalRows:NaN,totalTables:u.length},h.label=1;case 1:return h.trys.push([1,,6,7]),r.noTransaction?[4,o()]:[3,3];case 2:return h.sent(),[3,5];case 3:return[4,n.transaction("r",n.tables,o)];case 4:h.sent(),h.label=5;case 5:return[3,7];case 6:return Xt.finalize(),[7];case 7:return[2,new Blob(c,{type:"text/json"})]}})})}var qc=1,Vc={Stream:function(){}},Wc=vo(function(n,r){(function(o){var s=typeof process=="object"&&Ps?Ps:self;o.parser=function(I){return new E(I)},o.CParser=E,o.CStream=D,o.createStream=N,o.MAX_BUFFER_LENGTH=10*1024*1024,o.DEBUG=s.CDEBUG==="debug",o.INFO=s.CDEBUG==="debug"||s.CDEBUG==="info",o.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var f={textNode:void 0,numberNode:""},c=o.EVENTS.filter(function(I){return I!=="error"&&I!=="end"}),u=0,y;o.STATE={BEGIN:u++,VALUE:u++,OPEN_OBJECT:u++,CLOSE_OBJECT:u++,OPEN_ARRAY:u++,CLOSE_ARRAY:u++,TEXT_ESCAPE:u++,STRING:u++,BACKSLASH:u++,END:u++,OPEN_KEY:u++,CLOSE_KEY:u++,TRUE:u++,TRUE2:u++,TRUE3:u++,FALSE:u++,FALSE2:u++,FALSE3:u++,FALSE4:u++,NULL:u++,NULL2:u++,NULL3:u++,NUMBER_DECIMAL_POINT:u++,NUMBER_DIGIT:u++};for(var b in o.STATE)o.STATE[o.STATE[b]]=b;u=o.STATE;const l={tab:9,lineFeed:10,carriageReturn:13,space:32,doubleQuote:34,plus:43,comma:44,minus:45,period:46,_0:48,_9:57,colon:58,E:69,openBracket:91,backslash:92,closeBracket:93,a:97,b:98,e:101,f:102,l:108,n:110,r:114,s:115,t:116,u:117,openBrace:123,closeBrace:125};Object.create||(Object.create=function(I){function g(){this.__proto__=I}return g.prototype=I,new g}),Object.getPrototypeOf||(Object.getPrototypeOf=function(I){return I.__proto__}),Object.keys||(Object.keys=function(I){var g=[];for(var C in I)I.hasOwnProperty(C)&&g.push(C);return g});function m(I){var g=Math.max(o.MAX_BUFFER_LENGTH,10),C=0;for(var K in f){var ke=I[K]===void 0?0:I[K].length;if(ke>g)switch(K){case"text":closeText(I);break;default:ne(I,"Max buffer length exceeded: "+K)}C=Math.max(C,ke)}I.bufferCheckPosition=o.MAX_BUFFER_LENGTH-C+I.position}function h(I){for(var g in f)I[g]=f[g]}var k=/[\\"\n]/g;function E(I){if(!(this instanceof E))return new E(I);var g=this;h(g),g.bufferCheckPosition=o.MAX_BUFFER_LENGTH,g.q=g.c=g.p="",g.opt=I||{},g.closed=g.closedRoot=g.sawRoot=!1,g.tag=g.error=null,g.state=u.BEGIN,g.stack=new Array,g.position=g.column=0,g.line=1,g.slashed=!1,g.unicodeI=0,g.unicodeS=null,g.depth=0,z(g,"onready")}E.prototype={end:function(){se(this)},write:Le,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{y=Vc.Stream}catch{y=function(){}}function N(I){return new D(I)}function D(I){if(!(this instanceof D))return new D(I);this._parser=new E(I),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var g=this;y.apply(g),this._parser.onend=function(){g.emit("end")},this._parser.onerror=function(C){g.emit("error",C),g._parser.error=null},c.forEach(function(C){Object.defineProperty(g,"on"+C,{get:function(){return g._parser["on"+C]},set:function(K){if(!K)return g.removeAllListeners(C),g._parser["on"+C]=K,K;g.on(C,K)},enumerable:!0,configurable:!1})})}D.prototype=Object.create(y.prototype,{constructor:{value:D}}),D.prototype.write=function(I){I=new Buffer(I);for(var g=0;g<I.length;g++){var C=I[g];if(this.bytes_remaining>0){for(var K=0;K<this.bytes_remaining;K++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+K]=I[K];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,g=g+K-1,this._parser.write(this.string),this.emit("data",this.string);continue}if(this.bytes_remaining===0&&C>=128)if(C>=194&&C<=223&&(this.bytes_in_sequence=2),C>=224&&C<=239&&(this.bytes_in_sequence=3),C>=240&&C<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+g>I.length){for(var ke=0;ke<=I.length-1-g;ke++)this.temp_buffs[this.bytes_in_sequence][ke]=I[g+ke];return this.bytes_remaining=g+this.bytes_in_sequence-I.length,!0}else{this.string=I.slice(g,g+this.bytes_in_sequence).toString(),g=g+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string);continue}for(var be=g;be<I.length&&!(I[be]>=128);be++);this.string=I.slice(g,be).toString(),this._parser.write(this.string),this.emit("data",this.string),g=be-1}},D.prototype.end=function(I){return I&&I.length&&this._parser.write(I.toString()),this._parser.end(),!0},D.prototype.on=function(I,g){var C=this;return!C._parser["on"+I]&&c.indexOf(I)!==-1&&(C._parser["on"+I]=function(){var K=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);K.splice(0,0,I),C.emit.apply(C,K)}),y.prototype.on.call(C,I,g)},D.prototype.destroy=function(){h(this._parser),this.emit("close")};function z(I,g,C){o.INFO&&console.log("-- emit",g,C),I[g]&&I[g](C)}function ee(I,g,C){X(I),z(I,g,C)}function X(I,g){I.textNode=de(I.opt,I.textNode),I.textNode!==void 0&&z(I,g||"onvalue",I.textNode),I.textNode=void 0}function B(I){I.numberNode&&z(I,"onvalue",parseFloat(I.numberNode)),I.numberNode=""}function de(I,g){return g===void 0||(I.trim&&(g=g.trim()),I.normalize&&(g=g.replace(/\s+/g," "))),g}function ne(I,g){return X(I),g+=`
Line: `+I.line+`
Column: `+I.column+`
Char: `+I.c,g=new Error(g),I.error=g,z(I,"onerror",g),I}function se(I){return(I.state!==u.VALUE||I.depth!==0)&&ne(I,"Unexpected end"),X(I),I.c="",I.closed=!0,z(I,"onend"),E.call(I,I.opt),I}function oe(I){return I===l.carriageReturn||I===l.lineFeed||I===l.space||I===l.tab}function Le(I){var g=this;if(this.error)throw this.error;if(g.closed)return ne(g,"Cannot write after close. Assign an onready handler.");if(I===null)return se(g);var C=0,K=I.charCodeAt(0),ke=g.p;for(o.DEBUG&&console.log("write -> ["+I+"]");K&&(ke=K,g.c=K=I.charCodeAt(C++),ke!==K?g.p=ke:ke=g.p,!!K);)switch(o.DEBUG&&console.log(C,K,o.STATE[g.state]),g.position++,K===l.lineFeed?(g.line++,g.column=0):g.column++,g.state){case u.BEGIN:K===l.openBrace?g.state=u.OPEN_OBJECT:K===l.openBracket?g.state=u.OPEN_ARRAY:oe(K)||ne(g,"Non-whitespace before {[.");continue;case u.OPEN_KEY:case u.OPEN_OBJECT:if(oe(K))continue;if(g.state===u.OPEN_KEY)g.stack.push(u.CLOSE_KEY);else if(K===l.closeBrace){z(g,"onopenobject"),this.depth++,z(g,"oncloseobject"),this.depth--,g.state=g.stack.pop()||u.VALUE;continue}else g.stack.push(u.CLOSE_OBJECT);K===l.doubleQuote?g.state=u.STRING:ne(g,'Malformed object key should start with "');continue;case u.CLOSE_KEY:case u.CLOSE_OBJECT:if(oe(K))continue;g.state,u.CLOSE_KEY,K===l.colon?(g.state===u.CLOSE_OBJECT?(g.stack.push(u.CLOSE_OBJECT),X(g,"onopenobject"),this.depth++):X(g,"onkey"),g.state=u.VALUE):K===l.closeBrace?(ee(g,"oncloseobject"),this.depth--,g.state=g.stack.pop()||u.VALUE):K===l.comma?(g.state===u.CLOSE_OBJECT&&g.stack.push(u.CLOSE_OBJECT),X(g),g.state=u.OPEN_KEY):ne(g,"Bad object");continue;case u.OPEN_ARRAY:case u.VALUE:if(oe(K))continue;if(g.state===u.OPEN_ARRAY)if(z(g,"onopenarray"),this.depth++,g.state=u.VALUE,K===l.closeBracket){z(g,"onclosearray"),this.depth--,g.state=g.stack.pop()||u.VALUE;continue}else g.stack.push(u.CLOSE_ARRAY);K===l.doubleQuote?g.state=u.STRING:K===l.openBrace?g.state=u.OPEN_OBJECT:K===l.openBracket?g.state=u.OPEN_ARRAY:K===l.t?g.state=u.TRUE:K===l.f?g.state=u.FALSE:K===l.n?g.state=u.NULL:K===l.minus?g.numberNode+="-":l._0<=K&&K<=l._9?(g.numberNode+=String.fromCharCode(K),g.state=u.NUMBER_DIGIT):ne(g,"Bad value");continue;case u.CLOSE_ARRAY:if(K===l.comma)g.stack.push(u.CLOSE_ARRAY),X(g,"onvalue"),g.state=u.VALUE;else if(K===l.closeBracket)ee(g,"onclosearray"),this.depth--,g.state=g.stack.pop()||u.VALUE;else{if(oe(K))continue;ne(g,"Bad array")}continue;case u.STRING:g.textNode===void 0&&(g.textNode="");var be=C-1,Oe=g.slashed,re=g.unicodeI;e:for(;;){for(o.DEBUG&&console.log(C,K,o.STATE[g.state],Oe);re>0;)if(g.unicodeS+=String.fromCharCode(K),K=I.charCodeAt(C++),g.position++,re===4?(g.textNode+=String.fromCharCode(parseInt(g.unicodeS,16)),re=0,be=C-1):re++,!K)break e;if(K===l.doubleQuote&&!Oe){g.state=g.stack.pop()||u.VALUE,g.textNode+=I.substring(be,C-1),g.position+=C-1-be;break}if(K===l.backslash&&!Oe&&(Oe=!0,g.textNode+=I.substring(be,C-1),g.position+=C-1-be,K=I.charCodeAt(C++),g.position++,!K))break;if(Oe){if(Oe=!1,K===l.n?g.textNode+=`
`:K===l.r?g.textNode+="\r":K===l.t?g.textNode+="	":K===l.f?g.textNode+="\f":K===l.b?g.textNode+="\b":K===l.u?(re=1,g.unicodeS=""):g.textNode+=String.fromCharCode(K),K=I.charCodeAt(C++),g.position++,be=C-1,K)continue;break}k.lastIndex=C;var me=k.exec(I);if(me===null){C=I.length+1,g.textNode+=I.substring(be,C-1),g.position+=C-1-be;break}if(C=me.index+1,K=I.charCodeAt(me.index),!K){g.textNode+=I.substring(be,C-1),g.position+=C-1-be;break}}g.slashed=Oe,g.unicodeI=re;continue;case u.TRUE:K===l.r?g.state=u.TRUE2:ne(g,"Invalid true started with t"+K);continue;case u.TRUE2:K===l.u?g.state=u.TRUE3:ne(g,"Invalid true started with tr"+K);continue;case u.TRUE3:K===l.e?(z(g,"onvalue",!0),g.state=g.stack.pop()||u.VALUE):ne(g,"Invalid true started with tru"+K);continue;case u.FALSE:K===l.a?g.state=u.FALSE2:ne(g,"Invalid false started with f"+K);continue;case u.FALSE2:K===l.l?g.state=u.FALSE3:ne(g,"Invalid false started with fa"+K);continue;case u.FALSE3:K===l.s?g.state=u.FALSE4:ne(g,"Invalid false started with fal"+K);continue;case u.FALSE4:K===l.e?(z(g,"onvalue",!1),g.state=g.stack.pop()||u.VALUE):ne(g,"Invalid false started with fals"+K);continue;case u.NULL:K===l.u?g.state=u.NULL2:ne(g,"Invalid null started with n"+K);continue;case u.NULL2:K===l.l?g.state=u.NULL3:ne(g,"Invalid null started with nu"+K);continue;case u.NULL3:K===l.l?(z(g,"onvalue",null),g.state=g.stack.pop()||u.VALUE):ne(g,"Invalid null started with nul"+K);continue;case u.NUMBER_DECIMAL_POINT:K===l.period?(g.numberNode+=".",g.state=u.NUMBER_DIGIT):ne(g,"Leading zero not followed by .");continue;case u.NUMBER_DIGIT:l._0<=K&&K<=l._9?g.numberNode+=String.fromCharCode(K):K===l.period?(g.numberNode.indexOf(".")!==-1&&ne(g,"Invalid number has two dots"),g.numberNode+="."):K===l.e||K===l.E?((g.numberNode.indexOf("e")!==-1||g.numberNode.indexOf("E")!==-1)&&ne(g,"Invalid number has two exponential"),g.numberNode+="e"):K===l.plus||K===l.minus?(ke===l.e||ke===l.E||ne(g,"Invalid symbol in number"),g.numberNode+=String.fromCharCode(K)):(B(g),C--,g.state=g.stack.pop()||u.VALUE);continue;default:ne(g,"Unknown state: "+g.state)}return g.position>=g.bufferCheckPosition&&m(g),g}})(r)});function zc(n){var r=0,o=Jc(),s={pullAsync:function(f){return kn(this,void 0,void 0,function(){var c,u,y;return tn(this,function(b){switch(b.label){case 0:return c=n.slice(r,r+f),r+=f,[4,Ta(c,"text")];case 1:return u=b.sent(),y=o.write(u),s.result=y||{},[2,y]}})})},pullSync:function(f){var c=n.slice(r,r+f);r+=f;var u=Pa(c,"text"),y=o.write(u);return s.result=y||{},y},done:function(){return o.done()},eof:function(){return r>=n.size},result:{}};return s}function Jc(n){var r=Wc.parser(),o=0,s,f=[],c,u,y=!1,b=!1;return r.onopenobject=function(l){var m={};m.incomplete=!0,s||(s=m),c&&(f.push([u,c,b]),b?c.push(m):c[u]=m),c=m,u=l,b=!1,++o},r.onkey=function(l){return u=l},r.onvalue=function(l){return b?c.push(l):c[u]=l},r.oncloseobject=function(){var l;delete c.incomplete,u=null,--o===0?y=!0:(l=f.pop(),u=l[0],c=l[1],b=l[2])},r.onopenarray=function(){var l=[];l.incomplete=!0,s||(s=l),c&&(f.push([u,c,b]),b?c.push(l):c[u]=l),c=l,b=!0,u=null,++o},r.onclosearray=function(){var l;delete c.incomplete,u=null,--o===0?y=!0:(l=f.pop(),u=l[0],c=l[1],b=l[2])},{write:function(l){return r.write(l),s},done:function(){return y}}}var Ca=1024;function Hc(n,r){return kn(this,void 0,void 0,function(){var o,s,f,c;return tn(this,function(u){switch(u.label){case 0:return r=r||{},o=r.chunkSizeBytes||Ca*1024,[4,Ba(n,o)];case 1:return s=u.sent(),f=s.result.data,c=new nt(f.databaseName),c.version(f.databaseVersion).stores(Uc(f)),[4,Na(c,s,r)];case 2:return u.sent(),[2,c]}})})}function Na(n,r,o){return kn(this,void 0,void 0,function(){function s(){return kn(this,void 0,void 0,function(){var D,z,ee,X,B;return tn(this,function(de){switch(de.label){case 0:D=function(ne){var se,oe,Le,I,g,C,K,ke,be,Oe,re,me,ce;return tn(this,function(Ue){switch(Ue.label){case 0:if(l.includes(ne.tableName))return[2,"continue"];if(!ne.rows)return[2,"break"];if(!ne.rows.incomplete&&ne.rows.length===0)return[2,"continue"];if(m&&nt.ignoreTransaction(function(){return m(h)}),se=ne.tableName,oe=n.table(se),Le=b.tables.filter(function(De){return De.name===se})[0].schema,!oe){if(o.acceptMissingTables)return[2,"continue"];throw new Error("Exported table ".concat(ne.tableName," is missing in installed database"))}if(!o.acceptChangedPrimaryKey&&Le.split(",")[0]!=oe.schema.primKey.src)throw new Error("Primary key differs for table ".concat(ne.tableName,". "));for(I=ne.rows,g=[],C=0;C<I.length&&(K=I[C],!K.incomplete);C++)g.push(Xt.revive(K));return ke=o.filter,be=o.transform,Oe=ke?ne.inbound?g.filter(function(De){return ke(se,De)}):g.filter(function(De){var xe=De[0],Ce=De[1];return ke(se,Ce,xe)}):g,be&&(Oe=Oe.map(ne.inbound?function(De){return be(se,De).value}:function(De){var xe=De[0],Ce=De[1],Fe=be(se,Ce,xe);return[Fe.key,Fe.value]})),re=ne.inbound?[void 0,Oe]:[Oe.map(function(De){return De[0]}),g.map(function(De){return De[1]})],me=re[0],ce=re[1],o.overwriteValues?[4,oe.bulkPut(ce,me)]:[3,2];case 1:return Ue.sent(),[3,4];case 2:return[4,oe.bulkAdd(ce,me)];case 3:Ue.sent(),Ue.label=4;case 4:return h.completedRows+=g.length,g.incomplete||(h.completedTables+=1),I.splice(0,g.length),[2]}})},z=0,ee=b.data,de.label=1;case 1:return z<ee.length?(X=ee[z],[5,D(X)]):[3,4];case 2:if(B=de.sent(),B==="break")return[3,4];de.label=3;case 3:return z++,[3,1];case 4:for(;b.data.length>0&&b.data[0].rows&&!b.data[0].rows.incomplete;)b.data.splice(0,1);return!c.done()&&!c.eof()?y?(c.pullSync(f),[3,7]):[3,5]:[3,8];case 5:return[4,nt.waitFor(c.pullAsync(f))];case 6:de.sent(),de.label=7;case 7:return[3,9];case 8:return[3,10];case 9:return[3,0];case 10:return[2]}})})}var f,c,u,y,b,l,m,h,k,E,N;return tn(this,function(D){switch(D.label){case 0:return o=o||{},f=o.chunkSizeBytes||Ca*1024,[4,Ba(r,f)];case 1:if(c=D.sent(),u=c.result,y="FileReaderSync"in self,b=u.data,l=o.skipTables?o.skipTables:[],!o.acceptNameDiff&&n.name!==b.databaseName)throw new Error("Name differs. Current database name is ".concat(n.name," but export is ").concat(b.databaseName));if(!o.acceptVersionDiff&&n.verno!==b.databaseVersion)throw new Error("Database version differs. Current database is in version ".concat(n.verno," but export is ").concat(b.databaseVersion));if(m=o.progressCallback,h={done:!1,completedRows:0,completedTables:0,totalRows:b.tables.reduce(function(z,ee){return z+ee.rowCount},0),totalTables:b.tables.length},m&&nt.ignoreTransaction(function(){return m(h)}),!o.clearTablesBeforeImport)return[3,5];k=0,E=n.tables,D.label=2;case 2:return k<E.length?(N=E[k],l.includes(N.name)?[3,4]:[4,N.clear()]):[3,5];case 3:D.sent(),D.label=4;case 4:return k++,[3,2];case 5:return o.noTransaction?[4,s()]:[3,7];case 6:return D.sent(),[3,9];case 7:return[4,n.transaction("rw",n.tables,s)];case 8:D.sent(),D.label=9;case 9:return h.done=!0,m&&nt.ignoreTransaction(function(){return m(h)}),[2]}})})}function Ba(n,r){return kn(this,void 0,void 0,function(){var o,s;return tn(this,function(f){switch(f.label){case 0:o="slice"in n?zc(n):n,f.label=1;case 1:return o.eof()?[3,3]:[4,o.pullAsync(r)];case 2:return f.sent(),o.result.data&&o.result.data.data?[3,3]:[3,1];case 3:if(s=o.result,!s||s.formatName!="dexie")throw new Error("Given file is not a dexie export");if(s.formatVersion>qc)throw new Error("Format version ".concat(s.formatVersion," not supported"));if(!s.data)throw new Error("No data in export file");if(!s.data.databaseName)throw new Error("Missing databaseName in export file");if(!s.data.databaseVersion)throw new Error("Missing databaseVersion in export file");if(!s.data.tables)throw new Error("Missing tables in export file");return[2,o]}})})}nt.prototype.export=function(n){return Mc(this,n)};nt.prototype.import=function(n,r){return Na(this,n,r)};nt.import=function(n,r){return Hc(n,r)};export{nt as D,Pc as Y,Xo as a,io as c,Mc as e,pu as g,Na as i,jn as l,Ts as w};
